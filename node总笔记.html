<!DOCTYPE html><html><head>
      <title>node&#x603B;&#x7B14;&#x8BB0;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\lby\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.6.0\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  font-family: "consolas", "Noto Sans S Chinese";
  font-size: 1em;
}
.markdown-img-description {
  text-align: center;
  margin-top: -1em;
  color: #666;
  margin-bottom: 2em;
}
html body img {
  border: 2px solid #ccc;
}
.markdown-p-center {
  text-align: center;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      
<script>
    function setCurrent(){
        const links = document.querySelectorAll(".md-sidebar-toc a")
        for(const link of links){
            link.style.color="";
        }
        const hash = location.hash;
        const a = document.querySelector('a[href="'+hash+'"]');
        if(a){
            a.style.color = "#f40";
        }
    }
    setCurrent();
    window.onhashchange = setCurrent;
</script>
<h1 class="mume-header" id="mysql">mysql</h1>

<h3 class="mume-header" id="mysql%E7%9A%84%E5%AE%89%E8%A3%85">mysql&#x7684;&#x5B89;&#x88C5;</h3>

<p>&#x4E0B;&#x8F7D;<br>
<a href="https://dev.mysql.com/downloads/mysql/">&#x5B98;&#x65B9;&#x5730;&#x5740;</a><br>
<a href="https://pc.qq.com/detail/3/detail_1303.html">&#x817E;&#x8BAF;&#x4E0B;&#x8F7D;&#x6E90;</a><br>
&#x5B89;&#x88C5;<br>
&#x9009;server only  next<br>
execute   next<br>
next<br>
next next next<br>
&#x8BBE;&#x7F6E;&#x5BC6;&#x7801; 123123<br>
next next execute finish</p>
<p>&#x7535;&#x8111;&#x53F3;&#x51FB;&#x83DC;&#x5355; &#x8FD0;&#x884C; services.msc<br>
&#x627E;&#x5230;mysql &#x5C5E;&#x6027; &#x8BBE;&#x4E3A;&#x81EA;&#x52A8;&#x542F;&#x52A8;</p>
<p>&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;<br>
&#x590D;&#x5236;&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;  C:\Program Files\MySQL\MySQL Server 8.0\bin<br>
&#x8BA1;&#x7B97;&#x673A; &#x5C5E;&#x6027; &#x9AD8;&#x7EA7;&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E; &#x73AF;&#x5883;&#x53D8;&#x91CF;<br>
&#x5728;&#x7CFB;&#x7EDF;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF; &#x627E;&#x5230;path &#x52A0;&#x4E0A;&#x90A3;&#x4E2A;&#x5730;&#x5740;<br>
&#x8FD0;&#x884C;mysql&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x6210;&#x529F;</p>
<h3 class="mume-header" id="%E4%BD%BF%E7%94%A8">&#x4F7F;&#x7528;</h3>

<p>&#x8FDB;&#x5165;mysql&#x4EA4;&#x4E92;&#x547D;&#x4EE4; &#xFF08;&#x76F8;&#x5F53;&#x4E8E;&#x8FD0;&#x884C;node&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5199;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x5728;&#x547D;&#x4EE4;&#x884C;&#xFF09;<br>
&#x547D;&#x4EE4; mysql -uroot -p<br>
-p&#x8868;&#x793A;&#x4F7F;&#x7528;&#x5BC6;&#x7801;&#x767B;&#x5F55;<br>
-uroot&#x8868;&#x793A;&#x8D85;&#x7EA7;&#x7BA1;&#x7406;&#x5458;</p>
<p>&#x8FD0;&#x884C;&#x8FD9;&#x4E32;&#x4EE3;&#x7801; show variables like &apos;character_set_%&apos;;<br>
&#x67E5;&#x770B;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x5B57;&#x7B26;&#x7F16;&#x7801;</p>
<p>utf8&#x4E00;&#x4E2A;&#x5B57;&#x4E09;&#x4E2A;&#x5B57;&#x8282;<br>
utf8mb4 &#x4E00;&#x4E2A;&#x5B57;&#x56DB;&#x4E2A;&#x5B57;&#x8282;</p>
<p>&#x628A;&#x6570;&#x636E;&#x5E93;&#x7F16;&#x7801;&#x6539;&#x6210;utf8mb4<br>
&#x627E;&#x5230;&#x76EE;&#x5F55; C:\ProgramData\MySQL\MySQL Server 8.0<br>
programData&#x662F;&#x4E00;&#x4E2A;&#x9690;&#x85CF;&#x6587;&#x4EF6;&#x5939;<br>
&#x4FEE;&#x6539;my.ini&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x9ED8;&#x8BA4;&#x5B57;&#x7B26;&#x7F16;&#x7801;<br>
&#x8BBE;&#x7F6E;<br>
default-character-set=utf8mb4<br>
character-set-server=utf8mb4<br>
&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#x540E;&#x628A;&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;&#x5B89;&#x88C5;&#x76EE;&#x5F55;<br>
C:\Program Files\MySQL\MySQL Server 8.0<br>
&#x641E;&#x597D;&#x540E;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x542F;&#x52A8;mysql&#x670D;&#x52A1;<br>
net stop mysql80 &#x505C;&#x6B62;&#x670D;&#x52A1;<br>
net start mysql80 &#x542F;&#x52A8;&#x670D;&#x52A1;<br>
&#x7535;&#x8111;&#x53F3;&#x51FB;&#x83DC;&#x5355; &#x8FD0;&#x884C; services.msc   &#x7528;&#x754C;&#x9762;&#x8FDB;&#x884C;&#x91CD;&#x542F;</p>
<p>show databases;  &#x67E5;&#x770B;&#x5F53;&#x524D;&#x62E5;&#x6709;&#x7684;&#x6570;&#x636E;&#x5E93;<br>
exit &#x9000;&#x51FA;</p>
<p>&#x4F7F;&#x7528;navicat&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406; &#x7F51;&#x4E0A;&#x627E;&#x7834;&#x89E3;&#x7248;<br>
<a href="https://www.jb51.net/article/199525.htm">https://www.jb51.net/article/199525.htm</a><br>
&#x7834;&#x89E3;&#x5DE5;&#x5177; &#x5BC6;&#x7801; 3y6d<br>
<a href="https://pan.baidu.com/s/11PH7oGOaegG00e8x-bx_aQ">https://pan.baidu.com/s/11PH7oGOaegG00e8x-bx_aQ</a></p>
<p><a href="https://www.yuque.com/docs/share/50c484aa-4a93-4deb-9781-d9264a133c0b">https://www.yuque.com/docs/share/50c484aa-4a93-4deb-9781-d9264a133c0b</a></p>
<h3 class="mume-header" id="%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;</h3>

<p>SQL &#x7ED3;&#x6784;&#x5316;&#x67E5;&#x8BE2;&#x8BED;&#x8A00;</p>
<ul>
<li>DDL &#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x5BF9;&#x8C61; &#x5E93;&#x8868;&#xFF0C;&#x89C6;&#x56FE;&#xFF0C;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;</li>
<li>DML &#x6570;&#x636E;&#x64CD;&#x63A7;&#x8BED;&#x8A00;&#xFF0C;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;</li>
<li>DCL &#x6570;&#x636E;&#x63A7;&#x5236;&#x8BED;&#x53E5;  &#x64CD;&#x4F5C;&#x7528;&#x6237;&#x6743;&#x9650;<br>
&#x7BA1;&#x7406;&#x5E93;<br>
create database name &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;<br>
use name &#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x6570;&#x636E;&#x5E93;<br>
drop database name &#x5220;&#x9664;&#x6570;&#x636E;&#x5E93;<br>
&#x7BA1;&#x7406;&#x8868;</li>
</ul>
<p>&#x8868;&#x8BB0;&#x5F55;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5; DML</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- &#x589E;&#x52A0;&#x8BB0;&#x5F55;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>stuno<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> birthday<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>classid<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;500&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;&#x6210;&#x54E5;&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;1900-1-1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;13344445555&apos;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>stuno<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> birthday<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>classid<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;500&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;&#x6210;&#x54E5;&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;1900-1-1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;13344445555&apos;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;501&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;&#x9093;&#x54E5;&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;1900-1-2&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;13344445556&apos;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- &#x4FEE;&#x6539;&#x8BB0;&#x5F55;</span>
<span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">&apos;&#x9093;&#x65ED;&#x540D;&apos;</span> 
<span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>

<span class="token comment">-- &#x5220;&#x9664;&#x8BB0;&#x5F55;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> student
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">&apos;&#x8881;&#x54E5;&apos;</span><span class="token punctuation">;</span>
</pre><p>&#x5355;&#x8868;&#x7684;&#x57FA;&#x672C;&#x67E5;&#x8BE2;</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> loginid<span class="token punctuation">,</span> loginpwd<span class="token punctuation">,</span> <span class="token string">&apos;abc&apos;</span> <span class="token keyword">as</span> <span class="token string">&apos;&#x989D;&#x5916;&#x7684;&#x4E00;&#x5217;&apos;</span> <span class="token keyword">from</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x53D6;&#x51FA;user&#x8868;&#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#x7684;&#x5217;</span>

<span class="token keyword">SELECT</span> ismale <span class="token string">&apos;&#x6027;&#x522B;&apos;</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>employee<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x4E0D;&#x7528;as&#xFF0C;&#x5199;&#x5728;&#x540E;&#x9762;&#x5C31;&#x662F;&#x522B;&#x540D;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token string">&apos;abc&apos;</span> <span class="token keyword">as</span> <span class="token string">&apos;extra&apos;</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>employee<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> 
<span class="token keyword">case</span> ismale
<span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">&apos;&#x7537;&apos;</span>
<span class="token keyword">else</span> <span class="token string">&apos;&#x5973;&apos;</span>
<span class="token keyword">end</span> sex<span class="token punctuation">,</span> 
salary 
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>
<span class="token comment">-- &#x628A;ismale&#x5217;&#x91CC;&#x7684;1&#x6539;&#x4E3A;&#x7537;&#xFF0C;0&#x6539;&#x4E3A;&#x5973;</span>

<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> 
<span class="token keyword">case</span>
<span class="token keyword">when</span> ismale <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">&apos;&#x7537;&apos;</span>
<span class="token keyword">else</span> <span class="token string">&apos;&#x5973;&apos;</span>
<span class="token keyword">end</span> sex<span class="token punctuation">,</span> 
<span class="token keyword">case</span>
<span class="token keyword">when</span> salary<span class="token operator">&gt;=</span><span class="token number">10000</span> <span class="token keyword">then</span> <span class="token string">&apos;&#x9AD8;&apos;</span>
<span class="token keyword">when</span> salary<span class="token operator">&gt;=</span><span class="token number">5000</span> <span class="token keyword">then</span> <span class="token string">&apos;&#x4E2D;&apos;</span>
<span class="token keyword">else</span> <span class="token string">&apos;&#x4F4E;&apos;</span>
<span class="token keyword">end</span> <span class="token punctuation">`</span><span class="token keyword">level</span><span class="token punctuation">`</span><span class="token punctuation">,</span>
salary
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>
<span class="token comment">-- &#x591A;&#x6761;&#x4EF6;&#x67E5;&#x8BE2;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;if&#xFF0C;else if&#xFF0C;else</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> ismale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> department
<span class="token keyword">WHERE</span> companyId <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- companyId&#x4E3A;1&#x6216;2&#x7684;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> location <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token comment">-- location&#x7684;&#x503C;&#x4E0D;&#x4E3A;null&#xFF08;&#x7A7A;&#xFF09;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> location <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token comment">-- location&#x7684;&#x503C;&#x4E3A;null&#xFF08;&#x7A7A;&#xFF09;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> salary<span class="token operator">&gt;=</span><span class="token number">10000</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> salary <span class="token operator">BETWEEN</span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token number">12000</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x5728;&#x3002;&#x3002;&#x3002;&#x4E4B;&#x95F4;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&apos;%&#x8881;%&apos;</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x5305;&#x542B;&#x8881;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&apos;&#x8881;_&apos;</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x4EE5;&#x8881;&#x5F00;&#x5934;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&apos;&#x5F20;%&apos;</span> <span class="token operator">and</span> ismale<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">and</span> salary<span class="token operator">&gt;=</span><span class="token number">12000</span><span class="token punctuation">;</span>
<span class="token comment">-- and&#x5E76;&#x4E14;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&apos;&#x5F20;%&apos;</span> <span class="token operator">and</span> <span class="token punctuation">(</span>ismale<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">and</span> salary<span class="token operator">&gt;=</span><span class="token number">12000</span>
<span class="token operator">or</span>
birthday<span class="token operator">&gt;=</span><span class="token string">&apos;1996-1-1&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- or&#x6216;&#x8005;&#xFF0C;&#x6EE1;&#x8DB3;&#x4E00;&#x4E2A;&#x5219;&#x4E3A;&#x771F;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">case</span> ismale
<span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">&apos;&#x7537;&apos;</span>
<span class="token keyword">else</span> <span class="token string">&apos;&#x5973;&apos;</span>
<span class="token keyword">end</span> sex <span class="token keyword">from</span> employee
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sex <span class="token keyword">asc</span><span class="token punctuation">,</span> salary <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment">-- order by &#x6392;&#x5E8F; &#xFF0C;asc&#x5347;&#x5E8F;  desc&#x964D;&#x5E8F;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee
<span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">-- &#x53BB;&#x6389;&#x524D;&#x4E24;&#x4E2A;&#x518D;&#x9009;&#x4E09;&#x4E2A;</span>

<span class="token keyword">select</span> <span class="token keyword">DISTINCT</span> location <span class="token keyword">from</span> employee<span class="token punctuation">;</span>
<span class="token comment">-- distinct &#x53BB;&#x91CD;</span>
</pre><p>&#x8054;&#x8868;&#x67E5;&#x8BE2;</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">from</span> department <span class="token keyword">as</span> d <span class="token keyword">left</span> <span class="token keyword">join</span> employee <span class="token keyword">as</span> e
<span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId<span class="token punctuation">;</span>
<span class="token comment">-- on&#x540E;&#x9762;&#x662F;&#x9650;&#x5236;&#x6761;&#x4EF6;   </span>
<span class="token comment">-- left join  &#x5DE6;&#x8FB9;&#x7684;&#x5F00;&#x5934;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">from</span> employee <span class="token keyword">as</span> e <span class="token keyword">right</span> <span class="token keyword">join</span> department <span class="token keyword">as</span> d 
<span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId<span class="token punctuation">;</span>
<span class="token comment">-- right join &#x53F3;&#x8FB9;&#x7684;&#x5F00;&#x5934;</span>

<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">as</span> empname<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">as</span> dptname<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">as</span> companyname
<span class="token keyword">from</span> employee <span class="token keyword">as</span> e 
<span class="token keyword">inner</span> <span class="token keyword">join</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId 
<span class="token keyword">inner</span> <span class="token keyword">join</span> company c <span class="token keyword">on</span> d<span class="token punctuation">.</span>companyId <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token comment">-- inner join &#x6309;&#x987A;&#x5E8F;&#x94FE;&#x63A5;</span>
</pre><h3 class="mume-header" id="%E5%87%BD%E6%95%B0%E5%92%8C%E5%88%86%E7%BB%84">&#x51FD;&#x6570;&#x548C;&#x5206;&#x7EC4;</h3>

<p><strong>&#x51FD;&#x6570;</strong></p>
<ul>
<li>&#x6570;&#x5B57;&#x51FD;&#x6570;<br>
ABS(x)   &#x8FD4;&#x56DE;x&#x7684;&#x7EDD;&#x5BF9;&#x503C;<br>
CEILING(x)   &#x8FD4;&#x56DE;&#x5927;&#x4E8E;x&#x7684;&#x6700;&#x5C0F;&#x6574;&#x6570;&#x503C;<br>
FLOOR(x)   &#x8FD4;&#x56DE;&#x5C0F;&#x4E8E;x&#x7684;&#x6700;&#x5927;&#x6574;&#x6570;&#x503C;<br>
MOD(x,y)    &#x8FD4;&#x56DE;x/y&#x7684;&#x6A21;&#xFF08;&#x4F59;&#x6570;&#xFF09;<br>
PI() &#x8FD4;&#x56DE;pi&#x7684;&#x503C;&#xFF08;&#x5706;&#x5468;&#x7387;&#xFF09;<br>
RAND() &#x8FD4;&#x56DE;&#xFF10;&#x5230;&#xFF11;&#x5185;&#x7684;&#x968F;&#x673A;&#x503C;<br>
ROUND(x,y) &#x8FD4;&#x56DE;&#x53C2;&#x6570;x&#x7684;&#x56DB;&#x820D;&#x4E94;&#x5165;&#x7684;&#x6709;y&#x4F4D;&#x5C0F;&#x6570;&#x7684;&#x503C;<br>
TRUNCATE(x,y)  &#x8FD4;&#x56DE;&#x6570;&#x5B57;x&#x622A;&#x77ED;&#x4E3A;y&#x4F4D;&#x5C0F;&#x6570;&#x7684;&#x7ED3;&#x679C;</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> CEIL<span class="token punctuation">(</span><span class="token number">1.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> employee
</pre><ul>
<li>&#x805A;&#x5408;&#x51FD;&#x6570;<br>
AVG(col) &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5217;&#x7684;&#x5E73;&#x5747;&#x503C;<br>
COUNT(col) &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5217;&#x4E2D;&#x975E;NULL&#x503C;&#x7684;&#x4E2A;&#x6570;<br>
MIN(col) &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5217;&#x7684;&#x6700;&#x5C0F;&#x503C;<br>
MAX(col) &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5217;&#x7684;&#x6700;&#x5927;&#x503C;<br>
SUM(col) &#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5217;&#x7684;&#x6240;&#x6709;&#x503C;&#x4E4B;&#x548C;</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">`</span>avg<span class="token punctuation">`</span><span class="token punctuation">,</span> id
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>

<span class="token comment">-- &#x67E5;&#x8BE2;&#x5458;&#x5DE5;&#x6570;&#x91CF;</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> &#x5458;&#x5DE5;&#x6570;&#x91CF;<span class="token punctuation">,</span>
<span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> &#x5E73;&#x5747;&#x85AA;&#x8D44;<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> &#x603B;&#x85AA;&#x8D44;<span class="token punctuation">,</span>
<span class="token function">min</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> &#x6700;&#x5C0F;&#x85AA;&#x8D44;
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>
</pre><ul>
<li>&#x5B57;&#x7B26;&#x548C;&#x65E5;&#x671F;&#x51FD;&#x6570;<br>
CONCAT(s1,s2...,sn) &#x5C06;s1,s2...,sn&#x8FDE;&#x63A5;&#x6210;&#x5B57;&#x7B26;&#x4E32;<br>
CONCAT_WS(sep,s1,s2...,sn) &#x5C06;s1,s2...,sn&#x8FDE;&#x63A5;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5E76;&#x7528;sep&#x5B57;&#x7B26;&#x95F4;&#x9694;<br>
TRIM(str) &#x53BB;&#x9664;&#x5B57;&#x7B26;&#x4E32;&#x9996;&#x90E8;&#x548C;&#x5C3E;&#x90E8;&#x7684;&#x6240;&#x6709;&#x7A7A;&#x683C;<br>
LTRIM(str) &#x4ECE;&#x5B57;&#x7B26;&#x4E32;str&#x4E2D;&#x5207;&#x6389;&#x5F00;&#x5934;&#x7684;&#x7A7A;&#x683C;<br>
RTRIM(str) &#x8FD4;&#x56DE;&#x5B57;&#x7B26;&#x4E32;str&#x5C3E;&#x90E8;&#x7684;&#x7A7A;&#x683C;</li>
</ul>
<p>CURDATE()&#x6216;CURRENT_DATE() &#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7684;&#x65E5;&#x671F;<br>
CURTIME()&#x6216;CURRENT_TIME() &#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7684;&#x65F6;&#x95F4;<br>
TIMESTAMPDIFF(part,  date1,date2) &#x8FD4;&#x56DE;date1&#x5230;date2&#x4E4B;&#x95F4;&#x76F8;&#x9694;&#x7684;part&#x503C;&#xFF0C;part&#x662F;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x7684;&#x76F8;&#x9694;&#x7684;&#x5E74;&#x6216;&#x6708;&#x6216;&#x65E5;&#x7B49;<br>
MICROSECOND<br>
SECOND<br>
MINUTE<br>
HOUR<br>
DAY<br>
WEEK<br>
MONTH<br>
QUARTER<br>
YEAR</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> CONCAT_WS<span class="token punctuation">(</span><span class="token string">&apos;@&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">DAY</span><span class="token punctuation">,</span><span class="token string">&apos;2010-1-1 11:11:11&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;2010-1-2 11:11:12&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> 
TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span> birthday<span class="token punctuation">,</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> age
<span class="token keyword">from</span> employee
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age<span class="token punctuation">;</span>
</pre><p><strong>&#x5206;&#x7EC4;</strong><br>
&#x8FD0;&#x884C;&#x987A;&#x5E8F;<br>
from<br>
join ... on ...<br>
where<br>
group by<br>
select<br>
having<br>
order by<br>
limit<br>
&#x5206;&#x7EC4;&#x540E;&#xFF0C;&#x53EA;&#x80FD;&#x67E5;&#x8BE2;&#x5206;&#x7EC4;&#x7684;&#x5217;&#x548C;&#x805A;&#x5408;&#x5217;</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- &#x67E5;&#x8BE2;&#x5458;&#x5DE5;&#x5206;&#x5E03;&#x7684;&#x5C45;&#x4F4F;&#x5730;&#xFF0C;&#x4EE5;&#x53CA;&#x6BCF;&#x4E2A;&#x5C45;&#x4F4F;&#x5730;&#x6709;&#x591A;&#x5C11;&#x540D;&#x5458;&#x5DE5;</span>
<span class="token comment">-- &#x5929;&#x5E9C;&#x4E09;&#x8857; 3</span>
<span class="token keyword">SELECT</span> location<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> empnumber
<span class="token keyword">FROM</span> employee
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> location
<span class="token keyword">HAVING</span> empnumber<span class="token operator">&gt;=</span><span class="token number">40</span>

<span class="token comment">-- &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x85AA;&#x6C34;&#x5728;10000&#x4EE5;&#x4E0A;&#x7684;&#x5458;&#x5DE5;&#x7684;&#x5206;&#x5E03;&#x7684;&#x5C45;&#x4F4F;&#x5730;&#xFF0C;&#x7136;&#x540E;&#x4EC5;&#x5F97;&#x5230;&#x805A;&#x96C6;&#x5730;&#x5927;&#x4E8E;30&#x7684;&#x7ED3;&#x679C;</span>
<span class="token keyword">SELECT</span> location<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> empnumber
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> salary<span class="token operator">&gt;=</span><span class="token number">10000</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> location
<span class="token keyword">HAVING</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">30</span>

</pre><p><strong>&#x7EC3;&#x4E60;&#x9898;</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- 1. &#x67E5;&#x8BE2;&#x6E21;&#x4E00;&#x6BCF;&#x4E2A;&#x90E8;&#x95E8;&#x7684;&#x5458;&#x5DE5;&#x6570;&#x91CF;</span>

<span class="token keyword">SELECT</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> number
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&apos;%&#x6E21;&#x4E00;%&apos;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> d<span class="token punctuation">.</span>id<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 2. &#x67E5;&#x8BE2;&#x6BCF;&#x4E2A;&#x516C;&#x53F8;&#x7684;&#x5458;&#x5DE5;&#x6570;&#x91CF;</span>

<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> number
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span>

<span class="token comment">-- 3. &#x67E5;&#x8BE2;&#x6240;&#x6709;&#x516C;&#x53F8;5&#x5E74;&#x5185;&#x5165;&#x804C;&#x7684;&#x5C45;&#x4F4F;&#x5728;&#x4E07;&#x5BB6;&#x6E7E;&#x7684;&#x5973;&#x5458;&#x5DE5;&#x6570;&#x91CF;</span>

<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> r<span class="token punctuation">.</span>number <span class="token operator">is</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token number">0</span> <span class="token keyword">ELSE</span> r<span class="token punctuation">.</span>number <span class="token keyword">END</span> <span class="token keyword">as</span> number
<span class="token keyword">FROM</span> company c <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> number
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">YEAR</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>joinDate<span class="token punctuation">,</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5</span>
<span class="token operator">AND</span> e<span class="token punctuation">.</span>location <span class="token operator">like</span> <span class="token string">&apos;%&#x4E07;&#x5BB6;&#x6E7E;%&apos;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">as</span> r <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> r<span class="token punctuation">.</span>id

<span class="token comment">-- 4. &#x67E5;&#x8BE2;&#x6E21;&#x4E00;&#x6240;&#x6709;&#x5458;&#x5DE5;&#x5206;&#x5E03;&#x5728;&#x54EA;&#x4E9B;&#x5C45;&#x4F4F;&#x5730;&#xFF0C;&#x6BCF;&#x4E2A;&#x5C45;&#x4F4F;&#x5730;&#x7684;&#x6570;&#x91CF;</span>

<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>location<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> empnumber
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">&apos;%&#x6E21;&#x4E00;%&apos;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> e<span class="token punctuation">.</span>location

<span class="token comment">-- 5. &#x67E5;&#x8BE2;&#x5458;&#x5DE5;&#x4EBA;&#x6570;&#x5927;&#x4E8E;200&#x7684;&#x516C;&#x53F8;&#x4FE1;&#x606F;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> company
<span class="token keyword">WHERE</span> id <span class="token operator">in</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>id
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span>
<span class="token keyword">HAVING</span> <span class="token function">count</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">200</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 6. &#x67E5;&#x8BE2;&#x6E21;&#x4E00;&#x516C;&#x53F8;&#x91CC;&#x6BD4;&#x5B83;&#x5E73;&#x5747;&#x5DE5;&#x8D44;&#x9AD8;&#x7684;&#x5458;&#x5DE5;</span>

<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">&apos;%&#x6E21;&#x4E00;%&apos;</span> <span class="token operator">AND</span>
e<span class="token punctuation">.</span>salary<span class="token operator">&gt;</span><span class="token punctuation">(</span>
<span class="token comment">-- &#x67E5;&#x8BE2;&#x6E21;&#x4E00;&#x7684;&#x5E73;&#x5747;&#x85AA;&#x8D44;</span>
<span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">&apos;%&#x6E21;&#x4E00;%&apos;</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 7. &#x67E5;&#x8BE2;&#x6E21;&#x4E00;&#x6240;&#x6709;&#x540D;&#x5B57;&#x4E3A;&#x4E24;&#x4E2A;&#x5B57;&#x548C;&#x4E09;&#x4E2A;&#x5B57;&#x7684;&#x5458;&#x5DE5;&#x5BF9;&#x5E94;&#x4EBA;&#x6570;</span>

<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">as</span> &#x59D3;&#x540D;&#x957F;&#x5EA6;<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>E<span class="token punctuation">.</span>ID<span class="token punctuation">)</span> <span class="token keyword">as</span> &#x5458;&#x5DE5;&#x6570;&#x91CF;
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">&apos;%&#x6E21;&#x4E00;%&apos;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> CHAR_LENGTH<span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">HAVING</span> &#x59D3;&#x540D;&#x957F;&#x5EA6; <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">-- 8. &#x67E5;&#x8BE2;&#x6BCF;&#x4E2A;&#x516C;&#x53F8;&#x6BCF;&#x4E2A;&#x6708;&#x7684;&#x603B;&#x652F;&#x51FA;&#x85AA;&#x6C34;&#xFF0C;&#x5E76;&#x6309;&#x7167;&#x4ECE;&#x4F4E;&#x5230;&#x9AD8;&#x6392;&#x5E8F;</span>

<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>salary<span class="token punctuation">)</span> <span class="token keyword">as</span> sumofsalary
<span class="token keyword">FROM</span> company <span class="token keyword">as</span> c <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> department <span class="token keyword">as</span> d <span class="token keyword">on</span> c<span class="token punctuation">.</span>id <span class="token operator">=</span> d<span class="token punctuation">.</span>companyId
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">as</span> e <span class="token keyword">on</span> d<span class="token punctuation">.</span>id <span class="token operator">=</span> e<span class="token punctuation">.</span>deptId
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sumofsalary
</pre><h1 class="mume-header" id="%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E5%92%8Corm">&#x6570;&#x636E;&#x9A71;&#x52A8;&#x548C;ORM</h1>

<h3 class="mume-header" id="mysql%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F">mysql&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;</h3>

<p><a href="https://github.com/sidorares/node-mysql2#readme">mysql2&#x7684;&#x4F7F;&#x7528;</a><br>
<code>npm install --save mysql2</code>&#x5B89;&#x88C5;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token method function property-access">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">&quot;ybybdwyJ42.&quot;</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">&quot;companydb&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// simple query</span>
<span class="token comment">// connection.query(&quot;SELECT * FROM `company`;&quot;, function (err, results) {</span>
<span class="token comment">//   //err&#x9519;&#x8BEF;</span>
<span class="token comment">//   //result&#x67E5;&#x8BE2;&#x7ED3;&#x679C;</span>
<span class="token comment">//   console.log(results); // results contains rows returned by server</span>
<span class="token comment">// });</span>

<span class="token comment">// connection.query(</span>
<span class="token comment">//   &quot;insert into company(`name`,location,buildDate) values(&apos;abbc&apos;, &apos;&#x963F;&#x8428;&#x5FB7;&apos;, curdate());&quot;,</span>
<span class="token comment">//   (err, result) =&gt; {</span>
<span class="token comment">//     console.log(result);</span>
<span class="token comment">//   }</span>
<span class="token comment">// );</span>

<span class="token comment">// connection.query(</span>
<span class="token comment">//   &quot;update company set `name`=&apos;bcd&apos; where id=4&quot;,</span>
<span class="token comment">//   (err, result) =&gt; {</span>
<span class="token comment">//     console.log(result);</span>
<span class="token comment">//   }</span>
<span class="token comment">// );</span>

connection<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>
    <span class="token string">&quot;delete from company where id=4&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>promise&#x7528;&#x6CD5;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql2/promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword control-flow">await</span> mysql<span class="token punctuation">.</span><span class="token method function property-access">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">&quot;ybybdwyJ42.&quot;</span><span class="token punctuation">,</span>
    database<span class="token operator">:</span> <span class="token string">&quot;companydb&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//   console.log(connection);</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> connection<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM `company`;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
  connection<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql2/promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token method function property-access">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">&quot;ybybdwyJ42.&quot;</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">&quot;companydb&quot;</span><span class="token punctuation">,</span>
  multipleStatements<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//&#x5F00;&#x542F;&#x6267;&#x884C;&#x591A;&#x4E86;sql&#x8BED;&#x53E5;&#xFF0C;&#x9ED8;&#x8BA4;&#x53EA;&#x80FD;&#x6267;&#x884C;&#x4E00;&#x4E2A;</span>
  waitForConnections<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//&#x662F;&#x5426;&#x7B49;&#x5F85;</span>
  connectionLimit<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">//&#x94FE;&#x63A5;&#x9650;&#x5236;&#x6570;&#x91CF;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;</span>
  <span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from employee where \`name\` like concat(&apos;%&apos;, ?, &apos;%&apos;) ;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> pool<span class="token punctuation">.</span><span class="token method function property-access">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8881;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x9632;&#x6B62;sql&#x6CE8;&#x5165;<br>
sql&#x6CE8;&#x5165;<br>
&#x7528;&#x6237;&#x901A;&#x8FC7;&#x6CE8;&#x5165;sql&#x8BED;&#x53E5;&#x5230;&#x6700;&#x7EC8;&#x67E5;&#x8BE2;&#x4E2D;&#xFF0C;&#x5BFC;&#x81F4;&#x4E86;&#x6574;&#x4E2A;sql&#x4E0E;&#x9884;&#x671F;&#x884C;&#x4E3A;&#x4E0D;&#x7B26;<br>
mysql&#x652F;&#x6301;&#x53D8;&#x91CF;<br>
&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4F5C;&#x4E3A;&#x4EFB;&#x4F55;sql&#x5173;&#x952E;&#x5B57;</p>
<h3 class="mume-header" id="sequelize%E7%AE%80%E4%BB%8B">Sequelize&#x7B80;&#x4ECB;</h3>

<p><a href="https://github.com/demopark/sequelize-docs-Zh-CN">Sequelize&#x7B80;&#x4ECB;</a></p>
<p>Object Relational Mapping &#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x6620;&#x5C04;&#xFF08;ORM&#xFF09;<br>
&#x901A;&#x8FC7;ORM&#x6846;&#x67B6;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x7684;&#x628A;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x548C;&#x6570;&#x636E;&#x5E93;&#x5173;&#x8054;<br>
ORM&#x6846;&#x67B6;&#x4F1A;&#x9690;&#x85CF;&#x5177;&#x4F53;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5E95;&#x5C42;&#x7EC6;&#x8282;&#xFF0C;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x63A5;&#x53E3;&#xFF0C;&#x5B8C;&#x6210;&#x5BF9;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x64CD;&#x4F5C;</p>
<p class="markdown-p-center">
  <img src="./assets/ORM&#x539F;&#x7406;&#x56FE;.jpg" alt="OPM&#x539F;&#x7406;&#x56FE;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  OPM&#x539F;&#x7406;&#x56FE;
</p>
<p>ORM&#x7684;&#x4F18;&#x52BF;<br>
&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4EC5;&#x9700;&#x5173;&#x5FC3;&#x5BF9;&#x8C61;<br>
&#x53EF;&#x8F7B;&#x6613;&#x7684;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x5E93;&#x7684;&#x79FB;&#x690D;<br>
&#x65E0;&#x987B;&#x62FC;&#x63A5;&#x590D;&#x6742;&#x7684;sql&#x8BED;&#x53E5;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x7CBE;&#x786E;&#x67E5;&#x8BE2;</p>
<h3 class="mume-header" id="%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89%E5%92%8C%E5%90%8C%E6%AD%A5">&#x6A21;&#x578B;&#x5B9A;&#x4E49;&#x548C;&#x540C;&#x6B65;</h3>

<p>&#x5B89;&#x88C5;sequelize<br>
<a href="https://github.com/demopark/sequelize-docs-Zh-CN">sequelize</a><br>
&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x5B89;&#x88C5;&#x9A71;&#x52A8;<br>
&#x9009;&#x62E9;&#x4EE5;&#x4E0B;&#x4E4B;&#x4E00;:</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ npm install --save pg pg-hstore # Postgres
$ npm install --save mysql2
$ npm install --save mariadb
$ npm install --save sqlite3
$ npm install --save tedious # Microsoft SQL Server
</code></pre><p>models/db.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Sequelize</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">&quot;myschooldb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ybybdwyJ42.&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
  dialect<span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
  logging<span class="token operator">:</span> <span class="token keyword null nil">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> sequelize<span class="token punctuation">;</span>
</pre><p>models/Admin.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">DataTypes</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#x5BF9;&#x8C61;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Admin</span> <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Admin&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    loginId<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    loginPwd<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    updatedAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//&#x4ECE;&#x6B64;&#x4EE5;&#x540E;&#xFF0C;&#x8BE5;&#x8868;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4F1A;&#x771F;&#x6B63;&#x7684;&#x5220;&#x9664;&#xFF0C;&#x800C;&#x662F;&#x589E;&#x52A0;&#x4E00;&#x5217;deletedAt&#xFF0C;&#x8BB0;&#x5F55;&#x5220;&#x9664;&#x7684;&#x65F6;&#x95F4;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">;</span>

</pre><p>models/Book.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">DataTypes</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Book&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    imgurl<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publishDate<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><p>models/Class.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">DataTypes</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Class&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    openDate<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    updatedAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">hasMany</span><span class="token punctuation">(</span><span class="token maybe-class-name">Student</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x5EFA;&#x7ACB;&#x5173;&#x7CFB;</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Class</span><span class="token punctuation">;</span>

</pre><p>models/aync.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x540C;&#x6B65;&#x6240;&#x6709;&#x6A21;&#x578B;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sequelize<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> alter<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6240;&#x6709;&#x6A21;&#x578B;&#x540C;&#x6B65;&#x5B8C;&#x6210;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9">&#x6A21;&#x578B;&#x7684;&#x589E;&#x5220;&#x6539;</h3>

<p class="markdown-p-center">
  <img src="./assets/&#x4E09;&#x5C42;&#x67B6;&#x6784;.jpg" alt="&#x540E;&#x7AEF;&#x7684;&#x4E09;&#x5C42;&#x6846;&#x67B6;&#xFF08;node&#xFF09;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  &#x540E;&#x7AEF;&#x7684;&#x4E09;&#x5C42;&#x6846;&#x67B6;&#xFF08;node&#xFF09;
</p>
<p><a href="https://github.com/demopark/sequelize-docs-Zh-CN">sequelize</a><br>
index.js(&#x6837;&#x4F8B;)</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// require(&quot;./models/sync&quot;);</span>

<span class="token comment">// &#x589E;&#x52A0;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Admin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models/Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// const ins = Admin.build({</span>
<span class="token comment">//   loginId: &quot;abc&quot;,</span>
<span class="token comment">//   loginPwd: &quot;123&quot;,</span>
<span class="token comment">// }); //&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#x5B9E;&#x4F8B;</span>
<span class="token comment">// ins.loginId = &quot;bcd&quot;;</span>
<span class="token comment">// ins.save().then(() =&gt; {</span>
<span class="token comment">//   console.log(&quot;&#x65B0;&#x5EFA;&#x7BA1;&#x7406;&#x5458;&#x6210;&#x529F;&quot;);</span>
<span class="token comment">// });</span>

<span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  loginId<span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
  loginPwd<span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ins</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>ins<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> ins<span class="token punctuation">.</span><span class="token property-access">loginId</span><span class="token punctuation">,</span> ins<span class="token punctuation">.</span><span class="token property-access">loginPwd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8868;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;service<br>
services/adminServices.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x7BA1;&#x7406;&#x5458;&#x521D;&#x59CB;&#x5316;</span>
<span class="token comment">// &#x5224;&#x65AD;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x7BA1;&#x7406;&#x5458;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7BA1;&#x7406;&#x5458;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Admin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addAdmin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">adminObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x5E94;&#x8BE5;&#x5224;&#x65AD;adminObj&#x7684;&#x5404;&#x79CD;&#x5C5E;&#x6027;&#x662F;&#x5426;&#x5408;&#x7406;&#xFF0C;&#x4EE5;&#x53CA;&#x8D26;&#x53F7;&#x662F;&#x5426;&#x5DF2;&#x5B58;&#x5728;</span>
  <span class="token keyword">const</span> ins <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span>adminObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> ins<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">deleteAdmin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">adminId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x65B9;&#x5F0F;1</span>
  <span class="token comment">//   // 1.&#x5F97;&#x5230;&#x5B9E;&#x4F8B;</span>
  <span class="token comment">//   const ins = await Admin.findByPk(adminId);</span>
  <span class="token comment">//   //   console.log(ins);</span>
  <span class="token comment">//   // 2.&#x5220;&#x9664;&#x5B9E;&#x4F8B;</span>
  <span class="token comment">//   if (ins) {</span>
  <span class="token comment">//     await ins.destroy();</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// &#x65B9;&#x5F0F;2</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> adminId<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">updateAdmin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> adminObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x65B9;&#x5F0F;1</span>
  <span class="token comment">// // 1. &#x5F97;&#x5230;&#x5B9E;&#x4F8B;</span>
  <span class="token comment">// const ins = await Admin.findByPk(id);</span>
  <span class="token comment">// ins.loginId = adminObj.loginId;</span>
  <span class="token comment">// // 2. &#x4FDD;&#x5B58;</span>
  <span class="token comment">// ins.save();</span>

  <span class="token comment">// &#x65B9;&#x5F0F;2</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>adminObj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>services/bookService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Book</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addBook</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ins <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> ins<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">deleteBook</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">updateBook</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</pre><p>services/classService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addClass</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ins <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> ins<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">deleteClass</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">updateClass</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</pre><p>index.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> adminServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./services/adminService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// adminServ.addAdmin({</span>
<span class="token comment">//   loginId: &quot;asdfasdfasdfssa&quot;,</span>
<span class="token comment">//   loginPwd: &quot;adsfasdfd&quot;,</span>
<span class="token comment">// });</span>

adminServ<span class="token punctuation">.</span><span class="token method function property-access">deleteAdmin</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// adminServ</span>
<span class="token comment">//   .updateAdmin(4, {</span>
<span class="token comment">//     loginId: &quot;aaaaaa&quot;,</span>
<span class="token comment">//   })</span>
<span class="token comment">//   .then((r) =&gt; {</span>
<span class="token comment">//     console.log(r);</span>
<span class="token comment">//   });</span>

</pre><h3 class="mume-header" id="%E6%95%B0%E6%8D%AE%E6%A8%A1%E6%8B%9F">&#x6570;&#x636E;&#x6A21;&#x62DF;</h3>

<p><a href="http://mockjs.com/">mockjs</a><br>
&#x5B89;&#x88C5;mockjs<br>
mock/mockClass.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Mock</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mockjs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token maybe-class-name">Mock</span><span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;datas|16&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;id|+1&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&quot;&#x524D;&#x7AEF;&#x7B2C; @id &#x671F;&quot;</span><span class="token punctuation">,</span>
      openDate<span class="token operator">:</span> <span class="token string">&quot;@date&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">datas</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">bulkCreate</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><p>mock/mockStudent.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Mock</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mockjs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token maybe-class-name">Mock</span><span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;datas|500-700&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;@cname&quot;</span><span class="token punctuation">,</span>
      birthdady<span class="token operator">:</span> <span class="token string">&quot;@date&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;sex|1-2&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      mobile<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">1\d{10}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token comment">//   location: &quot;@city(true)&quot;,</span>
      <span class="token string">&quot;ClassId|1-16&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">datas</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">bulkCreate</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x5C06;&#x6A21;&#x62DF;&#x7684;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5230;&#x6570;&#x636E;&#x5E93;</span>
</pre><h3 class="mume-header" id="%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96">&#x6570;&#x636E;&#x6293;&#x53D6;</h3>

<p><a href="https://github.com/axios/axios">axios</a><br>
axios<br>
&#x53D1;&#x9001;&#x4E00;&#x4E2A;http&#x8BF7;&#x6C42;&#xFF0C;&#x5F97;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x54CD;&#x5E94;&#x7ED3;&#x679C;<br>
&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x901A;&#x7528;<br>
<a href="https://github.com/cheeriojs/cheerio#readme">cheerio</a><br>
cheerio<br>
Jquery&#x7684;&#x6838;&#x5FC3;&#x5E93;<br>
&#x4E0E;dom&#x65E0;&#x5173;<br>
&#x5B89;&#x88C5; axios&#x548C;cheerio<br>
spider/fetchBooks.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x6293;&#x53D6;&#x8C46;&#x74E3;&#x8BFB;&#x4E66;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4FE1;&#x606F;</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cheerio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Book</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * &#x83B7;&#x53D6;&#x8C46;&#x74E3;&#x8BFB;&#x4E66;&#x7F51;&#x9875;&#x7684;&#x6E90;&#x4EE3;&#x7801;
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBooksHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://book.douban.com/latest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * &#x4ECE;&#x8C46;&#x74E3;&#x8BFB;&#x4E66;&#x4E2D;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x7F51;&#x9875;&#xFF0C;&#x5E76;&#x4ECE;&#x7F51;&#x9875;&#x4E2D;&#x5206;&#x6790;&#x51FA;&#x4E66;&#x7C4D;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x4E66;&#x7C4D;&#x7684;&#x8BE6;&#x60C5;&#x9875;&#x94FE;&#x63A5;&#x6570;&#x7EC4;
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBookLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getBooksHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token method function property-access">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> achorElements <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#content .grid-12-12 li a.cover&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> links <span class="token operator">=</span> achorElements
    <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> href <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token property-access">attribs</span><span class="token punctuation">[</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> href<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> links<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * &#x6839;&#x636E;&#x4E66;&#x7C4D;&#x8BE6;&#x60C5;&#x9875;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5F97;&#x5230;&#x8BE5;&#x4E66;&#x7C4D;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">detailUrl</span>
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBookDetail</span><span class="token punctuation">(</span><span class="token parameter">detailUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>detailUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token method function property-access">load</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> imgurl <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#mainpic .nbg img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> spans <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#info span.pl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> authorSpan <span class="token operator">=</span> spans<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4F5C;&#x8005;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> author <span class="token operator">=</span> authorSpan<span class="token punctuation">.</span><span class="token method function property-access">next</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> publishSpan <span class="token operator">=</span> spans<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">&quot;&#x51FA;&#x7248;&#x5E74;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> publishDate <span class="token operator">=</span> publishSpan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">nextSibling</span><span class="token punctuation">.</span><span class="token property-access">nodeValue</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    imgurl<span class="token punctuation">,</span>
    publishDate<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * &#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getBookLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x5F97;&#x5230;&#x4E66;&#x7C4D;&#x7684;&#x8BE6;&#x60C5;&#x9875;&#x5730;&#x5740;</span>
  <span class="token keyword">const</span> proms <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">link</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">getBookDetail</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>proms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * &#x5F97;&#x5230;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5E93;
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">saveToDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">bulkCreate</span><span class="token punctuation">(</span>books<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6293;&#x53D6;&#x6570;&#x636E;&#x5E76;&#x4FDD;&#x5B58;&#x5230;&#x4E86;&#x6570;&#x636E;&#x5E93;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">saveToDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2">&#x6570;&#x636E;&#x67E5;&#x8BE2;</h3>

<p><a href="https://github.com/demopark/sequelize-docs-Zh-CN">sequelize</a><br>
3-7. &#x6570;&#x636E;&#x67E5;&#x8BE2;<br>
&#x67E5;&#x8BE2;&#x5355;&#x4E2A;&#x6570;&#x636E;&#xFF1A;findOne<br>
&#x6309;&#x7167;&#x4E3B;&#x952E;&#x67E5;&#x8BE2;&#x5355;&#x4E2A;&#x6570;&#x636E;&#xFF1A;findByPK<br>
&#x67E5;&#x8BE2;&#x591A;&#x4E2A;&#x6570;&#x636E;&#xFF1A;findAll<br>
&#x67E5;&#x8BE2;&#x6570;&#x91CF;&#xFF1A;count<br>
&#x5305;&#x542B;&#x5173;&#x7CFB;&#xFF1A;include</p>
<p>models/relation.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x8BBE;&#x7F6E;&#x6A21;&#x578B;&#x5173;&#x7CFB;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">hasMany</span><span class="token punctuation">(</span><span class="token maybe-class-name">Student</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">belongsTo</span><span class="token punctuation">(</span><span class="token maybe-class-name">Class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>services/adminService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x7BA1;&#x7406;&#x5458;&#x521D;&#x59CB;&#x5316;</span>
<span class="token comment">// &#x5224;&#x65AD;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x7BA1;&#x7406;&#x5458;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7BA1;&#x7406;&#x5458;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Admin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getAdminById</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">findByPk</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">loginId<span class="token punctuation">,</span> loginPwd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  loginPwd <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>loginPwd<span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      loginId<span class="token punctuation">,</span>
      loginPwd<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span><span class="token property-access">loginId</span> <span class="token operator">===</span> loginId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>index.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models/relation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// require(&quot;./spider/fetchBooks&quot;);</span>
<span class="token keyword">const</span> adminServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./services/adminService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// adminServ.login(&quot;bcd&quot;, &quot;abc&quot;).then((r) =&gt; {</span>
<span class="token comment">//   console.log(r);</span>
<span class="token comment">// });</span>
adminServ<span class="token punctuation">.</span><span class="token method function property-access">getAdminById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>services/studentService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Op</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addStudent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">stuObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ins <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span>stuObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> ins<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getStudentById</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">findByPk</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getStudents</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  limit <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  sex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// const results = await Student.findAll({</span>
  <span class="token comment">//   offset: (page - 1) * limit,</span>
  <span class="token comment">//   limit: +limit,</span>
  <span class="token comment">// });</span>
  <span class="token comment">// const total = await Student.count()</span>
  <span class="token comment">// const datas = JSON.parse(JSON.stringify(results));</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   total,</span>
  <span class="token comment">//   datas</span>
  <span class="token comment">// }</span>
  <span class="token keyword">const</span> where <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>sex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    where<span class="token punctuation">.</span><span class="token property-access">sex</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>sex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    where<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span><span class="token maybe-class-name">Op</span><span class="token punctuation">.</span><span class="token property-access">like</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">findAndCountAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;birthdady&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    where<span class="token punctuation">,</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">,</span>
    limit<span class="token operator">:</span> <span class="token operator">+</span>limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    total<span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">,</span>
    datas<span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>index.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models/relation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// require(&quot;./spider/fetchBooks&quot;);</span>
<span class="token keyword">const</span> stuServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./services/studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stuServ<span class="token punctuation">.</span><span class="token method function property-access">getStudents</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;&#x79C0;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="md5%E5%8A%A0%E5%AF%86">MD5&#x52A0;&#x5BC6;</h3>

<p>&#x5355;&#x5411;&#x52A0;&#x5BC6;&#xFF0C;&#x52A0;&#x5BC6;&#x6210;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#xFF0C;hash&#x7B97;&#x6CD5;&#x7684;&#x4E00;&#x79CD;<br>
<a href="https://www.npmjs.com/package/md5">github&#x5730;&#x5740;</a><br>
services/adminService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> md5 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Admin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">loginId<span class="token punctuation">,</span> loginPwd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  loginPwd <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>loginPwd<span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      loginId<span class="token punctuation">,</span>
      loginPwd<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span><span class="token property-access">loginId</span> <span class="token operator">===</span> loginId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getAdmins</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Admin</span><span class="token punctuation">.</span><span class="token method function property-access">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="moment">moment</h3>

<p class="markdown-p-center">
  <img src="./assets/&#x65F6;&#x95F4;&#x5904;&#x7406;&#x6A21;&#x5F0F;.jpg" alt="&#x65F6;&#x95F4;&#x5904;&#x7406;&#x6A21;&#x5F0F;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  &#x65F6;&#x95F4;&#x5904;&#x7406;&#x6A21;&#x5F0F;
</p>
<p><a href="https://momentjs.com/">&#x5B98;&#x7F51;</a><br>
<a href="http://momentjs.cn/">&#x6C11;&#x95F4;&#x5B98;&#x7F51;</a></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;moment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
moment<span class="token punctuation">.</span><span class="token method function property-access">locale</span><span class="token punctuation">(</span><span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x5F97;&#x5230;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF0C;moment&#x5BF9;&#x8C61;</span>
<span class="token comment">// console.log(moment().toString());</span>
<span class="token comment">// console.log(moment.utc().toString());</span>

<span class="token comment">//&#x5F97;&#x5230;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x6233;</span>
<span class="token comment">// console.log(moment().valueOf(), +moment());</span>
<span class="token comment">// console.log(moment.utc().valueOf(), +moment.utc());</span>

<span class="token comment">//&#x6839;&#x636E;&#x6307;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x5F97;&#x5230;&#x65F6;&#x95F4;&#xFF0C;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#xFF1A;xxxx-xx-xx xxxx/xx/xx  &#x65F6;&#x95F4;&#x6233;</span>
<span class="token comment">// console.log(moment(0).toString(), +moment(0));</span>
<span class="token comment">// console.log(moment.utc(0).toString(), +moment.utc(0));</span>
<span class="token comment">// const value = &quot;1970-01-01 00:00:00&quot;;</span>
<span class="token comment">// console.log(moment(value).toString(), +moment(value));</span>
<span class="token comment">// console.log(moment.utc(value).toString(), +moment.utc(value));</span>

<span class="token comment">//&#x4F7F;&#x7528;&#x65E5;&#x671F;&#x4EE4;&#x724C;&#x8F6C;&#x6362;</span>
<span class="token comment">//&#x4EE4;&#x724C;&#x662F;&#x4E00;&#x4E2A;&#x683C;&#x5F0F;&#x5316;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A; &quot;YYYY-MM-DD HH:mm:ss&quot;</span>
<span class="token keyword">const</span> formats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YYYY-M-D H:m:s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// console.log(moment.utc(&quot;1970-01-01 00:00:00&quot;, formats, true).toString());</span>
<span class="token comment">// console.log(moment.utc(&quot;1970-1-1 0:0:0&quot;, formats, true).toString());</span>
<span class="token comment">// console.log(moment.utc(0, formats, true).toString());</span>
<span class="token comment">// const invalidMoment = moment.utc(</span>
<span class="token comment">//   &quot;Thu Jan 01 1970 00:00:00 GMT+0000&quot;,</span>
<span class="token comment">//   formats,</span>
<span class="token comment">//   true</span>
<span class="token comment">// );</span>
<span class="token comment">// console.log(invalidMoment.isValid()); // false</span>
<span class="token comment">// console.log(invalidMoment.toString());</span>
<span class="token comment">// console.log(+invalidMoment);</span>

<span class="token comment">// &#x663E;&#x793A;&#xFF08;&#x53D1;&#x751F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;</span>
<span class="token comment">// const m = moment.utc(&quot;2015-1-5 23:00:01&quot;, formats, true);</span>
<span class="token comment">// console.log(m.local().format(&quot;YYYY&#x5E74;MM&#x6708;DD&#x65E5; HH&#x70B9;mm&#x5206;ss&#x79D2;&quot;));</span>

<span class="token comment">// const m = moment(&quot;2015-1-5 23:00:01&quot;, formats, true);</span>
<span class="token comment">// const toServer = m.utc().format(&quot;YYYY-MM-DD HH:mm:ss&quot;);</span>
<span class="token comment">// console.log(toServer);</span>

<span class="token keyword">const</span> m <span class="token operator">=</span> moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span><span class="token string">&quot;2020-4-14 9:00:01&quot;</span><span class="token punctuation">,</span> formats<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token method function property-access">local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">fromNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81">&#x6570;&#x636E;&#x9A8C;&#x8BC1;</h3>

<p>&#x76F8;&#x5173;&#x5E93;<br>
<a href="https://github.com/validatorjs/validator.js">validator</a><br>
&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x67D0;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x67D0;&#x4E2A;&#x89C4;&#x5219;<br>
<a href="http://validatejs.org/">validate.js</a><br>
&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x6811;&#x5F62;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x67D0;&#x4E9B;&#x89C4;&#x5219;</p>
<p>models/relation.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x8BBE;&#x7F6E;&#x6A21;&#x578B;&#x5173;&#x7CFB;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">hasMany</span><span class="token punctuation">(</span><span class="token maybe-class-name">Student</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">belongsTo</span><span class="token punctuation">(</span><span class="token maybe-class-name">Class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>models/sync.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x540C;&#x6B65;&#x6240;&#x6709;&#x6A21;&#x578B;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sequelize<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> alter<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6240;&#x6709;&#x6A21;&#x578B;&#x540C;&#x6B65;&#x5B8C;&#x6210;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><p>models/init.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./relation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./sync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>services/init.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> validate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;validate.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;moment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

validate<span class="token punctuation">.</span><span class="token method function property-access">extend</span><span class="token punctuation">(</span>validate<span class="token punctuation">.</span><span class="token property-access">validators</span><span class="token punctuation">.</span><span class="token property-access">datetime</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * &#x8BE5;&#x51FD;&#x6570;&#x4F1A;&#x81EA;&#x52A8;&#x7528;&#x4E8E;&#x65E5;&#x671F;&#x683C;&#x5F0F;&#x8F6C;&#x6362;
   * &#x5B83;&#x4F1A;&#x5728;&#x9A8C;&#x8BC1;&#x65F6;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x5C06;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x4E3A;&#x65F6;&#x95F4;&#x6233;&#x8FD4;&#x56DE;
   * &#x5982;&#x679C;&#x65E0;&#x6CD5;&#x8F6C;&#x6362;&#xFF0C;&#x8FD4;&#x56DE;NaN
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">value</span> &#x4F20;&#x5165;&#x8981;&#x8F6C;&#x6362;&#x7684;&#x503C;
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">options</span> &#x9488;&#x5BF9;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x9A8C;&#x8BC1;&#x914D;&#x7F6E;
   */</span>
  <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> formats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YYYY-M-D H:m:s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token property-access">dateOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      formats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;YYYY-MM-DD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YYYY-M-D&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">+</span>moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> formats<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token doc-comment comment">/**
   * &#x7528;&#x6237;&#x663E;&#x793A;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x663E;&#x793A;&#x5B57;&#x7B26;&#x4E32;
   */</span>
  <span class="token function">format</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> format <span class="token operator">=</span> <span class="token string">&quot;YYYY-MM-DD&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span><span class="token property-access">dateOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      format <span class="token operator">+=</span> <span class="token string">&quot; HH:mm:ss&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>init.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./services/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>index.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> stuServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./services/studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stuServ
  <span class="token punctuation">.</span><span class="token method function property-access">addStudent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;adfd&quot;</span><span class="token punctuation">,</span>
    birthday<span class="token operator">:</span> <span class="token string">&quot;2010-3-5&quot;</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    mobile<span class="token operator">:</span> <span class="token string">&quot;15454545444&quot;</span><span class="token punctuation">,</span>
    <span class="token maybe-class-name">ClassId</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    deletedAt<span class="token operator">:</span> <span class="token string">&quot;2010-1-1&quot;</span><span class="token punctuation">,</span>
    a<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E8%AE%BF%E9%97%AE%E5%99%A8%E5%92%8C%E8%99%9A%E6%8B%9F%E5%AD%97%E6%AE%B5">&#x8BBF;&#x95EE;&#x5668;&#x548C;&#x865A;&#x62DF;&#x5B57;&#x6BB5;</h3>

<p>sequelize  get<br>
models/Student.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">DataTypes</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;moment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token method function property-access">define</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Student&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    birthday<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">getDataValue</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">VIRTUAL</span><span class="token punctuation">,</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> now <span class="token operator">=</span> moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> birth <span class="token operator">=</span> moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">birthday</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> now<span class="token punctuation">.</span><span class="token method function property-access">diff</span><span class="token punctuation">(</span>birth<span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x5F97;&#x5230;&#x4E24;&#x4E2A;&#x65E5;&#x671F;&#x7684;&#x5E74;&#x4EFD;&#x7684;&#x5DEE;&#x5F02;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">BOOLEAN</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mobile<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token maybe-class-name">DataTypes</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    updatedAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>services/studentService.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">Student</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Op</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Class</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/Class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;validate.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;moment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> pick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../util/propertyHelper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addStudent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">stuObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stuObj <span class="token operator">=</span> <span class="token function">pick</span><span class="token punctuation">(</span>stuObj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;birthday&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mobile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ClassId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>stuObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  validate<span class="token punctuation">.</span><span class="token property-access">validators</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">classExits</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Class</span><span class="token punctuation">.</span><span class="token method function property-access">findByPk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token string">&quot;is not exist&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> rule <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x9A8C;&#x8BC1;&#x89C4;&#x5219;</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      presence<span class="token operator">:</span> <span class="token punctuation">{</span>
        allowEmpty<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      length<span class="token operator">:</span> <span class="token punctuation">{</span>
        minimum<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        maximum<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    birthday<span class="token operator">:</span> <span class="token punctuation">{</span>
      presence<span class="token operator">:</span> <span class="token punctuation">{</span>
        allowEmpty<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      datetime<span class="token operator">:</span> <span class="token punctuation">{</span>
        dateOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        earliest<span class="token operator">:</span> <span class="token operator">+</span>moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">subtract</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        latest<span class="token operator">:</span> <span class="token operator">+</span>moment<span class="token punctuation">.</span><span class="token method function property-access">utc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">subtract</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span> <span class="token punctuation">{</span>
      presence<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mobile<span class="token operator">:</span> <span class="token punctuation">{</span>
      presence<span class="token operator">:</span> <span class="token punctuation">{</span>
        allowEmpty<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      format<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">1\d{10}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token maybe-class-name">ClassId</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      presence<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      numericality<span class="token operator">:</span> <span class="token punctuation">{</span>
        onlyInteger<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        strict<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      classExits<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> validate<span class="token punctuation">.</span><span class="token method function property-access">async</span><span class="token punctuation">(</span>stuObj<span class="token punctuation">,</span> rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ins <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span>stuObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> ins<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">deleteStudent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">updateStudent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getStudentById</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">findByPk</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getStudents</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  limit <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  sex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// const results = await Student.findAll({</span>
  <span class="token comment">//   offset: (page - 1) * limit,</span>
  <span class="token comment">//   limit: +limit,</span>
  <span class="token comment">// });</span>
  <span class="token comment">// const total = await Student.count()</span>
  <span class="token comment">// const datas = JSON.parse(JSON.stringify(results));</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   total,</span>
  <span class="token comment">//   datas</span>
  <span class="token comment">// }</span>
  <span class="token keyword">const</span> where <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>sex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    where<span class="token punctuation">.</span><span class="token property-access">sex</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>sex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    where<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span><span class="token maybe-class-name">Op</span><span class="token punctuation">.</span><span class="token property-access">like</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Student</span><span class="token punctuation">.</span><span class="token method function property-access">findAndCountAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;birthday&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    where<span class="token punctuation">,</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    offset<span class="token operator">:</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">,</span>
    limit<span class="token operator">:</span> <span class="token operator">+</span>limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    total<span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">,</span>
    datas<span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</h3>

<p><a href="https://log4js-node.github.io/log4js-node/">log4js</a><br>
&#x6982;&#x5FF5;<br>
level&#xFF1A;&#x65E5;&#x5FD7;&#x7EA7;&#x522B;<br>
&#x4F8B;&#x5982;&#x8C03;&#x8BD5;&#x65E5;&#x5FD7;&#x3001;&#x4FE1;&#x606F;&#x65E5;&#x5FD7;&#x3001;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x7B49;&#x7B49;<br>
&#x89C1;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x793A;&#x610F;&#x56FE;<br>
category&#xFF1A;&#x65E5;&#x5FD7;&#x5206;&#x7C7B;<br>
&#x4F8B;&#x5982;&#xFF1A;sql&#x65E5;&#x5FD7;&#x3001;&#x8BF7;&#x6C42;&#x65E5;&#x5FD7;&#x7B49;&#x7B49;<br>
appender&#xFF1A;&#x65E5;&#x5FD7;&#x51FA;&#x53E3;<br>
&#x5E94;&#x8BE5;&#x628A;&#x65E5;&#x5FD7;&#x5199;&#x5230;&#x54EA;&#xFF1F;<br>
&#x65E5;&#x5FD7;&#x7684;&#x4E66;&#x5199;&#x683C;&#x5F0F;&#x662F;&#x4EC0;&#x4E48;&#xFF08;layouts&#xFF09;</p>
<p class="markdown-p-center">
  <img src="./assets/log&#x7B49;&#x7EA7;.jpg" alt="log&#x7B49;&#x7EA7;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  log&#x7B49;&#x7EA7;
</p>
<p>models/db.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Sequelize</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sqlLogger <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../logger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">&quot;lby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123123&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
  dialect<span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">logging</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    sqlLogger<span class="token punctuation">.</span><span class="token method function property-access">debug</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> sequelize<span class="token punctuation">;</span>
</pre><p>loggle.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> log4js <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;log4js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

log4js<span class="token punctuation">.</span><span class="token method function property-access">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  appenders<span class="token operator">:</span> <span class="token punctuation">{</span>
    sql<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;sql&#x65E5;&#x5FD7;&#x51FA;&#x53E3;</span>
      type<span class="token operator">:</span> <span class="token string">&quot;dateFile&quot;</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;logging.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      maxLogSize<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">//&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x5927;&#x5B57;&#x8282;&#x6570;</span>
      keepFileExt<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      layout<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;pattern&quot;</span><span class="token punctuation">,</span>
        pattern<span class="token operator">:</span> <span class="token string">&quot;%c [%d{yyyy-MM-dd hh:mm:ss}] [%p]: %m%n&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;stdout&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  categories<span class="token operator">:</span> <span class="token punctuation">{</span>
    sql<span class="token operator">:</span> <span class="token punctuation">{</span>
      appenders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//&#x8BE5;&#x5206;&#x7C7B;&#x4F7F;&#x7528;&#x51FA;&#x53E3;sql&#x7684;&#x914D;&#x7F6E;&#x5199;&#x5165;&#x65E5;&#x5FD7;</span>
      level<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      appenders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      level<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  log4js<span class="token punctuation">.</span><span class="token method function property-access">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sqlLogger <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultLogger <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token property-access">sqlLogger</span> <span class="token operator">=</span> sqlLogger<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token property-access">logger</span> <span class="token operator">=</span> defaultLogger<span class="token punctuation">;</span>
</pre><h1 class="mume-header" id="express">express</h1>

<h3 class="mume-header" id="express%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">express&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;</h3>

<p><a href="http://expressjs.com/">express&#x5B98;&#x7F51;</a><br>
<a href="https://www.expressjs.com.cn/">express&#x6C11;&#x95F4;&#x7F51;&#x7AD9;</a></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;express&#x5E94;&#x7528;</span>
<span class="token comment">// app&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x51FD;&#x6570;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">5008</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listen on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;express&#x5E94;&#x7528;</span>

<span class="token comment">// &#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x6620;&#x5C04;&#xFF0C;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x548C;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x5747;&#x6EE1;&#x8DB3;&#x5339;&#x914D;&#xFF0C;&#x4EA4;&#x7ED9;&#x5904;&#x7406;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x5904;&#x7406;</span>
<span class="token comment">// app.&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;(&quot;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&quot;, &#x5904;&#x7406;&#x51FD;&#x6570;)</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/news/:id&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// req &#x548C; res &#x662F;&#x88AB;express&#x5C01;&#x88C5;&#x8FC7;&#x540E;&#x7684;&#x5BF9;&#x8C61;</span>
  <span class="token comment">// &#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x4FE1;&#x606F;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8BF7;&#x6C42;&#x5934;&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x5934;&#xFF0C;&#x5BF9;&#x8C61;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;params&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// &#x54CD;&#x5E94;</span>
  <span class="token comment">//   res.send({</span>
  <span class="token comment">//     id: 123,</span>
  <span class="token comment">//     name: &quot;&#x6210;&#x54E5;&quot;,</span>
  <span class="token comment">//     age: 18,</span>
  <span class="token comment">//   });</span>
  <span class="token comment">//   res.setHeader(&quot;a&quot;, &quot;123&quot;);</span>
  <span class="token comment">//   res.send([2, 3, 4]);</span>
  <span class="token comment">//   res.status(302).header(&quot;location&quot;, &quot;https://duyi.ke.qq.com&quot;).end();</span>
  <span class="token comment">//   res.status(302).location(&quot;https://duyi.ke.qq.com&quot;).end();</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">&quot;https://duyi.ke.qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5339;&#x914D;&#x4EFB;&#x4F55;get&#x8BF7;&#x6C42;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">5008</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listen on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="nodemon">nodemon</h3>

<p><a href="https://github.com/remy/nodemon#nodemon">nodemon</a><br>
nodemon&#x662F;&#x4E00;&#x4E2A;&#x76D1;&#x89C6;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x76D1;&#x63A7;&#x5DE5;&#x7A0B;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6587;&#x4EF6;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E00;&#x6BB5;&#x811A;&#x672C;<br>
npm i -D nodemon &#x5B89;&#x88C5;<br>
nodemon index.js&#x6267;&#x884C;&#x7A0B;&#x5E8F;<br>
nodemon -x npm run serve &#x6267;&#x884C;&#x811A;&#x672C;&#x8BED;&#x8A00;<br>
&#x914D;&#x7F6E;&#x6587;&#x4EF6;<br>
nodemon.json</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;package*.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodemon.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="express%E4%B8%AD%E9%97%B4%E4%BB%B6">express&#x4E2D;&#x95F4;&#x4EF6;</h3>

<p class="markdown-p-center">
  <img src="./assets/&#x4E2D;&#x95F4;&#x4EF6;&#x793A;&#x610F;&#x56FE;.jpg" alt="&#x4E2D;&#x95F4;&#x4EF6;&#x793A;&#x610F;&#x56FE;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  &#x4E2D;&#x95F4;&#x4EF6;&#x793A;&#x610F;&#x56FE;
</p>
<p>express&#x4E2D;&#x95F4;&#x4EF6;</p>
<ul>
<li>&#x5F53;&#x5339;&#x914D;&#x5230;&#x4E86;&#x8BF7;&#x6C42;&#x540E;<br>
&#x4EA4;&#x7ED9;&#x7B2C;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x51FD;&#x6570;&#x5904;&#x7406;<br>
&#x51FD;&#x6570;&#x4E2D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7684;&#x4EA4;&#x7ED9;&#x540E;&#x7EED;&#x4E2D;&#x95F4;&#x4EF6;&#x5904;&#x7406;</li>
<li>&#x4E2D;&#x95F4;&#x4EF6;&#x5904;&#x7406;&#x7684;&#x7EC6;&#x8282;
<ul>
<li>&#x5982;&#x679C;&#x540E;&#x7EED;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x4E86;&#x4E2D;&#x95F4;&#x4EF6;<br>
express&#x53D1;&#x73B0;&#x5982;&#x679C;&#x54CD;&#x5E94;&#x6CA1;&#x6709;&#x7ED3;&#x675F;<br>
express&#x4F1A;&#x54CD;&#x5E94;404</li>
<li>&#x5982;&#x679C;&#x4E2D;&#x95F4;&#x4EF6;&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;<br>
&#x4E0D;&#x4F1A;&#x505C;&#x6B62;&#x670D;&#x52A1;&#x5668;<br>
&#x76F8;&#x5F53;&#x4E8E;&#x8C03;&#x7528;&#x4E86; next(&#x9519;&#x8BEF;&#x5BF9;&#x8C61;)<br>
&#x5BFB;&#x627E;&#x540E;&#x7EED;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4E2D;&#x95F4;&#x4EF6;<br>
&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x54CD;&#x5E94;500<br>
routes/errorMiddleware.js</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x5904;&#x7406;&#x9519;&#x8BEF;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;</span>

module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> errObj <span class="token operator">=</span> <span class="token punctuation">{</span>
      code<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">?</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token operator">:</span> err<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>errObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</pre><p>routes/staticMiddleware.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x8BF4;&#x660E;&#x4F60;&#x8BF7;&#x6C42;&#x7684;&#x662F; api &#x63A5;&#x53E3;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x8BF4;&#x660E;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x662F;&#x9759;&#x6001;&#x8D44;&#x6E90;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;&#x9759;&#x6001;&#x8D44;&#x6E90;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>routes/init.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;express&#x5E94;&#x7528;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./staticMiddleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/news/abc&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;handler1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// throw new Error(&quot;abc&quot;)</span>
  <span class="token comment">// &#x76F8;&#x5F53;&#x4E8E; next(new Error(&quot;abc&quot;))</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//   next();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//&#x80FD;&#x5339;&#x914D;  /news  /news/abc   /news/123   /news/ab/adfs</span>
<span class="token comment">//&#x4E0D;&#x80FD;&#x5339;&#x914D;  /n   /a   /   /newsabc</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&quot;/news&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./errorMiddleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">5008</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listen on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6">&#x5E38;&#x7528;&#x4E2D;&#x95F4;&#x4EF6;</h3>

<ul>
<li>express.static()</li>
<li>express.json()<br>
&#x6CE8;&#x610F;&#xFF1A;&#x9664;&#x4E86;&#x9519;&#x8BEF;&#x7EA7;&#x522B;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x8DEF;&#x7531;&#x4E4B;&#x524D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;<br>
&#x901A;&#x8FC7; express.json() &#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x89E3;&#x6790;&#x8868;&#x5355;&#x4E2D;&#x7684; JSON &#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;</li>
<li>express.urlencoded()<br>
&#x901A;&#x8FC7; express.urlencoded() &#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x6765;&#x89E3;&#x6790;&#x8868;&#x5355;&#x4E2D;&#x7684; url-encoded &#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;</li>
</ul>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;express&#x5E94;&#x7528;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> staticRoot <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * &#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x4F5C;&#x7528;&#xFF1A;
 * &#x5F53;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;(req.path)&#xFF0C;&#x4ECE;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#x5BFB;&#x627E;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#xFF0C;&#x76F4;&#x63A5;&#x54CD;&#x5E94;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x518D;&#x79FB;&#x4EA4;&#x7ED9;&#x540E;&#x7EED;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;
 * &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x79FB;&#x4EA4;&#x7ED9;&#x540E;&#x7EED;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x5904;&#x7406;
 * &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x6620;&#x5C04;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x5219;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;index.html&#x6587;&#x4EF6;
 */</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span>staticRoot<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.use(&quot;/static&quot;, (req, res) =&gt; {</span>
<span class="token comment">//   console.log(req.baseUrl, req.path);</span>
<span class="token comment">// });</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.use(require(&quot;./myUrlEncoded&quot;));</span>

app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&quot;/api/student&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./errorMiddleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">5008</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server listen on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="express%E8%B7%AF%E7%94%B1">express&#x8DEF;&#x7531;</h3>

<p>routes/getSendResults.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getErr</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err <span class="token operator">=</span> <span class="token string">&quot;server internal error&quot;</span><span class="token punctuation">,</span> errCode <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> errCode<span class="token punctuation">,</span>
    msg<span class="token operator">:</span> err<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getResult</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> result<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>exports<span class="token punctuation">.</span><span class="token method function property-access">getResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>routes/api/student.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stuServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../services/studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> asyncHandler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../getSendResult&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> limit <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">limit</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sex <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">sex</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">getStudents</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/:id&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">getStudentById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">addStudent</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/:id&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">deleteStudent</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/:id&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">updateStudent</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="cookie%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">cookie&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;</h3>

<h4 class="mume-header" id="%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%A4%A7%E4%B8%8D%E5%B0%8F%E7%9A%84%E9%97%AE%E9%A2%98">&#x4E00;&#x4E2A;&#x4E0D;&#x5927;&#x4E0D;&#x5C0F;&#x7684;&#x95EE;&#x9898;</h4>

<p>&#x5047;&#x8BBE;&#x670D;&#x52A1;&#x5668;&#x6709;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x5458;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x4E0D;&#x662F;&#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x6709;&#x6743;&#x529B;&#x505A;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x7684;</p>
<p>&#x90A3;&#x4E48;&#x670D;&#x52A1;&#x5668;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x8BF7;&#x6C42;&#x63A5;&#x53E3;&#x7684;&#x4EBA;&#x662F;&#x6709;&#x6743;&#x529B;&#x7684;&#x5462;&#xFF1F;</p>
<p>&#x7B54;&#x6848;&#x662F;&#xFF1A;&#x53EA;&#x6709;&#x767B;&#x5F55;&#x8FC7;&#x7684;&#x7BA1;&#x7406;&#x5458;&#x624D;&#x80FD;&#x505A;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;</p>
<p>&#x53EF;&#x95EE;&#x9898;&#x662F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4F20;&#x8F93;&#x4F7F;&#x7528;&#x7684;&#x662F;http&#x534F;&#x8BAE;&#xFF0C;http&#x534F;&#x8BAE;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x4EC0;&#x4E48;&#x53EB;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x662F;<strong>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x4EBA;&#xFF0C;&#x8DDF;&#x4E4B;&#x524D;&#x767B;&#x5F55;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x7684;&#x4EBA;&#x662F;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x4EBA;</strong></p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200417161014030.png" alt style="max-width:100%">
</p>
<p class="markdown-img-description">
</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200417161244373.png" alt style="max-width:100%">
</p>
<p class="markdown-img-description">
</p>
<p>&#x7531;&#x4E8E;http&#x534F;&#x8BAE;&#x7684;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x670D;&#x52A1;&#x5668;<strong>&#x5FD8;&#x8BB0;</strong>&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x8FD9;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x767B;&#x5F55;&#x6210;&#x529F;&#x7684;&#x90A3;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<blockquote>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x670D;&#x52A1;&#x5668;&#x60F3;&#x8C61;&#x6210;&#x6709;&#x7740;&#x4E25;&#x91CD;&#x8138;&#x76F2;&#x75C7;&#x7684;&#x4E1C;&#x54E5;&#xFF0C;&#x4ED6;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5206;&#x6E05;&#x695A;&#x8DDF;&#x4ED6;&#x8BF4;&#x8BDD;&#x7684;&#x4EBA;&#x4E4B;&#x524D;&#x505A;&#x8FC7;&#x4EC0;&#x4E48;</p>
</blockquote>
<p>&#x4E8E;&#x662F;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x60F3;&#x4E86;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;</p>
<p>&#x5B83;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x6765;&#x8BA4;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8EAB;&#x4EFD;</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x4E2A;&#x51FA;&#x5165;&#x8BC1;&#xFF08;&#x4EE4;&#x724C; token&#xFF09;</li>
<li>&#x540E;&#x7EED;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x5FC5;&#x987B;&#x8981;&#x9644;&#x5E26;&#x8FD9;&#x4E2A;&#x51FA;&#x5165;&#x8BC1;&#xFF08;&#x4EE4;&#x724C; token&#xFF09;</li>
</ol>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200417161950450.png" alt style="max-width:100%">
</p>
<p class="markdown-img-description">
</p>
<p>&#x670D;&#x52A1;&#x5668;&#x53D1;&#x626C;&#x4E86;&#x8BA4;&#x8BC1;&#x4E0D;&#x8BA4;&#x4EBA;&#x7684;&#x4F18;&#x826F;&#x4F20;&#x7EDF;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x8F7B;&#x677E;&#x7684;&#x8BC6;&#x522B;&#x8EAB;&#x4EFD;&#x4E86;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x80FD;&#x53EA;&#x5728;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x767B;&#x5F55;&#xFF0C;&#x4E8E;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5404;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x51FA;&#x5165;&#x8BC1;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5C31;&#x8981;&#x6C42;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;&#x5361;&#x5305;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x80FD;&#x591F;&#x5177;&#x5907;&#x4E0B;&#x9762;&#x7684;&#x529F;&#x80FD;&#xFF1A;</p>
<ol>
<li><strong>&#x80FD;&#x591F;&#x5B58;&#x653E;&#x591A;&#x4E2A;&#x51FA;&#x5165;&#x8BC1;</strong>&#x3002;&#x8FD9;&#x4E9B;&#x51FA;&#x5165;&#x8BC1;&#x6765;&#x81EA;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x6709;&#x591A;&#x4E2A;&#x51FA;&#x5165;&#x8BC1;&#xFF0C;&#x5206;&#x522B;&#x7528;&#x4E8E;&#x51FA;&#x5165;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;</li>
<li><strong>&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x51FA;&#x793A;&#x51FA;&#x5165;&#x8BC1;</strong>&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7AD9;&#x65F6;&#xFF0C;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x7684;&#x628A;&#x5BF9;&#x5E94;&#x7684;&#x51FA;&#x5165;&#x8BC1;&#x9644;&#x5E26;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x3002;</li>
<li><strong>&#x6B63;&#x786E;&#x7684;&#x51FA;&#x793A;&#x51FA;&#x5165;&#x8BC1;</strong>&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x80FD;&#x5C06;&#x80AF;&#x5FB7;&#x57FA;&#x7684;&#x51FA;&#x5165;&#x8BC1;&#x53D1;&#x9001;&#x7ED9;&#x9EA6;&#x5F53;&#x52B3;&#x3002;</li>
<li><strong>&#x7BA1;&#x7406;&#x51FA;&#x5165;&#x8BC1;&#x7684;&#x6709;&#x6548;&#x671F;</strong>&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x7684;&#x53D1;&#x73B0;&#x90A3;&#x4E9B;&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#x7684;&#x51FA;&#x5165;&#x8BC1;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x4ECE;&#x5361;&#x5305;&#x5185;&#x79FB;&#x9664;&#x3002;</li>
</ol>
<p>&#x80FD;&#x591F;&#x6EE1;&#x8DB3;&#x4E0A;&#x9762;&#x6240;&#x6709;&#x8981;&#x6C42;&#x7684;&#xFF0C;&#x5C31;&#x662F;cookie</p>
<p>cookie&#x7C7B;&#x4F3C;&#x4E8E;&#x4E00;&#x4E2A;&#x5361;&#x5305;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x5404;&#x79CD;&#x51FA;&#x5165;&#x8BC1;&#xFF0C;&#x5E76;&#x6709;&#x7740;&#x4E00;&#x5957;&#x673A;&#x5236;&#x6765;&#x81EA;&#x52A8;&#x7BA1;&#x7406;&#x8FD9;&#x4E9B;&#x8BC1;&#x4EF6;&#x3002;</p>
<p>&#x5361;&#x5305;&#x5185;&#x7684;&#x6BCF;&#x4E00;&#x5F20;&#x5361;&#x7247;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A;<strong>&#x4E00;&#x4E2A;cookie</strong>&#x3002;</p>
<h4 class="mume-header" id="cookie%E7%9A%84%E7%BB%84%E6%88%90">cookie&#x7684;&#x7EC4;&#x6210;</h4>

<p>cookie&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7279;&#x6709;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x5B83;&#x5C31;&#x50CF;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x4E13;&#x5C5E;&#x5361;&#x5305;&#xFF0C;&#x7BA1;&#x7406;&#x7740;&#x5404;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x8EAB;&#x4EFD;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;cookie&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x5C5E;&#x4E8E;&#x67D0;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x4E00;&#x4E2A;&#x5361;&#x7247;&#xFF0C;&#x5B83;&#x8BB0;&#x5F55;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li>key&#xFF1A;&#x952E;&#xFF0C;&#x6BD4;&#x5982;&#x300C;&#x8EAB;&#x4EFD;&#x7F16;&#x53F7;&#x300D;</li>
<li>value&#xFF1A;&#x503C;&#xFF0C;&#x6BD4;&#x5982;&#x8881;&#x5C0F;&#x8FDB;&#x7684;&#x8EAB;&#x4EFD;&#x7F16;&#x53F7;&#x300C;14563D1550F2F76D69ECBF4DD54ABC95&#x300D;&#xFF0C;&#x8FD9;&#x6709;&#x70B9;&#x50CF;&#x5361;&#x7247;&#x7684;&#x6761;&#x5F62;&#x7801;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;</li>
<li>domain&#xFF1A;&#x57DF;&#xFF0C;&#x8868;&#x8FBE;&#x8FD9;&#x4E2A;cookie&#x662F;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#xFF0C;&#x6BD4;&#x5982;<code>yuanjin.tech</code>&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;cookie&#x662F;&#x5C5E;&#x4E8E;<code>yuanjin.tech</code>&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;</li>
<li>path&#xFF1A;&#x8DEF;&#x5F84;&#xFF0C;&#x8868;&#x8FBE;&#x8FD9;&#x4E2A;cookie&#x662F;&#x5C5E;&#x4E8E;&#x8BE5;&#x7F51;&#x7AD9;&#x7684;&#x54EA;&#x4E2A;&#x57FA;&#x8DEF;&#x5F84;&#x7684;&#xFF0C;&#x5C31;&#x597D;&#x6BD4;&#x662F;&#x540C;&#x4E00;&#x5BB6;&#x516C;&#x53F8;&#x4E0D;&#x540C;&#x90E8;&#x95E8;&#x4F1A;&#x9881;&#x53D1;&#x4E0D;&#x540C;&#x7684;&#x51FA;&#x5165;&#x8BC1;&#x3002;&#x6BD4;&#x5982;<code>/news</code>&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;cookie&#x5C5E;&#x4E8E;<code>/news</code>&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x3002;&#xFF08;&#x540E;&#x7EED;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#xFF09;</li>
<li>secure&#xFF1A;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x5B89;&#x5168;&#x4F20;&#x8F93;&#xFF08;&#x540E;&#x7EED;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#xFF09;</li>
<li>expire&#xFF1A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x8868;&#x793A;&#x8BE5;cookie&#x5728;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x8FC7;&#x671F;</li>
</ul>
<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x4F1A;&#x7784;&#x4E00;&#x773C;&#x81EA;&#x5DF1;&#x7684;&#x5361;&#x5305;&#xFF0C;&#x770B;&#x770B;&#x54EA;&#x4E9B;&#x5361;&#x7247;&#x9002;&#x5408;&#x9644;&#x5E26;&#x634E;&#x7ED9;&#x670D;&#x52A1;&#x5668;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;cookie<strong>&#x540C;&#x65F6;&#x6EE1;&#x8DB3;</strong>&#x4EE5;&#x4E0B;&#x6761;&#x4EF6;&#xFF0C;&#x5219;&#x8FD9;&#x4E2A;cookie&#x4F1A;&#x88AB;&#x9644;&#x5E26;&#x5230;&#x8BF7;&#x6C42;&#x4E2D;</p>
<ul>
<li>cookie&#x6CA1;&#x6709;&#x8FC7;&#x671F;</li>
<li>cookie&#x4E2D;&#x7684;&#x57DF;&#x548C;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x57DF;&#x662F;&#x5339;&#x914D;&#x7684;
<ul>
<li>&#x6BD4;&#x5982;cookie&#x4E2D;&#x7684;&#x57DF;&#x662F;<code>yuanjin.tech</code>&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x7684;&#x8BF7;&#x6C42;&#x57DF;&#x662F;<code>yuanjin.tech</code>&#x3001;<code>www.yuanjin.tech</code>&#x3001;<code>blogs.yuanjin.tech</code>&#x7B49;&#x7B49;</li>
<li>&#x6BD4;&#x5982;cookie&#x4E2D;&#x7684;&#x57DF;&#x662F;<code>www.yuanjin.tech</code>&#xFF0C;&#x5219;&#x53EA;&#x80FD;&#x5339;&#x914D;<code>www.yuanjin.tech</code>&#x8FD9;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#x57DF;</li>
<li>cookie&#x662F;&#x4E0D;&#x5728;&#x4E4E;&#x7AEF;&#x53E3;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x57DF;&#x5339;&#x914D;&#x5373;&#x53EF;</li>
</ul>
</li>
<li>cookie&#x4E2D;&#x7684;path&#x548C;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x7684;path&#x662F;&#x5339;&#x914D;&#x7684;
<ul>
<li>&#x6BD4;&#x5982;cookie&#x4E2D;&#x7684;path&#x662F;<code>/news</code>&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x7684;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x53EF;&#x4EE5;&#x662F;<code>/news</code>&#x3001;<code>/news/detail</code>&#x3001;<code>/news/a/b/c</code>&#x7B49;&#x7B49;&#xFF0C;&#x4F46;&#x4E0D;&#x80FD;&#x5339;&#x914D;<code>/blogs</code></li>
<li>&#x5982;&#x679C;cookie&#x7684;path&#x662F;<code>/</code>&#xFF0C;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#xFF0C;&#x80FD;&#x591F;&#x5339;&#x914D;&#x6240;&#x6709;&#x7684;&#x8DEF;&#x5F84;</li>
</ul>
</li>
<li>&#x9A8C;&#x8BC1;cookie&#x7684;&#x5B89;&#x5168;&#x4F20;&#x8F93;
<ul>
<li>&#x5982;&#x679C;cookie&#x7684;secure&#x5C5E;&#x6027;&#x662F;true&#xFF0C;&#x5219;&#x8BF7;&#x6C42;&#x534F;&#x8BAE;&#x5FC5;&#x987B;&#x662F;<code>https</code>&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x4F1A;&#x53D1;&#x9001;&#x8BE5;cookie</li>
<li>&#x5982;&#x679C;cookie&#x7684;secure&#x5C5E;&#x6027;&#x662F;false&#xFF0C;&#x5219;&#x8BF7;&#x6C42;&#x534F;&#x8BAE;&#x53EF;&#x4EE5;&#x662F;<code>http</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;<code>https</code></li>
</ul>
</li>
</ul>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;cookie&#x6EE1;&#x8DB3;&#x4E86;&#x4E0A;&#x8FF0;&#x7684;&#x6240;&#x6709;&#x6761;&#x4EF6;&#xFF0C;&#x5219;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x628A;&#x5B83;&#x81EA;&#x52A8;&#x52A0;&#x5165;&#x5230;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x4E2D;</p>
<p>&#x5177;&#x4F53;&#x52A0;&#x5165;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;<strong>&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5C06;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;cookie&#xFF0C;&#x81EA;&#x52A8;&#x653E;&#x7F6E;&#x5230;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;</strong>&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8BBF;&#x95EE;&#x767E;&#x5EA6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x5728;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x9644;&#x5E26;&#x4E86;&#x4E0B;&#x9762;&#x7684;cookie&#xFF1A;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200417170328584.png" alt style="max-width:100%">
</p>
<p class="markdown-img-description">
</p>
<p>&#x770B;&#x5230;&#x6253;&#x9A6C;&#x8D5B;&#x514B;&#x7684;&#x5730;&#x65B9;&#x4E86;&#x5417;&#xFF1F;&#x8FD9;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x5934;<code>cookie</code>&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#xFF0C;&#x5B83;&#x7684;&#x683C;&#x5F0F;&#x662F;<code>&#x952E;=&#x503C;; &#x952E;=&#x503C;; &#x952E;=&#x503C;; ...</code>&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;cookie&#x3002;</p>
<p>**cookie&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x91CD;&#x8981;&#x7684;&#x8EAB;&#x4EFD;&#x4FE1;&#x606F;&#xFF0C;&#x6C38;&#x8FDC;&#x4E0D;&#x8981;&#x628A;&#x4F60;&#x7684;cookie&#x6CC4;&#x9732;&#x7ED9;&#x522B;&#x4EBA;&#xFF01;&#xFF01;&#xFF01;**&#x5426;&#x5219;&#xFF0C;&#x4ED6;&#x4EBA;&#x5C31;&#x62FF;&#x5230;&#x4E86;&#x4F60;&#x7684;&#x8BC1;&#x4EF6;&#xFF0C;&#x6709;&#x4E86;&#x8BC1;&#x4EF6;&#xFF0C;&#x5C31;&#x5177;&#x5907;&#x4E86;&#x4E3A;&#x6240;&#x6B32;&#x4E3A;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;</p>
<h4 class="mume-header" id="%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEcookie">&#x5982;&#x4F55;&#x8BBE;&#x7F6E;cookie</h4>

<p>&#x7531;&#x4E8E;cookie&#x662F;&#x4FDD;&#x5B58;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x7684;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x5F88;&#x591A;&#x8BC1;&#x4EF6;&#x53C8;&#x662F;&#x670D;&#x52A1;&#x5668;&#x9881;&#x53D1;&#x7684;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;cookie&#x7684;&#x8BBE;&#x7F6E;&#x6709;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#xFF1A;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x662F;&#x975E;&#x5E38;&#x666E;&#x904D;&#x7684;&#xFF0C;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x51B3;&#x5B9A;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x9881;&#x53D1;&#x4E00;&#x4E2A;&#x8BC1;&#x4EF6;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x54CD;&#x5E94;&#x7684;&#x6D88;&#x606F;&#x4E2D;&#x5305;&#x542B;cookie&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x7684;&#x628A;cookie&#x4FDD;&#x5B58;&#x5230;&#x5361;&#x5305;&#x4E2D;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x81EA;&#x884C;&#x8BBE;&#x7F6E;&#xFF1A;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x5C11;&#x89C1;&#x4E00;&#x4E9B;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x5173;&#x95ED;&#x4E86;&#x67D0;&#x4E2A;&#x5E7F;&#x544A;&#xFF0C;&#x5E76;&#x9009;&#x62E9;&#x4E86;&#x300C;&#x4EE5;&#x540E;&#x4E0D;&#x8981;&#x518D;&#x5F39;&#x51FA;&#x300D;&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x79CD;&#x5C0F;&#x4FE1;&#x606F;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x7684;JS&#x4EE3;&#x7801;&#x4FDD;&#x5B58;&#x5230;cookie&#x4E2D;&#x3002;&#x540E;&#x7EED;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x770B;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x60F3;&#x8981;&#x518D;&#x6B21;&#x5F39;&#x51FA;&#x5E7F;&#x544A;&#x7684;cookie&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x53D1;&#x9001;&#x5E7F;&#x544A;&#x8FC7;&#x6765;&#x4E86;&#x3002;</li>
</ul>
<h5 class="mume-header" id="%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AE%BE%E7%BD%AEcookie">&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8BBE;&#x7F6E;cookie</h5>

<p>&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x54CD;&#x5E94;&#x5934;&#xFF0C;&#x6765;&#x544A;&#x8BC9;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;cookie</p>
<p>&#x54CD;&#x5E94;&#x5934;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x683C;&#x5F0F;&#x8BBE;&#x7F6E;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml"><span class="token key atrule">set-cookie</span><span class="token punctuation">:</span> cookie1
<span class="token key atrule">set-cookie</span><span class="token punctuation">:</span> cookie2
<span class="token key atrule">set-cookie</span><span class="token punctuation">:</span> cookie3
<span class="token punctuation">...</span>
</pre><p>&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x6B21;&#x54CD;&#x5E94;&#x4E2D;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;cookie&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x8BBE;&#x7F6E;&#x591A;&#x5C11;&#x4E2A;cookie&#xFF0C;&#x8BBE;&#x7F6E;&#x4EC0;&#x4E48;cookie&#xFF0C;&#x6839;&#x636E;&#x4F60;&#x7684;&#x9700;&#x8981;&#x81EA;&#x884C;&#x5904;&#x7406;</p>
<p>&#x5176;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;cookie&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>&#x952E;=&#x503C;; path=?; domain=?; expire=?; max-age=?; secure; httponly
</code></pre><p>&#x6BCF;&#x4E2A;cookie&#x9664;&#x4E86;&#x952E;&#x503C;&#x5BF9;&#x662F;&#x5FC5;&#x987B;&#x8981;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x987A;&#x5E8F;&#x4E0D;&#x9650;</p>
<p>&#x5F53;&#x8FD9;&#x6837;&#x7684;&#x54CD;&#x5E94;&#x5934;&#x5230;&#x8FBE;&#x5BA2;&#x6237;&#x7AEF;&#x540E;&#xFF0C;<strong>&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x7684;&#x5C06;cookie&#x4FDD;&#x5B58;&#x5230;&#x5361;&#x5305;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5361;&#x5305;&#x4E2D;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E00;&#x6A21;&#x4E00;&#x6837;&#x7684;&#x5361;&#x7247;&#xFF08;&#x5176;&#x4ED6;key&#x3001;path&#x3001;domain&#x76F8;&#x540C;&#xFF09;&#xFF0C;&#x5219;&#x4F1A;&#x81EA;&#x52A8;&#x7684;&#x8986;&#x76D6;&#x4E4B;&#x524D;&#x7684;&#x8BBE;&#x7F6E;</strong>&#x3002;</p>
<p>&#x4E0B;&#x9762;&#xFF0C;&#x4F9D;&#x6B21;&#x8BF4;&#x660E;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x503C;&#xFF1A;</p>
<ul>
<li><strong>path</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5C06;&#x5176;&#x81EA;&#x52A8;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x5740;&#x662F;<code>/login</code>&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E86;&#x4E00;&#x4E2A;<code>set-cookie: a=1</code>&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5C06;&#x8BE5;cookie&#x7684;path&#x8BBE;&#x7F6E;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;&#x8DEF;&#x5F84;<code>/login</code></li>
<li><strong>domain</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x7684;&#x57DF;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;&#x57DF;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x5740;&#x662F;<code>http://www.yuanjin.tech</code>&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E86;&#x4E00;&#x4E2A;<code>set-cookie: a=1</code>&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5C06;&#x8BE5;cookie&#x7684;domain&#x8BBE;&#x7F6E;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;&#x57DF;<code>www.yuanjin.tech</code>
<ul>
<li>&#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E86;&#x4E00;&#x4E2A;&#x65E0;&#x6548;&#x7684;&#x57DF;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E0D;&#x8BA4;&#x7684;</li>
<li>&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x6548;&#x7684;&#x57DF;&#xFF1F;&#x5C31;&#x662F;&#x54CD;&#x5E94;&#x7684;&#x57DF;&#x8FDE;&#x6839;&#x57DF;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x7684;&#x57DF;&#x662F;<code>yuanjin.tech</code>&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x7684;cookie&#x662F;<code>set-cookie: a=1; domain=baidu.com</code>&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x57DF;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E0D;&#x8BA4;&#x7684;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x8FDE;&#x8FD9;&#x6837;&#x7684;&#x60C5;&#x51B5;&#x90FD;&#x5141;&#x8BB8;&#xFF0C;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5F20;&#x4E09;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6709;&#x6743;&#x5229;&#x7ED9;&#x7528;&#x6237;&#x4E00;&#x4E2A;cookie&#xFF0C;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x674E;&#x56DB;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD9;&#x4F1A;&#x9020;&#x6210;&#x5F88;&#x591A;&#x5B89;&#x5168;&#x6027;&#x7684;&#x95EE;&#x9898;</li>
</ul>
</li>
<li><strong>expire</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x3002;&#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;GMT&#x65F6;&#x95F4;&#xFF0C;&#x5373;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x6807;&#x51C6;&#x65F6;&#x95F4;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6BD4;&#x5982;<code>Fri, 17 Apr 2020 09:35:59 GMT</code>&#xFF0C;&#x8868;&#x793A;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;&#x7684;<code>2020-04-17 09:35:59</code>&#xFF0C;&#x5373;&#x5317;&#x4EAC;&#x65F6;&#x95F4;&#x7684;<code>2020-04-17 17:35:59</code>&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65F6;&#x95F4;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x540E;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x9500;&#x6BC1;&#x8BE5;cookie&#x3002;</li>
<li><strong>max-age</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x7684;&#x76F8;&#x5BF9;&#x6709;&#x6548;&#x671F;&#x3002;expire&#x548C;max-age&#x901A;&#x5E38;&#x4EC5;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5373;&#x53EF;&#x3002;&#x6BD4;&#x5982;&#x8BBE;&#x7F6E;<code>max-age</code>&#x4E3A;<code>1000</code>&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x6DFB;&#x52A0;cookie&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x8BBE;&#x7F6E;&#x5B83;&#x7684;<code>expire</code>&#x4E3A;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x52A0;&#x4E0A;1000&#x79D2;&#xFF0C;&#x4F5C;&#x4E3A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x3002;
<ul>
<li>&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;expire&#xFF0C;&#x53C8;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;max-age&#xFF0C;&#x5219;&#x8868;&#x793A;&#x4F1A;&#x8BDD;&#x7ED3;&#x675F;&#x540E;&#x8FC7;&#x671F;&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x5927;&#x90E8;&#x5206;&#x6D4F;&#x89C8;&#x5668;&#x800C;&#x8A00;&#xFF0C;&#x5173;&#x95ED;&#x6240;&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7A97;&#x53E3;&#x610F;&#x5473;&#x7740;&#x4F1A;&#x8BDD;&#x7ED3;&#x675F;&#x3002;</li>
</ul>
</li>
<li><strong>secure</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x662F;&#x5426;&#x662F;&#x5B89;&#x5168;&#x8FDE;&#x63A5;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8BE5;&#x503C;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x8BE5;cookie&#x540E;&#x7EED;&#x53EA;&#x80FD;&#x968F;&#x7740;<code>https</code>&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x8BE5;cookie&#x4F1A;&#x968F;&#x7740;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x3002;</li>
<li><strong>httponly</strong>&#xFF1A;&#x8BBE;&#x7F6E;cookie&#x662F;&#x5426;&#x4EC5;&#x80FD;&#x7528;&#x4E8E;&#x4F20;&#x8F93;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8BE5;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x8BE5;cookie&#x4EC5;&#x80FD;&#x7528;&#x4E8E;&#x4F20;&#x8F93;&#xFF0C;&#x800C;&#x4E0D;&#x5141;&#x8BB8;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;JS&#x83B7;&#x53D6;&#xFF0C;&#x8FD9;&#x5BF9;&#x9632;&#x6B62;&#x8DE8;&#x7AD9;&#x811A;&#x672C;&#x653B;&#x51FB;&#xFF08;XSS&#xFF09;&#x4F1A;&#x5F88;&#x6709;&#x7528;&#x3002;
<ul>
<li>&#x5173;&#x4E8E;&#x5982;&#x4F55;&#x901A;&#x8FC7;JS&#x83B7;&#x53D6;&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x8BB2;&#x89E3;</li>
<li>&#x5173;&#x4E8E;&#x4EC0;&#x4E48;&#x662F;XSS&#xFF0C;&#x4E0D;&#x5728;&#x672C;&#x6587;&#x8BA8;&#x8BBA;&#x8303;&#x56F4;</li>
</ul>
</li>
</ul>
<p>&#x4E0B;&#x9762;&#x6765;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;<code>post</code>&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;<code>http://yuanjin.tech/login</code>&#xFF0C;&#x5E76;&#x5728;&#x6D88;&#x606F;&#x4F53;&#x4E2D;&#x7ED9;&#x4E88;&#x4E86;&#x8D26;&#x53F7;&#x548C;&#x5BC6;&#x7801;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x9A8C;&#x8BC1;&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x52A0;&#x5165;&#x4E86;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>set-cookie: token=123456; path=/; max-age=3600; httponly
</code></pre><p>&#x5F53;&#x8BE5;&#x54CD;&#x5E94;&#x5230;&#x8FBE;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x521B;&#x5EFA;&#x4E0B;&#x9762;&#x7684;cookie&#xFF1A;</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml"><span class="token key atrule">key</span><span class="token punctuation">:</span> token
<span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token number">123456</span>
<span class="token key atrule">domain</span><span class="token punctuation">:</span> yuanjin.tech
<span class="token key atrule">path</span><span class="token punctuation">:</span> /
<span class="token key atrule">expire</span><span class="token punctuation">:</span> <span class="token datetime number">2020-04-17 18:55:00</span> <span class="token comment">#&#x5047;&#x8BBE;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x662F;2020-04-17 17:55:00</span>
<span class="token key atrule">secure</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment">#&#x4EFB;&#x4F55;&#x8BF7;&#x6C42;&#x90FD;&#x53EF;&#x4EE5;&#x9644;&#x5E26;&#x8FD9;&#x4E2A;cookie&#xFF0C;&#x53EA;&#x8981;&#x6EE1;&#x8DB3;&#x5176;&#x4ED6;&#x8981;&#x6C42;</span>
<span class="token key atrule">httponly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#&#x4E0D;&#x5141;&#x8BB8;JS&#x83B7;&#x53D6;&#x8BE5;cookie</span>
</pre><p>&#x4E8E;&#x662F;&#xFF0C;&#x968F;&#x7740;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#x7EED;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x53EA;&#x8981;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x8FD9;&#x4E2A;cookie&#x5C31;&#x4F1A;&#x88AB;&#x9644;&#x5E26;&#x5230;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x4F20;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml"><span class="token key atrule">cookie</span><span class="token punctuation">:</span> token=123456; &#x5176;&#x4ED6;cookie<span class="token punctuation">...</span>
</pre><p>&#x73B0;&#x5728;&#xFF0C;&#x8FD8;&#x5269;&#x4E0B;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x5220;&#x9664;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x4E00;&#x4E2A;cookie&#x5462;&#xFF1F;</p>
<p>&#x5982;&#x679C;&#x8981;&#x5220;&#x9664;&#x6D4F;&#x89C8;&#x5668;&#x7684;cookie&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x7684;&#x57DF;&#x3001;&#x540C;&#x6837;&#x7684;&#x8DEF;&#x5F84;&#x3001;&#x540C;&#x6837;&#x7684;key&#xFF0C;&#x53EA;&#x662F;&#x65F6;&#x95F4;&#x8FC7;&#x671F;&#x7684;cookie&#x5373;&#x53EF;</p>
<p><strong>&#x6240;&#x4EE5;&#xFF0C;&#x5220;&#x9664;cookie&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4FEE;&#x6539;cookie</strong></p>
<p>&#x4E0B;&#x9762;&#x7684;&#x54CD;&#x5E94;&#x4F1A;&#x8BA9;&#x6D4F;&#x89C8;&#x5668;&#x5220;&#x9664;<code>token</code></p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml"><span class="token key atrule">cookie</span><span class="token punctuation">:</span> token=; domain=yuanjin.tech; path=/; max<span class="token punctuation">-</span>age=<span class="token punctuation">-</span><span class="token number">1</span>
</pre><p>&#x6D4F;&#x89C8;&#x5668;&#x6309;&#x7167;&#x8981;&#x6C42;&#x4FEE;&#x6539;&#x4E86;cookie&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;cookie&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x4E8E;&#x662F;&#x81EA;&#x7136;&#x5C31;&#x4F1A;&#x5220;&#x9664;&#x4E86;&#x3002;</p>
<blockquote>
<p>&#x65E0;&#x8BBA;&#x662F;&#x4FEE;&#x6539;&#x8FD8;&#x662F;&#x5220;&#x9664;&#xFF0C;&#x90FD;&#x8981;&#x6CE8;&#x610F;cookie&#x7684;&#x57DF;&#x548C;&#x8DEF;&#x5F84;&#xFF0C;&#x56E0;&#x4E3A;&#x5B8C;&#x5168;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x57DF;&#x6216;&#x8DEF;&#x5F84;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;key&#x76F8;&#x540C;&#x7684;cookie</p>
<p>&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x4EC5;&#x901A;&#x8FC7;key&#x786E;&#x5B9A;&#x662F;&#x54EA;&#x4E00;&#x4E2A;cookie</p>
</blockquote>
<h5 class="mume-header" id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AEcookie">&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;cookie</h5>

<p>&#x65E2;&#x7136;cookie&#x662F;&#x5B58;&#x653E;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6D4F;&#x89C8;&#x5668;&#x5411;JS&#x516C;&#x5F00;&#x4E86;&#x63A5;&#x53E3;&#xFF0C;&#x8BA9;&#x5176;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;cookie</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">cookie</span> <span class="token operator">=</span> <span class="token string">&quot;&#x952E;=&#x503C;; path=?; domain=?; expire=?; max-age=?; secure&quot;</span><span class="token punctuation">;</span>
</pre><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;cookie&#xFF0C;&#x548C;&#x670D;&#x52A1;&#x5668;&#x8BBE;&#x7F6E;cookie&#x7684;&#x683C;&#x5F0F;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x4E0D;&#x540C;</p>
<ul>
<li>&#x6CA1;&#x6709;httponly&#x3002;&#x56E0;&#x4E3A;httponly&#x672C;&#x6765;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x9650;&#x5236;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x65E2;&#x7136;&#x4F60;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#xFF0C;&#x81EA;&#x7136;&#x5931;&#x53BB;&#x4E86;&#x9650;&#x5236;&#x7684;&#x610F;&#x4E49;&#x3002;</li>
<li>path&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8BBE;&#x7F6E;cookie&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5199;path&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x8BF7;&#x6C42;&#x7684;path&#x3002;&#x800C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;cookie&#x65F6;&#xFF0C;&#x4E5F;&#x8BB8;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;path&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#x65F6;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x5F53;&#x524D;&#x7F51;&#x9875;&#x7684;path</li>
<li>domain&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x548C;path&#x540C;&#x7406;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#x65F6;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x5F53;&#x524D;&#x7F51;&#x9875;&#x7684;domain</li>
<li>&#x5176;&#x4ED6;&#xFF1A;&#x4E00;&#x6837;</li>
<li>&#x5220;&#x9664;cookie&#xFF1A;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E5F;&#x4E00;&#x6837;&#xFF0C;&#x4FEE;&#x6539;cookie&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x5373;&#x53EF;</li>
</ul>
<h4 class="mume-header" id="%E6%80%BB%E7%BB%93">&#x603B;&#x7ED3;</h4>

<p>&#x4EE5;&#x4E0A;&#xFF0C;&#x5C31;&#x662F;cookie&#x539F;&#x7406;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x5982;&#x679C;&#x628A;&#x5B83;&#x7528;&#x4E8E;&#x767B;&#x5F55;&#x573A;&#x666F;&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x4E0B;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;</p>
<p><strong>&#x767B;&#x5F55;&#x8BF7;&#x6C42;</strong></p>
<ol>
<li>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x9644;&#x5E26;&#x8D26;&#x53F7;&#x5BC6;&#x7801;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x9A8C;&#x8BC1;&#x8D26;&#x53F7;&#x5BC6;&#x7801;&#x662F;&#x5426;&#x6B63;&#x786E;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x54CD;&#x5E94;&#x9519;&#x8BEF;&#xFF0C;&#x5982;&#x679C;&#x6B63;&#x786E;&#xFF0C;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x8BBE;&#x7F6E;cookie&#xFF0C;&#x9644;&#x5E26;&#x767B;&#x5F55;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF08;&#x81F3;&#x4E8E;&#x767B;&#x5F55;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x662F;&#x8BBE;&#x4E48;&#x6837;&#x7684;&#xFF0C;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#xFF0C;&#x8981;&#x8003;&#x8651;&#x54EA;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x767E;&#x5EA6; jwt&#xFF09;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x6536;&#x5230;cookie&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x81EA;&#x52A8;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;</li>
</ol>
<p><strong>&#x540E;&#x7EED;&#x8BF7;&#x6C42;</strong></p>
<ol>
<li>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E0C;&#x671B;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x5458;&#xFF0C;&#x5E76;&#x5C06;cookie&#x81EA;&#x52A8;&#x9644;&#x5E26;&#x5230;&#x8BF7;&#x6C42;&#x4E2D;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x5148;&#x83B7;&#x53D6;cookie&#xFF0C;&#x9A8C;&#x8BC1;cookie&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x5426;&#x6B63;&#x786E;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x4E0D;&#x4E88;&#x4EE5;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x6B63;&#x786E;&#xFF0C;&#x5B8C;&#x6210;&#x6B63;&#x5E38;&#x7684;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;</li>
</ol>
<p>routes/api/admin.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> adminServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../services/adminService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> asyncHandler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../getSendResult&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span>
  <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> adminServ<span class="token punctuation">.</span><span class="token method function property-access">login</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">loginId</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">loginPwd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//&#x767B;&#x5F55;&#x6210;&#x529F;</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">&quot;set-cookie&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; path=/; domain=localhost; max-age=3600; httponly</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95">&#x65AD;&#x70B9;&#x8C03;&#x8BD5;</h3>

<h3 class="mume-header" id="%E8%B7%A8%E5%9F%9F%E4%B9%8Bjsonp">&#x8DE8;&#x57DF;&#x4E4B;JSONP</h3>

<p>&#x670D;&#x52A1;&#x7AEF;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">getStudents</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x5BA2;&#x6237;&#x7AEF;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    script<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:5008/api/student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors">&#x8DE8;&#x57DF;&#x4E4B;CORS</h3>

<blockquote>
<p>&#x9605;&#x8BFB;&#x672C;&#x6587;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x9996;&#x5148;&#x77E5;&#x9053;&#xFF1A;</p>
<ol>
<li>&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x540C;&#x6E90;&#x7B56;&#x7565;</li>
<li>&#x8DE8;&#x57DF;&#x95EE;&#x9898;</li>
<li>JSONP&#x539F;&#x7406;</li>
<li>cookie&#x539F;&#x7406;</li>
</ol>
</blockquote>
<p>JSONP&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x8DE8;&#x57DF;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5B83;&#x81F3;&#x5C11;&#x6709;&#x7740;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x4E25;&#x91CD;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li><strong>&#x4F1A;&#x6253;&#x4E71;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6D88;&#x606F;&#x683C;&#x5F0F;</strong>&#xFF1A;JSONP&#x8981;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E00;&#x6BB5;JS&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x5728;&#x975E;&#x8DE8;&#x57DF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53C8;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7684;JSON&#x683C;&#x5F0F;</li>
<li><strong>&#x53EA;&#x80FD;&#x5B8C;&#x6210;GET&#x8BF7;&#x6C42;</strong>&#xFF1A;JSONP&#x7684;&#x539F;&#x7406;&#x4F1A;&#x8981;&#x6C42;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x751F;&#x6210;&#x4E00;&#x4E2A;<code>script</code>&#x5143;&#x7D20;&#xFF0C;&#x800C;<code>script</code>&#x5143;&#x7D20;&#x53D1;&#x51FA;&#x7684;&#x8BF7;&#x6C42;&#x53EA;&#x80FD;&#x662F;<code>get</code>&#x8BF7;&#x6C42;</li>
</ol>
<p>&#x6240;&#x4EE5;&#xFF0C;CORS&#x662F;&#x4E00;&#x79CD;&#x66F4;&#x597D;&#x7684;&#x8DE8;&#x57DF;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>
<h4 class="mume-header" id="%E6%A6%82%E8%BF%B0">&#x6982;&#x8FF0;</h4>

<p><code>CORS</code>&#x662F;&#x57FA;&#x4E8E;<code>http1.1</code>&#x7684;&#x4E00;&#x79CD;&#x8DE8;&#x57DF;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5B83;&#x7684;&#x5168;&#x79F0;&#x662F;<strong>C</strong>ross-<strong>O</strong>rigin <strong>R</strong>esource <strong>S</strong>haring&#xFF0C;&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;&#x3002;</p>
<p>&#x5B83;&#x7684;&#x603B;&#x4F53;&#x601D;&#x8DEF;&#x662F;&#xFF1A;<strong>&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x8981;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x9700;&#x8981;&#x83B7;&#x5F97;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5141;&#x8BB8;</strong></p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200421152122793.png" alt="image-20200421152122793" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200421152122793
</p>
<p>&#x800C;&#x8981;&#x77E5;&#x9053;&#xFF0C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x9644;&#x5E26;&#x5F88;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x4ECE;&#x800C;&#x4F1A;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x9020;&#x6210;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x5F71;&#x54CD;</p>
<p>&#x6BD4;&#x5982;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x53EA;&#x662F;&#x83B7;&#x53D6;&#x4E00;&#x4E9B;&#x65B0;&#x95FB;&#xFF0C;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x6539;&#x52A8;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;</p>
<p>&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;CORS&#x89C4;&#x5B9A;&#x4E86;&#x4E09;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li><strong>&#x7B80;&#x5355;&#x8BF7;&#x6C42;</strong></li>
<li><strong>&#x9700;&#x8981;&#x9884;&#x68C0;&#x7684;&#x8BF7;&#x6C42;</strong></li>
<li><strong>&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;</strong></li>
</ul>
<p>&#x8FD9;&#x4E09;&#x79CD;&#x6A21;&#x5F0F;&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#x5C42;&#x5C42;&#x9012;&#x8FDB;&#xFF0C;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x505A;&#x7684;&#x4E8B;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x8981;&#x6C42;&#x4E5F;&#x8D8A;&#x6765;&#x8D8A;&#x4E25;&#x683C;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x5206;&#x522B;&#x8BF4;&#x660E;&#x4E09;&#x79CD;&#x8BF7;&#x6C42;&#x6A21;&#x5F0F;&#x7684;&#x5177;&#x4F53;&#x89C4;&#x8303;&#x3002;</p>
<h4 class="mume-header" id="%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">&#x7B80;&#x5355;&#x8BF7;&#x6C42;</h4>

<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x6BB5;ajax&#x4EE3;&#x7801;&#xFF08;&#x65E0;&#x8BBA;&#x662F;&#x4F7F;&#x7528;XMLHttpRequest&#x8FD8;&#x662F;fetch api&#xFF09;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x9996;&#x5148;&#x5224;&#x65AD;&#x5B83;&#x5C5E;&#x4E8E;&#x54EA;&#x4E00;&#x79CD;&#x8BF7;&#x6C42;&#x6A21;&#x5F0F;</p>
<h5 class="mume-header" id="%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%9A%84%E5%88%A4%E5%AE%9A">&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x7684;&#x5224;&#x5B9A;</h5>

<p>&#x5F53;&#x8BF7;&#x6C42;<strong>&#x540C;&#x65F6;&#x6EE1;&#x8DB3;</strong>&#x4EE5;&#x4E0B;&#x6761;&#x4EF6;&#x65F6;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x8BA4;&#x4E3A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#xFF1A;</p>
<ol>
<li>
<p><strong>&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x5C5E;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x79CD;&#xFF1A;</strong></p>
<ul>
<li>get</li>
<li>post</li>
<li>head</li>
</ul>
</li>
<li>
<p><strong>&#x8BF7;&#x6C42;&#x5934;&#x4EC5;&#x5305;&#x542B;&#x5B89;&#x5168;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x5B89;&#x5168;&#x5B57;&#x6BB5;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Content-Type</code></li>
<li><code>DPR</code></li>
<li><code>Downlink</code></li>
<li><code>Save-Data</code></li>
<li><code>Viewport-Width</code></li>
<li><code>Width</code></li>
</ul>
</li>
<li>
<p><strong>&#x8BF7;&#x6C42;&#x5934;&#x5982;&#x679C;&#x5305;&#x542B;<code>Content-Type</code>&#xFF0C;&#x4EC5;&#x9650;&#x4E0B;&#x9762;&#x7684;&#x503C;&#x4E4B;&#x4E00;&#xFF1A;</strong></p>
<ul>
<li><code>text/plain</code></li>
<li><code>multipart/form-data</code></li>
<li><code>application/x-www-form-urlencoded</code></li>
</ul>
</li>
</ol>
<p>&#x5982;&#x679C;&#x4EE5;&#x4E0A;&#x4E09;&#x4E2A;&#x6761;&#x4EF6;&#x540C;&#x65F6;&#x6EE1;&#x8DB3;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5224;&#x5B9A;&#x4E3A;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x4E0D;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span><span class="token string">&quot;PUT&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// &#x52A0;&#x5165;&#x4E86;&#x989D;&#x5916;&#x7684;&#x8BF7;&#x6C42;&#x5934;&#xFF0C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  headers<span class="token operator">:</span><span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// &#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;post&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// content-type&#x4E0D;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;content-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre><h5 class="mume-header" id="%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BA%A4%E4%BA%92%E8%A7%84%E8%8C%83">&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x7684;&#x4EA4;&#x4E92;&#x89C4;&#x8303;</h5>

<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x5224;&#x5B9A;&#x67D0;&#x4E2A;<strong>ajax&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;</strong>&#x662F;<strong>&#x7B80;&#x5355;&#x8BF7;&#x6C42;</strong>&#x65F6;&#xFF0C;&#x4F1A;&#x53D1;&#x751F;&#x4EE5;&#x4E0B;&#x7684;&#x4E8B;&#x60C5;</p>
<ol>
<li><strong>&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x4F1A;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;<code>Origin</code>&#x5B57;&#x6BB5;</strong></li>
</ol>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x9875;&#x9762;<code>http://my.com/index.html</code>&#x4E2D;&#x6709;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x9020;&#x6210;&#x4E86;&#x8DE8;&#x57DF;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x7B80;&#x5355;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/news&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x8BF7;&#x6C42;&#x53D1;&#x51FA;&#x540E;&#xFF0C;&#x8BF7;&#x6C42;&#x5934;&#x4F1A;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x683C;&#x5F0F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>GET /api/news/ HTTP/1.1
Host: crossdomain.com
Connection: keep-alive
...
Referer: http://my.com/index.html
Origin: http://my.com
</code></pre><p>&#x770B;&#x5230;&#x6700;&#x540E;&#x4E00;&#x884C;&#x6CA1;&#xFF0C;<code>Origin</code>&#x5B57;&#x6BB5;&#x4F1A;&#x544A;&#x8BC9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x662F;&#x54EA;&#x4E2A;&#x6E90;&#x5730;&#x5740;&#x5728;&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;</p>
<ol start="2">
<li><strong>&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x5E94;&#x5305;&#x542B;<code>Access-Control-Allow-Origin</code></strong></li>
</ol>
<p>&#x5F53;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5141;&#x8BB8;&#x8BE5;&#x8BF7;&#x6C42;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x6DFB;&#x52A0;<code>Access-Control-Allow-Origin</code>&#x5B57;&#x6BB5;</p>
<p>&#x8BE5;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x662F;&#xFF1A;</p>
<ul>
<li>*&#xFF1A;&#x8868;&#x793A;&#x6211;&#x5F88;&#x5F00;&#x653E;&#xFF0C;&#x4EC0;&#x4E48;&#x4EBA;&#x6211;&#x90FD;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;</li>
<li>&#x5177;&#x4F53;&#x7684;&#x6E90;&#xFF1A;&#x6BD4;&#x5982;<code>http://my.com</code>&#xFF0C;&#x8868;&#x793A;&#x6211;&#x5C31;&#x5141;&#x8BB8;&#x4F60;&#x8BBF;&#x95EE;</li>
</ul>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;<code>http://my.com</code>&#x800C;&#x8A00;&#xFF0C;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x624D;&#x4E0D;&#x4F1A;&#x7BA1;&#x5176;&#x4ED6;&#x6E90;&#x670D;&#x52A1;&#x5668;&#x5141;&#x4E0D;&#x5141;&#x8BB8;&#xFF0C;&#x5C31;&#x5173;&#x5FC3;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x88AB;&#x5141;&#x8BB8;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x53EF;&#x88AB;&#x5141;&#x8BB8;&#x7684;&#x6E90;&#x5217;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x7684;<code>Origin</code>&#x547D;&#x4E2D;&#x8BE5;&#x5217;&#x8868;&#xFF0C;&#x624D;&#x54CD;&#x5E94;<code>*</code>&#x6216;&#x5177;&#x4F53;&#x7684;&#x6E90;</p>
<p><strong>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x540E;&#x7EED;&#x7684;&#x9EBB;&#x70E6;&#xFF0C;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#x54CD;&#x5E94;&#x5177;&#x4F53;&#x7684;&#x6E90;</strong></p>
</blockquote>
<p>&#x5047;&#x8BBE;&#x670D;&#x52A1;&#x5668;&#x505A;&#x51FA;&#x4E86;&#x4EE5;&#x4E0B;&#x7684;&#x54CD;&#x5E94;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>HTTP/1.1 200 OK
Date: Tue, 21 Apr 2020 08:03:35 GMT
...
Access-Control-Allow-Origin: http://my.com
...

&#x6D88;&#x606F;&#x4F53;&#x4E2D;&#x7684;&#x6570;&#x636E;
</code></pre><p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x770B;&#x5230;&#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;&#x81EA;&#x5DF1;&#x8BBF;&#x95EE;&#x540E;&#xFF0C;&#x9AD8;&#x5174;&#x7684;&#x50CF;&#x4E00;&#x4E2A;&#x4E24;&#x767E;&#x65A4;&#x7684;&#x5B69;&#x5B50;&#xFF0C;&#x4E8E;&#x662F;&#xFF0C;&#x5B83;&#x5C31;&#x628A;&#x54CD;&#x5E94;&#x987A;&#x5229;&#x7684;&#x4EA4;&#x7ED9;js&#xFF0C;&#x4EE5;&#x5B8C;&#x6210;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;</p>
<p>&#x4E0B;&#x56FE;&#x7B80;&#x8FF0;&#x4E86;&#x6574;&#x4E2A;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200421162846480.png" alt="image-20200421162846480" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200421162846480
</p>
<h4 class="mume-header" id="%E9%9C%80%E8%A6%81%E9%A2%84%E6%A3%80%E7%9A%84%E8%AF%B7%E6%B1%82">&#x9700;&#x8981;&#x9884;&#x68C0;&#x7684;&#x8BF7;&#x6C42;</h4>

<p>&#x7B80;&#x5355;&#x7684;&#x8BF7;&#x6C42;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5A01;&#x80C1;&#x4E0D;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x4E0A;&#x8FF0;&#x7684;&#x7B80;&#x5355;&#x4EA4;&#x4E92;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x8BA4;&#x4E3A;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x4F1A;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x8FDB;&#x884C;&#xFF1A;</p>
<ol>
<li><strong>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#xFF0C;&#x8BE2;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x5141;&#x8BB8;</strong></li>
<li><strong>&#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;</strong></li>
<li><strong>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;</strong></li>
<li><strong>&#x670D;&#x52A1;&#x5668;&#x5B8C;&#x6210;&#x771F;&#x5B9E;&#x7684;&#x54CD;&#x5E94;</strong></li>
</ol>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x9875;&#x9762;<code>http://my.com/index.html</code>&#x4E2D;&#x6709;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x9020;&#x6210;&#x4E86;&#x8DE8;&#x57DF;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x9700;&#x8981;&#x9884;&#x68C0;&#x7684;&#x8BF7;&#x6C42;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://crossdomain.com/api/user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token comment">// post &#x8BF7;&#x6C42;</span>
  headers<span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token comment">// &#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x5934;</span>
    a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">&quot;content-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;&#x8881;&#x5C0F;&#x8FDB;&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x4F53;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x73B0;&#x5B83;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x4F1A;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x4EA4;&#x4E92;</p>
<ol>
<li><strong>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#xFF0C;&#x8BE2;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x5141;&#x8BB8;</strong></li>
</ol>
<pre data-role="codeBlock" data-info class="language-"><code>OPTIONS /api/user HTTP/1.1
Host: crossdomain.com
...
Origin: http://my.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: a, b, content-type
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x5E76;&#x975E;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x53D1;&#x51FA;&#x7684;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#xFF0C;&#x8BF7;&#x6C42;&#x4E2D;&#x4E0D;&#x5305;&#x542B;&#x6211;&#x4EEC;&#x7684;&#x54CD;&#x5E94;&#x5934;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x6D88;&#x606F;&#x4F53;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x662F;&#x8BE2;&#x95EE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x540E;&#x7EED;&#x7684;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x9884;&#x68C0;&#x8BF7;&#x6C42;<strong>&#x6CA1;&#x6709;&#x8BF7;&#x6C42;&#x4F53;</strong>&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x540E;&#x7EED;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;</p>
<p>&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#x6709;&#x4EE5;&#x4E0B;&#x7279;&#x5F81;&#xFF1A;</p>
<ul>
<li>&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x4E3A;<code>OPTIONS</code></li>
<li>&#x6CA1;&#x6709;&#x8BF7;&#x6C42;&#x4F53;</li>
<li>&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x5305;&#x542B;
<ul>
<li><code>Origin</code>&#xFF1A;&#x8BF7;&#x6C42;&#x7684;&#x6E90;&#xFF0C;&#x548C;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x7684;&#x542B;&#x4E49;&#x4E00;&#x81F4;</li>
<li><code>Access-Control-Request-Method</code>&#xFF1A;&#x540E;&#x7EED;&#x7684;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#x5C06;&#x4F7F;&#x7528;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;</li>
<li><code>Access-Control-Request-Headers</code>&#xFF1A;&#x540E;&#x7EED;&#x7684;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#x4F1A;&#x6539;&#x52A8;&#x7684;&#x8BF7;&#x6C42;&#x5934;</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>&#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;</strong></li>
</ol>
<p>&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x5141;&#x8BB8;&#x8FD9;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x4E0B;&#x9762;&#x7684;&#x6D88;&#x606F;&#x683C;&#x5F0F;</p>
<pre data-role="codeBlock" data-info class="language-"><code>HTTP/1.1 200 OK
Date: Tue, 21 Apr 2020 08:03:35 GMT
...
Access-Control-Allow-Origin: http://my.com
Access-Control-Allow-Methods: POST
Access-Control-Allow-Headers: a, b, content-type
Access-Control-Max-Age: 86400
...
</code></pre><p>&#x5BF9;&#x4E8E;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x4EFB;&#x4F55;&#x7684;&#x6D88;&#x606F;&#x4F53;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x6DFB;&#x52A0;&#xFF1A;</p>
<ul>
<li><code>Access-Control-Allow-Origin</code>&#xFF1A;&#x548C;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x4E00;&#x6837;&#xFF0C;&#x8868;&#x793A;&#x5141;&#x8BB8;&#x7684;&#x6E90;</li>
<li><code>Access-Control-Allow-Methods</code>&#xFF1A;&#x8868;&#x793A;&#x5141;&#x8BB8;&#x7684;&#x540E;&#x7EED;&#x771F;&#x5B9E;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;</li>
<li><code>Access-Control-Allow-Headers</code>&#xFF1A;&#x8868;&#x793A;&#x5141;&#x8BB8;&#x6539;&#x52A8;&#x7684;&#x8BF7;&#x6C42;&#x5934;</li>
<li><code>Access-Control-Max-Age</code>&#xFF1A;&#x544A;&#x8BC9;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x591A;&#x5C11;&#x79D2;&#x5185;&#xFF0C;&#x5BF9;&#x4E8E;&#x540C;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#x6E90;&#x3001;&#x65B9;&#x6CD5;&#x3001;&#x5934;&#xFF0C;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x53D1;&#x9001;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#x4E86;</li>
</ul>
<ol start="3">
<li><strong>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;</strong></li>
</ol>
<p>&#x9884;&#x68C0;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;&#x540E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;&#x4E86;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x53D1;&#x751F;&#x4E0B;&#x9762;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x636E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>POST /api/user HTTP/1.1
Host: crossdomain.com
Connection: keep-alive
...
Referer: http://my.com/index.html
Origin: http://my.com

{&quot;name&quot;: &quot;&#x8881;&#x5C0F;&#x8FDB;&quot;, &quot;age&quot;: 18 }
</code></pre><ol start="4">
<li><strong>&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x771F;&#x5B9E;&#x8BF7;&#x6C42;</strong></li>
</ol>
<pre data-role="codeBlock" data-info class="language-"><code>HTTP/1.1 200 OK
Date: Tue, 21 Apr 2020 08:03:35 GMT
...
Access-Control-Allow-Origin: http://my.com
...

&#x6DFB;&#x52A0;&#x7528;&#x6237;&#x6210;&#x529F;
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5F53;&#x5B8C;&#x6210;&#x9884;&#x68C0;&#x4E4B;&#x540E;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x5904;&#x7406;&#x4E0E;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x76F8;&#x540C;</p>
<p>&#x4E0B;&#x56FE;&#x7B80;&#x8FF0;&#x4E86;&#x6574;&#x4E2A;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200421165913320.png" alt="image-20200421165913320" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200421165913320
</p>
<h4 class="mume-header" id="%E9%99%84%E5%B8%A6%E8%BA%AB%E4%BB%BD%E5%87%AD%E8%AF%81%E7%9A%84%E8%AF%B7%E6%B1%82">&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;</h4>

<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;ajax&#x7684;&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;&#x5E76;&#x4E0D;&#x4F1A;&#x9644;&#x5E26;cookie&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x67D0;&#x4E9B;&#x9700;&#x8981;&#x6743;&#x9650;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;</p>
<p>&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x9644;&#x5E26;cookie</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// xhr</span>
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token property-access">withCredentials</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// fetch api</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  credentials<span class="token operator">:</span> <span class="token string">&quot;include&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre><p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x8BE5;&#x8DE8;&#x57DF;&#x7684;ajax&#x8BF7;&#x6C42;&#x5C31;&#x662F;&#x4E00;&#x4E2A;<em>&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;</em></p>
<p>&#x5F53;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x9700;&#x8981;&#x9644;&#x5E26;cookie&#x65F6;&#xFF0C;&#x65E0;&#x8BBA;&#x5B83;&#x662F;&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD8;&#x662F;&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x5728;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x6DFB;&#x52A0;<code>cookie</code>&#x5B57;&#x6BB5;</p>
<p>&#x800C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x660E;&#x786E;&#x544A;&#x77E5;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x5141;&#x8BB8;&#x8FD9;&#x6837;&#x7684;&#x51ED;&#x636E;</p>
<p>&#x544A;&#x77E5;&#x7684;&#x65B9;&#x5F0F;&#x4E5F;&#x975E;&#x5E38;&#x7684;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x6DFB;&#x52A0;&#xFF1A;<code>Access-Control-Allow-Credentials: true</code>&#x5373;&#x53EF;</p>
<p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x82E5;&#x670D;&#x52A1;&#x5668;&#x6CA1;&#x6709;&#x660E;&#x786E;&#x544A;&#x77E5;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4ECD;&#x7136;&#x89C6;&#x4E3A;&#x8DE8;&#x57DF;&#x88AB;&#x62D2;&#x7EDD;&#x3002;</p>
<p>&#x53E6;&#x5916;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;<strong>&#x5BF9;&#x4E8E;&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x5F97;&#x8BBE;&#x7F6E; <code>Access-Control-Allow-Origin &#x7684;&#x503C;&#x4E3A;*</code></strong>&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;*&#x7684;&#x539F;&#x56E0;</p>
<h4 class="mume-header" id="%E4%B8%80%E4%B8%AA%E9%A2%9D%E5%A4%96%E7%9A%84%E8%A1%A5%E5%85%85">&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x8865;&#x5145;</h4>

<p>&#x5728;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;JS&#x53EA;&#x80FD;&#x62FF;&#x5230;&#x4E00;&#x4E9B;&#x6700;&#x57FA;&#x672C;&#x7684;&#x54CD;&#x5E94;&#x5934;&#xFF0C;&#x5982;&#xFF1A;Cache-Control&#x3001;Content-Language&#x3001;Content-Type&#x3001;Expires&#x3001;Last-Modified&#x3001;Pragma&#xFF0C;&#x5982;&#x679C;&#x8981;&#x8BBF;&#x95EE;&#x5176;&#x4ED6;&#x5934;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x670D;&#x52A1;&#x5668;&#x8BBE;&#x7F6E;&#x672C;&#x54CD;&#x5E94;&#x5934;&#x3002;</p>
<p><code>Access-Control-Expose-Headers</code>&#x5934;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x628A;&#x5141;&#x8BB8;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x7684;&#x5934;&#x653E;&#x5165;&#x767D;&#x540D;&#x5355;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>Access-Control-Expose-Headers: authorization, a, b
</code></pre><p>&#x8FD9;&#x6837;JS&#x5C31;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x6307;&#x5B9A;&#x7684;&#x54CD;&#x5E94;&#x5934;&#x4E86;&#x3002;</p>
<p><em>&#x5B89;&#x88C5;&#x5229;&#x7528;cors&#x5E93;</em></p>
<h3 class="mume-header" id="session">session</h3>

<p>&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;<code>express-session</code></p>
<p class="markdown-p-center">
  <img src="./assets/session&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;.jpg" alt="session&#x8BE6;&#x89E3;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  session&#x8BE6;&#x89E3;
</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x52A0;&#x5165;cookie-parser &#x4E2D;&#x95F4;&#x4EF6;</span>
<span class="token comment">// &#x52A0;&#x5165;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x5728;req&#x5BF9;&#x8C61;&#x4E2D;&#x6CE8;&#x5165;cookies&#x5C5E;&#x6027;&#xFF0C;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;cookie</span>
<span class="token comment">// &#x52A0;&#x5165;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x5728;res&#x5BF9;&#x8C61;&#x4E2D;&#x6CE8;&#x5165;cookie&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;cookie</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="jwt">jwt</h3>

<p>&#x968F;&#x7740;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#x7684;&#x5EFA;&#x7ACB;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x516C;&#x53F8;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x4E8E;&#x5404;&#x79CD;&#x4EA7;&#x54C1;&#x7EBF;&#x3002;</p>
<p>&#x800C;&#x8FD9;&#x4E9B;&#x4EA7;&#x54C1;&#x7EBF;&#x4E0A;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x6709;&#x7740;&#x5404;&#x79CD;&#x7EC8;&#x7AEF;&#x8BBE;&#x5907;&#xFF0C;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x4EC5;&#x9650;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x3001;&#x684C;&#x9762;&#x5E94;&#x7528;&#x3001;&#x79FB;&#x52A8;&#x7AEF;&#x5E94;&#x7528;&#x3001;&#x5E73;&#x677F;&#x5E94;&#x7528;&#x3001;&#x751A;&#x81F3;&#x667A;&#x80FD;&#x5BB6;&#x5C45;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200422163727151.png" alt="image-20200422163727151" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200422163727151
</p>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x4EA7;&#x54C1;&#x7EBF;&#x901A;&#x5E38;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4EA7;&#x54C1;&#x5185;&#x90E8;&#x7684;&#x6570;&#x636E;&#x4E00;&#x822C;&#x548C;&#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x4F46;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#x4ECD;&#x7136;&#x6709;&#x5FC5;&#x8981;&#x5B58;&#x5728;&#xFF0C;&#x56E0;&#x4E3A;&#x540C;&#x4E00;&#x5BB6;&#x516C;&#x53F8;&#x7684;&#x4EA7;&#x54C1;&#x603B;&#x662F;&#x4F1A;&#x5B58;&#x5728;&#x5171;&#x4EAB;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x6570;&#x636E;</p>
</blockquote>
<p>&#x8FD9;&#x4E9B;&#x8BBE;&#x5907;&#x4E0E;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x4F1A;&#x8FDB;&#x884C;http&#x901A;&#x4FE1;</p>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#x81F3;&#x5C11;&#x627F;&#x62C5;&#x7740;&#x8BA4;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x767B;&#x5F55;&#xFF1A;&#x5404;&#x79CD;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E00;&#x4E2A;&#x8EAB;&#x4EFD;&#x4EE4;&#x724C;&#xFF08;&#x53C2;&#x89C1;<a href="http://www.yuanjin.tech/article/98">cookie&#x539F;&#x7406;&#x8BE6;&#x89E3;</a>&#xFF09;</p>
<p>&#x5F53;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x51FA;&#x73B0;&#x540E;&#xFF0C;&#x5C31;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x8FD8;&#x80FD;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;cookie&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x4EE4;&#x724C;&#x4FE1;&#x606F;&#x5417;&#xFF1F;</p>
<p>&#x5176;&#x5B9E;&#xFF0C;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x1F436;&#xFF0C;&#x56E0;&#x4E3A;cookie&#x5728;&#x4F20;&#x8F93;&#x4E2D;&#x65E0;&#x975E;&#x662F;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5934;&#x800C;&#x5DF2;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;&#x5934;&#x6709;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x7F62;&#x4E86;&#x3002;</p>
<p>&#x4F46;&#x6D4F;&#x89C8;&#x5668;&#x4E4B;&#x5916;&#x7684;&#x8BBE;&#x5907;&#x80AF;&#x5B9A;&#x4E0D;&#x559C;&#x6B22;cookie&#xFF0C;&#x56E0;&#x4E3A;&#x6D4F;&#x89C8;&#x5668;&#x6709;&#x7740;&#x5BF9;cookie&#x5B8C;&#x5584;&#x7684;&#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x4E0A;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x5904;&#x7406;&#x4E86;</p>
<p>jwt&#x7684;&#x51FA;&#x73B0;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;</p>
<h4 class="mume-header" id="%E6%A6%82%E8%BF%B0-1">&#x6982;&#x8FF0;</h4>

<p>jwt&#x5168;&#x79F0;<code>Json Web Token</code>&#xFF0C;&#x5F3A;&#x884C;&#x7FFB;&#x8BD1;&#x8FC7;&#x6765;&#x5C31;&#x662F;<code>json&#x683C;&#x5F0F;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x4EE4;&#x724C;</code>&#xFF08;&#x7B97;&#x4E86;&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x8981;&#x5F3A;&#x884C;&#x7FFB;&#x8BD1;&#x4E86;&#x1F437;&#xFF09;</p>
<p>&#x5B83;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;&#x591A;&#x79CD;&#x7EC8;&#x7AEF;&#x8BBE;&#x5907;&#xFF0C;&#x63D0;&#x4F9B;<strong>&#x7EDF;&#x4E00;&#x7684;&#x3001;&#x5B89;&#x5168;&#x7684;</strong>&#x4EE4;&#x724C;&#x683C;&#x5F0F;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200422165350268.png" alt="image-20200422165350268" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200422165350268
</p>
<p>&#x56E0;&#x6B64;&#xFF0C;jwt&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4EE4;&#x724C;&#x683C;&#x5F0F;&#x800C;&#x5DF2;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x5B83;&#x5B58;&#x50A8;&#x5230;cookie&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5230;localstorage&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x9650;&#x5236;&#xFF01;</p>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x4F20;&#x8F93;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x4F20;&#x8F93;&#x65B9;&#x5F0F;&#x6765;&#x4F20;&#x8F93;jwt&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x4F7F;&#x7528;&#x6D88;&#x606F;&#x5934;&#x6765;&#x4F20;&#x8F93;&#x5B83;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5F53;&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x54CD;&#x5E94;&#x4E00;&#x4E2A;jwt&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>HTTP/1.1 200 OK
...
set-cookie:token=jwt&#x4EE4;&#x724C;
authorization:jwt&#x4EE4;&#x724C;
...

{..., token:jwt&#x4EE4;&#x724C;}
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;jwt&#x4EE4;&#x724C;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x5728;&#x54CD;&#x5E94;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x81EA;&#x884C;&#x7EA6;&#x5B9A;&#x5373;&#x53EF;&#x3002;</p>
<blockquote>
<p>&#x5F53;&#x7136;&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x5728;&#x54CD;&#x5E94;&#x7684;&#x591A;&#x4E2A;&#x5730;&#x65B9;&#xFF0C;&#x6BD4;&#x5982;&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x5229;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x7684;cookie&#xFF0C;&#x540C;&#x65F6;&#x4E3A;&#x4E86;&#x7167;&#x987E;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BA9;jwt&#x51FA;&#x73B0;&#x5728;<code>set-cookie</code>&#x548C;<code>authorization&#x6216;body</code>&#x4E2D;&#xFF0C;&#x5C3D;&#x7BA1;&#x8FD9;&#x4F1A;&#x589E;&#x52A0;&#x989D;&#x5916;&#x7684;&#x4F20;&#x8F93;&#x91CF;&#x3002;</p>
</blockquote>
<p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x62FF;&#x5230;&#x4EE4;&#x724C;&#x540E;&#xFF0C;&#x5B83;&#x8981;&#x505A;&#x7684;&#x53EA;&#x6709;&#x4E00;&#x4EF6;&#x4E8B;&#xFF1A;&#x5B58;&#x50A8;&#x5B83;&#x3002;</p>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5230;&#x4EFB;&#x4F55;&#x4F4D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#x624B;&#x673A;&#x6587;&#x4EF6;&#x3001;PC&#x6587;&#x4EF6;&#x3001;localstorage&#x3001;cookie</p>
<p>&#x5F53;&#x540E;&#x7EED;&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x5B83;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x867D;&#x7136;jwt&#x6CA1;&#x6709;&#x660E;&#x786E;&#x8981;&#x6C42;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x9644;&#x5E26;&#x5230;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x4F1A;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x7684;&#x683C;&#x5F0F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>GET /api/resources HTTP/1.1
...
authorization: bearer jwt&#x4EE4;&#x724C;
...
</code></pre><blockquote>
<p>&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x662F;OAuth2&#x9644;&#x5E26;token&#x7684;&#x4E00;&#x79CD;&#x89C4;&#x8303;&#x683C;&#x5F0F;</p>
<p>&#x81F3;&#x4E8E;&#x4EC0;&#x4E48;&#x662F;OAuth2&#xFF0C;&#x90A3;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x8BDD;&#x9898;&#x4E86;</p>
</blockquote>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x80FD;&#x591F;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x4EE4;&#x724C;&#x4E86;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;&#x4EE4;&#x724C;&#x7684;&#x9A8C;&#x8BC1;&#xFF0C;&#x5373;&#x53EF;&#x77E5;&#x9053;&#x8BE5;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x6709;&#x6548;&#x3002;</p>
<p>&#x5B83;&#x4EEC;&#x7684;&#x5B8C;&#x6574;&#x4EA4;&#x4E92;&#x6D41;&#x7A0B;&#x662F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x6E05;&#x6670;&#x7684;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200422172837190.png" alt="image-20200422172837190" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200422172837190
</p>
<h4 class="mume-header" id="%E4%BB%A4%E7%89%8C%E7%9A%84%E7%BB%84%E6%88%90">&#x4EE4;&#x724C;&#x7684;&#x7EC4;&#x6210;</h4>

<p>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x4EE4;&#x724C;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF0C;jwt&#x4EE4;&#x724C;&#x7531;&#x4E09;&#x4E2A;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ol>
<li>header&#xFF1A;&#x4EE4;&#x724C;&#x5934;&#x90E8;&#xFF0C;&#x8BB0;&#x5F55;&#x4E86;&#x6574;&#x4E2A;&#x4EE4;&#x724C;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;</li>
<li>payload&#xFF1A;&#x4EE4;&#x724C;&#x8D1F;&#x8377;&#xFF0C;&#x8BB0;&#x5F55;&#x4E86;&#x4FDD;&#x5B58;&#x7684;&#x4E3B;&#x4F53;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x4F60;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5C31;&#x53EF;&#x4EE5;&#x653E;&#x5230;&#x8FD9;&#x91CC;</li>
<li>signature&#xFF1A;&#x4EE4;&#x724C;&#x7B7E;&#x540D;&#xFF0C;&#x6309;&#x7167;&#x5934;&#x90E8;&#x56FA;&#x5B9A;&#x7684;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#x5BF9;&#x6574;&#x4E2A;&#x4EE4;&#x724C;&#x8FDB;&#x884C;&#x7B7E;&#x540D;&#xFF0C;&#x8BE5;&#x7B7E;&#x540D;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF1A;&#x4FDD;&#x8BC1;&#x4EE4;&#x724C;&#x4E0D;&#x88AB;&#x4F2A;&#x9020;&#x548C;&#x7BE1;&#x6539;</li>
</ol>
<p>&#x5B83;&#x4EEC;&#x7EC4;&#x5408;&#x800C;&#x6210;&#x7684;&#x5B8C;&#x6574;&#x683C;&#x5F0F;&#x662F;&#xFF1A;<code>header.payload.signature</code></p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;jwt&#x4EE4;&#x724C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9.BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc
</code></pre><p>&#x5B83;&#x5404;&#x4E2A;&#x90E8;&#x5206;&#x7684;&#x503C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li><code>header&#xFF1A;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</code></li>
<li><code>payload&#xFF1A;eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9</code></li>
<li><code>signature: BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc</code></li>
</ul>
<p>&#x4E0B;&#x9762;&#x5206;&#x522B;&#x5BF9;&#x6BCF;&#x4E2A;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x8BF4;&#x660E;</p>
<h5 class="mume-header" id="header">header</h5>

<p>&#x5B83;&#x662F;&#x4EE4;&#x724C;&#x5934;&#x90E8;&#xFF0C;&#x8BB0;&#x5F55;&#x4E86;&#x6574;&#x4E2A;&#x4EE4;&#x724C;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;</p>
<p>&#x5B83;&#x7684;&#x683C;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;<code>json</code>&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;alg&quot;</span><span class="token operator">:</span><span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typ&quot;</span><span class="token operator">:</span><span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span>
</pre><p>&#x8BE5;&#x5BF9;&#x8C61;&#x8BB0;&#x5F55;&#x4E86;&#xFF1A;</p>
<ul>
<li>alg&#xFF1A;signature&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x7684;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x53D6;&#x4E24;&#x4E2A;&#x503C;
<ul>
<li>HS256&#xFF1A;&#x4E00;&#x79CD;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x79D8;&#x94A5;&#x5BF9;signature&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;</li>
<li>RS256&#xFF1A;&#x4E00;&#x79CD;&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;&#x79C1;&#x94A5;&#x52A0;&#x5BC6;&#xFF0C;&#x516C;&#x94A5;&#x89E3;&#x5BC6;</li>
</ul>
</li>
<li>typ&#xFF1A;&#x6574;&#x4E2A;&#x4EE4;&#x724C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x56FA;&#x5B9A;&#x5199;<code>JWT</code>&#x5373;&#x53EF;</li>
</ul>
<p>&#x8BBE;&#x7F6E;&#x597D;&#x4E86;<code>header</code>&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x751F;&#x6210;<code>header</code>&#x90E8;&#x5206;&#x4E86;</p>
<p>&#x5177;&#x4F53;&#x7684;&#x751F;&#x6210;&#x65B9;&#x5F0F;&#x53CA;&#x5176;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x628A;<code>header</code>&#x90E8;&#x5206;&#x4F7F;&#x7528;<code>base64 url</code>&#x7F16;&#x7801;&#x5373;&#x53EF;</p>
<blockquote>
<p><code>base64 url</code>&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x79CD;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#xFF0C;&#x5B83;&#x662F;&#x5728;<code>base64</code>&#x7B97;&#x6CD5;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5BF9;<code>+</code>&#x3001;<code>=</code>&#x3001;<code>/</code>&#x4E09;&#x4E2A;&#x5B57;&#x7B26;&#x505A;&#x51FA;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x7684;&#x7B97;&#x6CD5;</p>
<p>&#x800C;<code>base64</code>&#x662F;&#x4F7F;&#x7528;64&#x4E2A;&#x53EF;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x6765;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x505A;&#x6CD5;&#x53C2;&#x8003;<a href="https://baike.baidu.com/item/base64/8545775?fr=aladdin">&#x767E;&#x5EA6;&#x767E;&#x79D1;</a></p>
</blockquote>
<p>&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4F9B;&#x4E86;<code>btoa</code>&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">btoa</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;alg&quot;</span><span class="token operator">:</span><span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;typ&quot;</span><span class="token operator">:</span><span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x5F97;&#x5230;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>
</pre><p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;<code>atob</code>&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">atob</span><span class="token punctuation">(</span><span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// &#x5F97;&#x5230;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;{&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}</span>
</pre><blockquote>
<p>nodejs&#x4E2D;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;<code>atob</code>&#x548C;<code>bota</code>&#x641E;&#x5B9A;</p>
<p>&#x6216;&#x8005;&#xFF0C;&#x624B;&#x52A8;&#x641E;&#x5B9A;</p>
</blockquote>
<h5 class="mume-header" id="payload">payload</h5>

<p>&#x8FD9;&#x90E8;&#x5206;&#x662F;jwt&#x7684;&#x4E3B;&#x4F53;&#x4FE1;&#x606F;&#xFF0C;&#x5B83;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;JSON&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token string">&quot;ss&quot;</span>&#xFF1A;<span class="token string">&quot;&#x53D1;&#x884C;&#x8005;&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;iat&quot;</span>&#xFF1A;<span class="token string">&quot;&#x53D1;&#x5E03;&#x65F6;&#x95F4;&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;exp&quot;</span>&#xFF1A;<span class="token string">&quot;&#x5230;&#x671F;&#x65F6;&#x95F4;&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;sub&quot;</span>&#xFF1A;<span class="token string">&quot;&#x4E3B;&#x9898;&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;aud&quot;</span>&#xFF1A;<span class="token string">&quot;&#x542C;&#x4F17;&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;nbf&quot;</span>&#xFF1A;<span class="token string">&quot;&#x5728;&#x6B64;&#x4E4B;&#x524D;&#x4E0D;&#x53EF;&#x7528;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;jti&quot;</span>&#xFF1A;<span class="token string">&quot;JWT ID&quot;</span>
<span class="token punctuation">}</span>
</pre><p>&#x4EE5;&#x4E0A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x5168;&#x5199;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E00;&#x4E2A;&#x90FD;&#x4E0D;&#x5199;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x89C4;&#x8303;&#xFF0C;&#x5C31;&#x7B97;&#x5199;&#x4E86;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x4F60;&#x5728;&#x5C06;&#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;jwt&#x4EE4;&#x724C;&#x65F6;&#x624B;&#x52A8;&#x5904;&#x7406;&#x624D;&#x80FD;&#x53D1;&#x6325;&#x4F5C;&#x7528;</p>
<p>&#x4E0A;&#x8FF0;&#x5C5E;&#x6027;&#x8868;&#x8FBE;&#x7684;&#x542B;&#x4E49;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li>ss&#xFF1A;&#x53D1;&#x884C;&#x8BE5;jwt&#x7684;&#x662F;&#x8C01;&#xFF0C;&#x53EF;&#x4EE5;&#x5199;&#x516C;&#x53F8;&#x540D;&#x5B57;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5199;&#x670D;&#x52A1;&#x540D;&#x79F0;</li>
<li>iat&#xFF1A;&#x8BE5;jwt&#x7684;&#x53D1;&#x653E;&#x65F6;&#x95F4;&#xFF0C;&#x901A;&#x5E38;&#x5199;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x7684;&#x65F6;&#x95F4;&#x6233;</li>
<li>exp&#xFF1A;&#x8BE5;jwt&#x7684;&#x5230;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x901A;&#x5E38;&#x5199;&#x65F6;&#x95F4;&#x6233;</li>
<li>sub&#xFF1A;&#x8BE5;jwt&#x662F;&#x7528;&#x4E8E;&#x5E72;&#x561B;&#x7684;</li>
<li>aud&#xFF1A;&#x8BE5;jwt&#x662F;&#x53D1;&#x653E;&#x7ED9;&#x54EA;&#x4E2A;&#x7EC8;&#x7AEF;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x7EC8;&#x7AEF;&#x7C7B;&#x578B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x7528;&#x6237;&#x540D;&#x79F0;&#xFF0C;&#x968F;&#x610F;&#x4E00;&#x70B9;</li>
<li>nbf&#xFF1A;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#xFF0C;&#x5728;&#x8BE5;&#x65F6;&#x95F4;&#x70B9;&#x5230;&#x8FBE;&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;&#x4EE4;&#x724C;&#x662F;&#x4E0D;&#x53EF;&#x7528;&#x7684;</li>
<li>jti&#xFF1A;jwt&#x7684;&#x552F;&#x4E00;&#x7F16;&#x53F7;&#xFF0C;&#x8BBE;&#x7F6E;&#x6B64;&#x9879;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x91CD;&#x653E;&#x653B;&#x51FB;&#xFF08;&#x91CD;&#x653E;&#x653B;&#x51FB;&#x662F;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x4EE4;&#x724C;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x6B63;&#x786E;&#x7684;&#x8BC6;&#x522B;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x4E0D;&#x53EF;&#x9884;&#x671F;&#x7684;&#x884C;&#x4E3A;&#x53D1;&#x751F;&#xFF09;</li>
</ul>
<p>&#x53EF;&#x662F;&#x5230;&#x73B0;&#x5728;&#xFF0C;&#x770B;&#x4E86;&#x534A;&#x5929;&#xFF0C;&#x6CA1;&#x6709;&#x51FA;&#x73B0;&#x6211;&#x60F3;&#x8981;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x554A;&#x1F602;</p>
<p>&#x5F53;&#x7528;&#x6237;&#x767B;&#x9646;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x628A;&#x7528;&#x6237;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#x5199;&#x5165;&#x5230;jwt&#x4EE4;&#x724C;&#x4E2D;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;id&#x3001;&#x8D26;&#x53F7;&#x7B49;&#x7B49;&#xFF08;&#x5BC6;&#x7801;&#x5C31;&#x7B97;&#x4E86;&#x1F633;&#xFF09;</p>
<p>&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;payload&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x53EA;&#x662F;&#x4E00;&#x4E2A;json&#x5BF9;&#x8C61;&#x800C;&#x5DF2;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5411;&#x5BF9;&#x8C61;&#x4E2D;&#x52A0;&#x5165;&#x4EFB;&#x4F55;&#x60F3;&#x8981;&#x52A0;&#x5165;&#x7684;&#x4FE1;&#x606F;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x7684;json&#x5BF9;&#x8C61;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;payload</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;foo&quot;</span><span class="token operator">:</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;iat&quot;</span><span class="token operator">:</span><span class="token number">1587548215</span>
<span class="token punctuation">}</span>
</pre><p><code>foo: bar</code>&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x4FE1;&#x606F;&#xFF0C;<code>iat: 1587548215</code>&#x662F;jwt&#x89C4;&#x8303;&#x4E2D;&#x7684;&#x4FE1;&#x606F;</p>
<p>&#x6700;&#x7EC8;&#xFF0C;payload&#x90E8;&#x5206;&#x548C;header&#x4E00;&#x6837;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7;<code>base64 url</code>&#x7F16;&#x7801;&#x5F97;&#x5230;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">btoa</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;foo&quot;</span><span class="token operator">:</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;iat&quot;</span><span class="token operator">:</span><span class="token number">1587548215</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x5F97;&#x5230;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9</span>
</pre><h5 class="mume-header" id="signature">signature</h5>

<p>&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x662F;jwt&#x7684;&#x7B7E;&#x540D;&#xFF0C;&#x6B63;&#x662F;&#x5B83;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E86;&#x6574;&#x4E2A;jwt&#x4E0D;&#x88AB;&#x7BE1;&#x6539;</p>
<p>&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x751F;&#x6210;&#xFF0C;&#x662F;&#x5BF9;&#x524D;&#x9762;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#x7684;&#x7F16;&#x7801;&#x7ED3;&#x679C;&#xFF0C;&#x6309;&#x7167;&#x5934;&#x90E8;&#x6307;&#x5B9A;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;</p>
<p>&#x6BD4;&#x5982;&#xFF1A;&#x5934;&#x90E8;&#x6307;&#x5B9A;&#x7684;&#x52A0;&#x5BC6;&#x65B9;&#x6CD5;&#x662F;<code>HS256</code>&#xFF0C;&#x524D;&#x9762;&#x4E24;&#x90E8;&#x5206;&#x7684;&#x7F16;&#x7801;&#x7ED3;&#x679C;&#x662F;<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9</code></p>
<p>&#x5219;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x7528;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;<code>HS256</code>&#x5BF9;&#x5B57;&#x7B26;&#x4E32;<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9</code>&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x5F97;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x79D8;&#x94A5;&#xFF0C;&#x6BD4;&#x5982;<code>shhhhh</code></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token constant">HS256</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;shhhhh&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// &#x5F97;&#x5230;&#xFF1A;BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc</span>
</pre><p>&#x6700;&#x7EC8;&#xFF0C;&#x5C06;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x5B8C;&#x6574;&#x7684;jwt</p>
<pre data-role="codeBlock" data-info class="language-"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJpYXQiOjE1ODc1NDgyMTV9.BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc
</code></pre><p>&#x7531;&#x4E8E;&#x7B7E;&#x540D;&#x4F7F;&#x7528;&#x7684;&#x79D8;&#x94A5;&#x4FDD;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x65E0;&#x6CD5;&#x4F2A;&#x9020;&#x51FA;&#x7B7E;&#x540D;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x62FF;&#x4E0D;&#x5230;&#x79D8;&#x94A5;&#x3002;</p>
<p>&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x8BF4;&#x65E0;&#x6CD5;&#x4F2A;&#x9020;jwt&#xFF0C;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x7684;&#x5B58;&#x5728;&#x3002;</p>
<p>&#x800C;&#x524D;&#x9762;&#x4E24;&#x90E8;&#x5206;&#x5E76;&#x6CA1;&#x6709;&#x52A0;&#x5BC6;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7F16;&#x7801;&#x7ED3;&#x679C;&#x800C;&#x5DF2;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x51E0;&#x4E4E;&#x662F;&#x660E;&#x6587;&#x4F20;&#x8F93;</p>
<blockquote>
<p>&#x8FD9;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x592A;&#x5927;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x65E2;&#x7136;&#x7528;&#x6237;&#x767B;&#x9646;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5B83;&#x5F53;&#x7136;&#x6709;&#x6743;&#x529B;&#x67E5;&#x770B;&#x81EA;&#x5DF1;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;</p>
<p>&#x751A;&#x81F3;&#x5728;&#x67D0;&#x4E9B;&#x7F51;&#x7AD9;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x88AB;&#x4EFB;&#x4F55;&#x4EBA;&#x67E5;&#x770B;</p>
<p>&#x4F60;&#x8981;&#x4FDD;&#x8BC1;&#x7684;&#xFF0C;&#x662F;&#x4E0D;&#x8981;&#x628A;&#x654F;&#x611F;&#x7684;&#x4FE1;&#x606F;&#x5B58;&#x653E;&#x5230;jwt&#x4E2D;&#xFF0C;&#x6BD4;&#x5982;&#x5BC6;&#x7801;</p>
</blockquote>
<p>jwt&#x7684;<code>signature</code>&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x4EE4;&#x724C;&#x4E0D;&#x88AB;&#x4F2A;&#x9020;&#xFF0C;&#x90A3;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4EE4;&#x724C;&#x4E0D;&#x88AB;&#x7BE1;&#x6539;&#x5462;&#xFF1F;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x767B;&#x9646;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x83B7;&#x5F97;&#x4E86;jwt&#xFF0C;&#x4F46;&#x4ED6;&#x4EBA;&#x4E3A;&#x7684;&#x7BE1;&#x6539;&#x4E86;<code>payload</code>&#xFF0C;&#x6BD4;&#x5982;&#x628A;&#x81EA;&#x5DF1;&#x7684;&#x8D26;&#x6237;&#x4F59;&#x989D;&#x4FEE;&#x6539;&#x4E3A;&#x539F;&#x6765;&#x7684;&#x4E24;&#x500D;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x7F16;&#x7801;&#x51FA;<code>payload</code>&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5982;&#x4F55;&#x5F97;&#x77E5;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x88AB;&#x7BE1;&#x6539;&#x8FC7;&#x4E86;&#x5462;&#xFF1F;</p>
<p>&#x8FD9;&#x5C31;&#x8981;&#x8BF4;&#x5230;&#x4EE4;&#x724C;&#x7684;&#x9A8C;&#x8BC1;&#x4E86;</p>
<h4 class="mume-header" id="%E4%BB%A4%E7%89%8C%E7%9A%84%E9%AA%8C%E8%AF%81">&#x4EE4;&#x724C;&#x7684;&#x9A8C;&#x8BC1;</h4>

<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200422172837190.png" alt="image-20200422172837190" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200422172837190
</p>
<p>&#x4EE4;&#x724C;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7EC4;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F1A;&#x4EE5;&#x4EFB;&#x610F;&#x7684;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x5230;&#x5BA2;&#x6237;&#x7AEF;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x628A;&#x4EE4;&#x724C;&#x4FDD;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x5C06;&#x4EE4;&#x724C;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x5668;</p>
<p>&#x800C;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x6B63;&#x786E;&#xFF0C;&#x5982;&#x4F55;&#x9A8C;&#x8BC1;&#x5462;&#xFF1F;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x8981;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x88AB;&#x7BE1;&#x6539;&#x8FC7;&#xFF0C;&#x9A8C;&#x8BC1;&#x65B9;&#x5F0F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;<code>header+payload</code>&#x7528;&#x540C;&#x6837;&#x7684;&#x79D8;&#x94A5;&#x548C;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x91CD;&#x65B0;&#x52A0;&#x5BC6;</p>
<p>&#x7136;&#x540E;&#x628A;&#x52A0;&#x5BC6;&#x7684;&#x7ED3;&#x679C;&#x548C;&#x4F20;&#x5165;jwt&#x7684;<code>signature</code>&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;&#xFF0C;&#x5982;&#x679C;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x524D;&#x9762;&#x4E24;&#x90E8;&#x5206;&#x6CA1;&#x6709;&#x52A8;&#x8FC7;&#xFF0C;&#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x9881;&#x53D1;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x540C;&#xFF0C;&#x80AF;&#x5B9A;&#x662F;&#x88AB;&#x7BE1;&#x6539;&#x8FC7;&#x4E86;&#x3002;</p>
<pre data-role="codeBlock" data-info class="language-"><code>&#x4F20;&#x5165;&#x7684;header.&#x4F20;&#x5165;&#x7684;payload.&#x4F20;&#x5165;&#x7684;signature
&#x65B0;&#x7684;signature = header&#x4E2D;&#x7684;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;(&#x4F20;&#x5165;&#x7684;header.&#x4F20;&#x5165;&#x7684;payload, &#x79D8;&#x94A5;)
&#x9A8C;&#x8BC1;&#xFF1A;&#x65B0;&#x7684;signature == &#x4F20;&#x5165;&#x7684;signature
</code></pre><p>&#x5F53;&#x4EE4;&#x724C;&#x9A8C;&#x8BC1;&#x4E3A;&#x6CA1;&#x6709;&#x88AB;&#x7BE1;&#x6539;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5176;&#x4ED6;&#x9A8C;&#x8BC1;&#xFF1A;&#x6BD4;&#x5982;&#x662F;&#x5426;&#x8FC7;&#x671F;&#x3001;&#x542C;&#x4F17;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C31;&#x89C6;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x4E86;</p>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x4E9B;&#x9A8C;&#x8BC1;&#x90FD;&#x9700;&#x8981;&#x670D;&#x52A1;&#x5668;&#x624B;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x6CA1;&#x6709;&#x54EA;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x7ED9;&#x4F60;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x9A8C;&#x8BC1;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x6765;&#x5B8C;&#x6210;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;</p>
<h4 class="mume-header" id="%E6%80%BB%E7%BB%93-1">&#x603B;&#x7ED3;</h4>

<p>&#x6700;&#x540E;&#xFF0C;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;jwt&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>jwt&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x79CD;&#x4EE4;&#x724C;&#x683C;&#x5F0F;&#x3002;&#x5B83;&#x548C;&#x7EC8;&#x7AEF;&#x8BBE;&#x5907;&#x65E0;&#x5173;&#xFF0C;&#x540C;&#x6837;&#x548C;&#x670D;&#x52A1;&#x5668;&#x65E0;&#x5173;&#xFF0C;&#x751A;&#x81F3;&#x4E0E;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x65E0;&#x5173;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x89C4;&#x8303;&#x4E86;&#x4EE4;&#x724C;&#x7684;&#x683C;&#x5F0F;&#x800C;&#x5DF2;</li>
<li>jwt&#x7531;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF1A;header&#x3001;payload&#x3001;signature&#x3002;&#x4E3B;&#x4F53;&#x4FE1;&#x606F;&#x5728;payload</li>
<li>jwt&#x96BE;&#x4EE5;&#x88AB;&#x7BE1;&#x6539;&#x548C;&#x4F2A;&#x9020;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6709;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x7684;&#x7B7E;&#x540D;&#x5B58;&#x5728;&#x3002;</li>
</ul>
<h3 class="mume-header" id="%E7%99%BB%E5%BD%95%E5%92%8C%E8%AE%A4%E8%AF%81-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91">&#x767B;&#x5F55;&#x548C;&#x8BA4;&#x8BC1;-&#x670D;&#x52A1;&#x5668;&#x5F00;&#x53D1;</h3>

<p>/routes/jwt.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> secrect <span class="token operator">=</span> <span class="token string">&quot;yuanjin&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieKey <span class="token operator">=</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jsonwebtoken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//&#x9881;&#x53D1;jwt</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">publish</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> maxAge <span class="token operator">=</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">,</span> info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token method function property-access">sign</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> secrect<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    expiresIn<span class="token operator">:</span> maxAge<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//&#x6DFB;&#x52A0;&#x5230;cookie</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">cookie</span><span class="token punctuation">(</span>cookieKey<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    maxAge<span class="token operator">:</span> maxAge <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//&#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x4F20;&#x8F93;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">&quot;authorization&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">verify</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> token<span class="token punctuation">;</span>
  <span class="token comment">//&#x5C1D;&#x8BD5;&#x4ECE;cookie&#x4E2D;&#x83B7;&#x53D6;</span>
  token <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">cookies</span><span class="token punctuation">[</span>cookieKey<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//cookie&#x4E2D;&#x6CA1;&#x6709;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x5C1D;&#x8BD5;&#x4E2D;header&#x4E2D;</span>
    token <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token property-access">authorization</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#x6CA1;&#x6709;token</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// authorization: bearer token</span>
    token <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    token <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> token<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> token<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token method function property-access">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secrect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>/routes/api/admin.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>login<span class="token punctuation">,</span>getAdminById<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../../services/adminService&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>asyncHandler<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../getSendResult&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../jwt&apos;</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&apos;/login&apos;</span><span class="token punctuation">,</span><span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token arrow operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">login</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">loginId</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">loginPwd</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
            
            <span class="token keyword">const</span> id <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">;</span>
            
            jwt<span class="token punctuation">.</span><span class="token method function property-access">publish</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span><span class="token keyword nil">undefined</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/whoami&quot;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">getAdminById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">userId</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E7%99%BB%E5%BD%95%E5%92%8C%E8%AE%A4%E8%AF%81-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91">&#x767B;&#x5F55;&#x548C;&#x8BA4;&#x8BC1;-&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;</h3>

<h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">&#x573A;&#x666F;-&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</h3>

<p>/logger.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> log4js <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;log4js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getCommonAppender</span><span class="token punctuation">(</span><span class="token parameter">pathSeg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;sql&#x65E5;&#x5FD7;&#x51FA;&#x53E3;</span>
    type<span class="token operator">:</span> <span class="token string">&quot;dateFile&quot;</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> pathSeg<span class="token punctuation">,</span> <span class="token string">&quot;logging.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    maxLogSize<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">//&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x5927;&#x5B57;&#x8282;&#x6570;</span>
    keepFileExt<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    daysToKeep<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    layout<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;pattern&quot;</span><span class="token punctuation">,</span>
      pattern<span class="token operator">:</span> <span class="token string">&quot;%c [%d{yyyy-MM-dd hh:mm:ss}] [%p]: %m%n&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

log4js<span class="token punctuation">.</span><span class="token method function property-access">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  appenders<span class="token operator">:</span> <span class="token punctuation">{</span>
    sql<span class="token operator">:</span> <span class="token function">getCommonAppender</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&quot;stdout&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    api<span class="token operator">:</span> <span class="token function">getCommonAppender</span><span class="token punctuation">(</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  categories<span class="token operator">:</span> <span class="token punctuation">{</span>
    sql<span class="token operator">:</span> <span class="token punctuation">{</span>
      appenders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//&#x8BE5;&#x5206;&#x7C7B;&#x4F7F;&#x7528;&#x51FA;&#x53E3;sql&#x7684;&#x914D;&#x7F6E;&#x5199;&#x5165;&#x65E5;&#x5FD7;</span>
      level<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      appenders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      level<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    api<span class="token operator">:</span> <span class="token punctuation">{</span>
      appenders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      level<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  log4js<span class="token punctuation">.</span><span class="token method function property-access">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token property-access">sqlLogger</span> <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;sql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token property-access">logger</span> <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token property-access">apiLogger</span> <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>/routes/apiLoggerMid.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> apiLogger <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../logger.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> log4js <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;log4js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// module.exports = (req, res, next) =&gt; {</span>
<span class="token comment">//   next();</span>
<span class="token comment">//   apiLogger.debug(`${req.method} ${req.path} ${req.ip}`);</span>
<span class="token comment">// };</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token method function property-access">connectLogger</span><span class="token punctuation">(</span>apiLogger<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  level<span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x5728;/routes/init.js&#x4E2D;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;</p>
<h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">&#x573A;&#x666F;-&#x6587;&#x4EF6;&#x4E0A;&#x4F20;</h3>

<p>/routes/api/upload.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token method function property-access">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../../public/upload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x65F6;&#x95F4;&#x6233;-6&#x4F4D;&#x968F;&#x673A;&#x5B57;&#x7B26;.&#x6587;&#x4EF6;&#x540E;&#x7F00;</span>
    <span class="token keyword">const</span> timeStamp <span class="token operator">=</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ramdomStr <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token property-access">originalname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeStamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ramdomStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ext<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  storage<span class="token punctuation">,</span>
  limits<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// fileSize: 150 * 1024,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">fileFilter</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x9A8C;&#x8BC1;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x540D;</span>
    <span class="token keyword">const</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token property-access">originalname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> whitelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>whitelist<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>extname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">your ext name of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not support</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token method function property-access">single</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/upload/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span><span class="token property-access">file</span><span class="token punctuation">.</span><span class="token property-access">filename</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> url<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>/public/index.html</p>
<pre data-role="codeBlock" data-info="html" class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/api/upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>&#x63D0;&#x4EA4;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">&#x573A;&#x666F;-&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;</h3>

<p>/routes/api/download.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/:filename&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>
    __dirname<span class="token punctuation">,</span>
    <span class="token string">&quot;../../resources&quot;</span><span class="token punctuation">,</span>
    req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">filename</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">download</span><span class="token punctuation">(</span>absPath<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>/public/index.html</p>
<pre data-role="codeBlock" data-info="html" class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">resrole</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thunder<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/res/picture.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/res/picture.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x666E;&#x901A;&#x4E0B;&#x8F7D;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &#x8FC5;&#x96F7;&#x4E0B;&#x8F7D;&#x534F;&#x8BAE;
    &#x628A;&#x5B8C;&#x6574;&#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5F97;&#x5230;
    AA&#x5730;&#x5740;ZZ
    base64&#x7F16;&#x7801;
    thunder://base64&#x7F16;&#x7801;
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;a[resrole=thunder]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> thunderLink <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">AA</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token punctuation">.</span><span class="token property-access">href</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ZZ</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      thunderLink <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span>thunderLink<span class="token punctuation">)</span><span class="token punctuation">;</span>
      thunderLink <span class="token operator">=</span> <span class="token string">&quot;thunder://&quot;</span> <span class="token operator">+</span> thunderLink<span class="token punctuation">;</span>
      a<span class="token punctuation">.</span><span class="token property-access">href</span> <span class="token operator">=</span> thunderLink<span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0">&#x573A;&#x666F;-&#x56FE;&#x7247;&#x6C34;&#x5370;</h3>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jimp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jimp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7ED9;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x52A0;&#x6C34;&#x5370;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mark</span><span class="token punctuation">(</span>
  <span class="token parameter">waterFile<span class="token punctuation">,</span>
  originFile<span class="token punctuation">,</span>
  targetFile<span class="token punctuation">,</span>
  proportion <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
  marginProportion <span class="token operator">=</span> <span class="token number">0.01</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>water<span class="token punctuation">,</span> origin<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    jimp<span class="token punctuation">.</span><span class="token method function property-access">read</span><span class="token punctuation">(</span>waterFile<span class="token punctuation">)</span><span class="token punctuation">,</span>
    jimp<span class="token punctuation">.</span><span class="token method function property-access">read</span><span class="token punctuation">(</span>originFile<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// &#x5BF9;&#x6C34;&#x5370;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7F29;&#x653E;</span>
  <span class="token keyword">const</span> curProportion <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">/</span> water<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">;</span>
  water<span class="token punctuation">.</span><span class="token method function property-access">scale</span><span class="token punctuation">(</span>curProportion <span class="token operator">/</span> proportion<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// &#x8BA1;&#x7B97;&#x4F4D;&#x7F6E;</span>
  <span class="token keyword">const</span> right <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">*</span> marginProportion<span class="token punctuation">;</span>
  <span class="token keyword">const</span> bottom <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">*</span> marginProportion<span class="token punctuation">;</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">-</span> right <span class="token operator">-</span> water<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">-</span> bottom <span class="token operator">-</span> water<span class="token punctuation">.</span><span class="token property-access">bitmap</span><span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">;</span>

  <span class="token comment">// &#x5199;&#x5165;&#x6C34;&#x5370;</span>
  origin<span class="token punctuation">.</span><span class="token method function property-access">composite</span><span class="token punctuation">(</span>water<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> jimp<span class="token punctuation">.</span><span class="token constant">BLEND_SOURCE_OVER</span><span class="token punctuation">,</span>
    opacitySource<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">await</span> origin<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>targetFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> waterPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./water.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> originPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./origin.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> targetPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./new.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mark</span><span class="token punctuation">(</span>waterPath<span class="token punctuation">,</span> originPath<span class="token punctuation">,</span> targetPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE">&#x573A;&#x666F;-&#x56FE;&#x7247;&#x9632;&#x76D7;&#x94FE;</h3>

<p>/routes/imgProtectMid.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> host <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token property-access">host</span><span class="token punctuation">;</span> <span class="token comment">//&#x83B7;&#x53D6;&#x672C;&#x7F51;&#x7AD9;&#x7684;&#x4E3B;&#x673A;&#x540D;&#xFF08;&#x5305;&#x62EC;&#x7AEF;&#x53E3;&#x53F7;&#xFF09;</span>
  <span class="token keyword">let</span> referer <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token property-access">referer</span><span class="token punctuation">;</span>

  <span class="token comment">// &#x53EA;&#x5904;&#x7406;&#x56FE;&#x7247;</span>
  <span class="token keyword">const</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">extname</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jpeg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.gif&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>extname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>referer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    referer <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>referer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">host</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>referer <span class="token operator">&amp;&amp;</span> host <span class="token operator">!==</span> referer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">=</span> <span class="token string">&quot;/img/logo.jpg&quot;</span><span class="token punctuation">;</span> <span class="token comment">// url rewrite</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E9%87%8D%E8%A6%81%E5%9C%BA%E6%99%AF-%E4%BB%A3%E7%90%86">&#x91CD;&#x8981;&#x573A;&#x666F;-&#x4EE3;&#x7406;</h3>

<p class="markdown-p-center">
  <img src="./assets/&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;.jpg" alt="&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  &#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;
</p>
<p>/routes/proxyMid.js(&#x624B;&#x5199;)</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// /data/api/xxxxx   ---&gt;    http://yuanjin.tech:5100/api/xxxx</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token string">&quot;/data&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x4E0D;&#x9700;&#x8981;&#x4EE3;&#x7406;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// &#x9700;&#x8981;&#x4EE3;&#x7406;</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61; request</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token method function property-access">request</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      host<span class="token operator">:</span> <span class="token string">&quot;yuanjin.tech&quot;</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">5100</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">,</span>
      method<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// &#x4EE3;&#x7406;&#x54CD;&#x5E94;&#x5BF9;&#x8C61; response</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token property-access">statusCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x628A;&#x8BF7;&#x6C42;&#x4F53;&#x5199;&#x5165;&#x5230;&#x4EE3;&#x7406;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x8BF7;&#x6C42;&#x4F53;&#x4E2D;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</pre><p>/routes/proxyMid.js(&#x7B2C;&#x4E09;&#x65B9;&#x5E93;)</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> createProxyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http-proxy-middleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token string">&quot;/data&quot;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">&quot;http://yuanjin.tech:5100&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">pathRewrite</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> path<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E6%89%A9%E5%B1%95%E5%9C%BA%E6%99%AF-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E">&#x6269;&#x5C55;&#x573A;&#x666F;-&#x6A21;&#x677F;&#x5F15;&#x64CE;</h3>

<p class="markdown-p-center">
  <img src="./assets/&#x4E24;&#x79CD;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;.jpg" alt="&#x4E24;&#x79CD;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;" style="max-width:100%">
</p>
<p class="markdown-img-description">
  &#x4E24;&#x79CD;&#x6E32;&#x67D3;&#x65B9;&#x5F0F;
</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ejs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ejs
  <span class="token punctuation">.</span><span class="token method function property-access">renderFile</span><span class="token punctuation">(</span><span class="token string">&quot;./test.ejs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    number<span class="token operator">:</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&#x751F;&#x6210;&#x7684;&#x6570;&#x5B57;&#x662F;&#xFF1A;&lt;%= number %&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  number<span class="token operator">:</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>test.ejs</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
      &#x6570;&#x5B57;&#xFF1A; &lt;%= number %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><p>/routes/controller/student.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stuServ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../services/studentService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">page</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> limit <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">limit</span> <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sex <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">sex</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// total   datas</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> stuServ<span class="token punctuation">.</span><span class="token method function property-access">getStudents</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">&quot;./students.ejs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>result<span class="token punctuation">,</span>
    page<span class="token punctuation">,</span>
    limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>

</pre><p>/routes/views/students.ejs</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>&#x5B66;&#x751F;&#x5217;&#x8868;&#x9875;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      &#x5B66;&#x751F;&#x603B;&#x6570;&#xFF1A; &lt;%= total %&gt; , &#x5F53;&#x524D;&#x7B2C;&lt;%= page %&gt;&#x9875;&#xFF0C;&#x6BCF;&#x9875;&lt;%= limit %&gt;&#x6761;&#x6570;&#x636E;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
      &lt;% datas.forEach(stu =&gt; { %&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
        &lt;%= stu.name %&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      &lt;% }) %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?page=&lt;%=+page-1%&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x4E0A;&#x4E00;&#x9875;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?page=&lt;%=+page+1%&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&#x4E0B;&#x4E00;&#x9875;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</pre><p>/routes/init.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x6A21;&#x677F;&#x5F15;&#x64CE;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">&quot;views&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">&quot;/student&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./controller/student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81">&#x573A;&#x666F;-&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;</h3>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">QRCode</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;qrcode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">QRCode</span><span class="token punctuation">.</span><span class="token method function property-access">toDataURL</span><span class="token punctuation">(</span><span class="token string">&quot;https://duyi.ke.qq.com/?tuin=a5d48d54&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x8FD4;&#x56DE;base64&#x683C;&#x5F0F;&#x56FE;&#x7247;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81">&#x573A;&#x666F;-&#x751F;&#x6210;&#x9A8C;&#x8BC1;&#x7801;</h3>

<p>/routes/captchaMid.js</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> svgCaptcha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;svg-captcha&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/captcha&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> captcha <span class="token operator">=</span> svgCaptcha<span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    size<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    ignoreChars<span class="token operator">:</span> <span class="token string">&quot;iIl10oO&quot;</span><span class="token punctuation">,</span>
    noise<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">captcha</span> <span class="token operator">=</span> captcha<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x628A;&#x9A8C;&#x8BC1;&#x7801;&#x4E2D;&#x7684;&#x6587;&#x672C;&#x5B58;&#x653E;&#x5230;session&#x4E2D;</span>

  res<span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>captcha<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">validateCaptcha</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> reqCaptcha <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">captcha</span> <span class="token operator">?</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">captcha</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//&#x7528;&#x6237;&#x4F20;&#x9012;&#x7684;&#x9A8C;&#x8BC1;&#x7801;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>reqCaptcha <span class="token operator">!==</span> req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">captcha</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x9A8C;&#x8BC1;&#x7801;&#x6709;&#x95EE;&#x9898;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      code<span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> <span class="token string">&quot;&#x9A8C;&#x8BC1;&#x7801;&#x6709;&#x95EE;&#x9898;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">captcha</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">captchaHandler</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x5982;&#x679C;session&#x4E2D;&#x6CA1;&#x6709;&#x8BBF;&#x95EE;&#x8BB0;&#x5F55;</span>
    req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x628A;&#x8FD9;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x8BBF;&#x95EE;&#x65F6;&#x95F4;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;</span>

  <span class="token comment">// &#x5982;&#x679C;&#x5728;&#x4E00;&#x5C0F;&#x6BB5;&#x65F6;&#x95F4;&#x4E2D;&#x8BF7;&#x6C42;&#x8FBE;&#x5230;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5C31;&#x53EF;&#x80FD;&#x662F;&#x673A;&#x5668;</span>
  <span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> repeat <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> now <span class="token operator">-</span> time <span class="token operator">&lt;=</span> duration
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">records</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;=</span> repeat <span class="token operator">||</span> <span class="token string">&quot;captcha&quot;</span> <span class="token keyword">in</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x9A8C;&#x8BC1;&#x9A8C;&#x8BC1;&#x7801;</span>
    <span class="token function">validateCaptcha</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> captchaHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> captchaHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98">&#x573A;&#x666F;-&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;</h3>

<h4 class="mume-header" id="%E7%BC%93%E5%AD%98%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">&#x7F13;&#x5B58;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;</h4>

<p>&#x5728;&#x4E00;&#x4E2A;C/S&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x6700;&#x57FA;&#x672C;&#x7684;&#x7F13;&#x5B58;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;</p>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7F13;&#x5B58;</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x4EC5;&#x8BA8;&#x8BBA;&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;</strong></p>
<p>&#x6240;&#x8C13;<strong>&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;</strong>&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x662F;&#x5C06;&#x67D0;&#x4E00;&#x6B21;&#x7684;&#x54CD;&#x5E94;&#x7ED3;&#x679C;&#x4FDD;&#x5B58;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x6BD4;&#x5982;&#x6D4F;&#x89C8;&#x5668;&#xFF09;&#x4E2D;&#xFF0C;&#x800C;&#x540E;&#x7EED;&#x7684;&#x8BF7;&#x6C42;&#x4EC5;&#x9700;&#x8981;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x5373;&#x53EF;&#xFF0C;&#x6781;&#x5927;&#x7684;&#x964D;&#x4F4E;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5904;&#x7406;&#x538B;&#x529B;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;&#x7684;&#x539F;&#x7406;&#x5982;&#x4E0B;&#xFF1A;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200430202446870.png" alt="image-20200430202446870" style="zoom: 33%;">
<blockquote>
<p>&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x6613;&#x7684;&#x539F;&#x7406;&#x56FE;&#xFF0C;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x6709;&#x5DEE;&#x5F02;</p>
</blockquote>
<p>&#x8FD9;&#x91CC;&#x5C31;&#x8BBE;&#x8BA1;&#x5230;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x7B56;&#x7565;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>&#x54EA;&#x4E9B;&#x8D44;&#x6E90;&#x9700;&#x8981;&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#xFF0C;&#x54EA;&#x4E9B;&#x4E0D;&#x9700;&#x8981;&#xFF1F;</li>
<li>&#x7F13;&#x5B58;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x591A;&#x4E45;&#x5462;&#xFF1F;</li>
<li>&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D44;&#x6E90;&#x6709;&#x6539;&#x52A8;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4F55;&#x66F4;&#x65B0;&#x7F13;&#x5B58;&#x5462;&#xFF1F;</li>
<li>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x8FC7;&#x671F;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x8D44;&#x6E90;&#x5E76;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x53D8;&#x52A8;&#xFF0C;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#xFF1F;</li>
<li>.......</li>
</ul>
<p>&#x8981;&#x56DE;&#x7B54;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x6E05;&#x695A;<code>http</code>&#x4E2D;&#x5173;&#x4E8E;&#x7F13;&#x5B58;&#x7684;&#x534F;&#x8BAE;</p>
<p>&#x7406;&#x89E3;&#x4E86;http&#x7684;&#x7F13;&#x5B58;&#x534F;&#x8BAE;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x80FD;&#x56DE;&#x7B54;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>
<h4 class="mume-header" id="%E6%9D%A5%E8%87%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BC%93%E5%AD%98%E6%8C%87%E4%BB%A4">&#x6765;&#x81EA;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</h4>

<p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;<code>get</code>&#x8BF7;&#x6C42;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x80FD;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x5185;&#x5FC3;&#x6D3B;&#x52A8;&#xFF1A;&#x300C;&#x4F60;&#x8BF7;&#x6C42;&#x7684;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x6211;&#x5F88;&#x5C11;&#x4F1A;&#x6539;&#x52A8;&#x5B83;&#xFF0C;&#x5E72;&#x8106;&#x4F60;&#x628A;&#x5B83;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#x5427;&#xFF0C;&#x4EE5;&#x540E;&#x5C31;&#x4E0D;&#x8981;&#x6765;&#x70E6;&#x6211;&#x4E86;&#x300D;</p>
<p>&#x4E3A;&#x4E86;&#x8868;&#x8FBE;&#x8FD9;&#x4E2A;&#x7F8E;&#x597D;&#x7684;&#x613F;&#x671B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5728;<strong>&#x54CD;&#x5E94;&#x5934;</strong>&#x4E2D;&#x52A0;&#x5165;&#x4E86;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>Cache-Control: max-age=3600
ETag: W/&quot;121-171ca289ebf&quot;
Date: Thu, 30 Apr 2020 12:39:56 GMT
Last-Modified: Thu, 30 Apr 2020 08:16:31 GMT
</code></pre><p>&#x8FD9;&#x4E2A;&#x54CD;&#x5E94;&#x5934;&#x8868;&#x8FBE;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li><code>Cache-Control: max-age=3600</code>&#xFF0C;&#x6211;&#x5E0C;&#x671B;&#x4F60;&#x628A;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x7F13;&#x5B58;&#x65F6;&#x95F4;&#x662F;3600&#x79D2;&#xFF08;1&#x5C0F;&#x65F6;&#xFF09;</li>
<li><code>ETag: W/&quot;121-171ca289ebf&quot;</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x7F16;&#x53F7;&#x662F;<code>W/&quot;121-171ca289ebf&quot;</code></li>
<li><code>Date: Thu, 30 Apr 2020 12:39:56 GMT</code>&#xFF0C;&#x6211;&#x7ED9;&#x4F60;&#x54CD;&#x5E94;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x95F4;&#x662F;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;<code>2020-04-30 12:39:56</code></li>
<li><code>Last-Modified: Thu, 30 Apr 2020 08:16:31 GMT</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E00;&#x6B21;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x662F;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;<code>2020-04-30 08:16:31</code></li>
</ul>
<p>&#x8FD9;&#x4E2A;&#x7F8E;&#x597D;&#x7684;&#x7F13;&#x5B58;&#x613F;&#x671B;&#xFF0C;&#x5C31;&#x8FD9;&#x6837;&#x901A;&#x8FC7;&#x54CD;&#x5E94;&#x5934;&#x4F20;&#x9012;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x4E86;</p>
<p>&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x4F1A;&#x7406;&#x4F1A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x613F;&#x671B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x53EF;&#x80FD;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x7F13;&#x5B58;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x51D1;&#x5DE7;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5B83;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x90FD;&#x662F;&#x76F8;&#x4EB2;&#x76F8;&#x7231;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#xFF0C;&#x5F53;&#x5B83;&#x770B;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FD9;&#x4E2A;&#x54CD;&#x5E94;&#x5934;&#x8868;&#x8FBE;&#x7684;&#x7F8E;&#x597D;&#x613F;&#x671B;&#x540E;&#xFF0C;&#x7ACB;&#x5373;&#x5FD9;&#x8D77;&#x6765;&#xFF1A;</p>
<ul>
<li>&#x6D4F;&#x89C8;&#x5668;&#x628A;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x5F97;&#x5230;&#x7684;&#x54CD;&#x5E94;&#x4F53;&#x7F13;&#x5B58;&#x5230;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x6807;&#x8BB0;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x548C;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x6807;&#x8BB0;&#x8FD9;&#x6B21;&#x7F13;&#x5B58;&#x7684;&#x65F6;&#x95F4;&#x662F;3600&#x79D2;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x8BB0;&#x5F55;&#x670D;&#x52A1;&#x5668;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x662F;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;<code>2020-04-30 12:39:56</code></li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x8BB0;&#x5F55;&#x670D;&#x52A1;&#x5668;&#x7ED9;&#x4E88;&#x7684;&#x8D44;&#x6E90;&#x7F16;&#x53F7;<code>W/&quot;121-171ca289ebf&quot;</code></li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x8BB0;&#x5F55;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E00;&#x6B21;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x662F;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;<code>2020-04-30 08:16:31</code></li>
</ul>
<p>&#x8FD9;&#x4E00;&#x6B21;&#x7684;&#x8BB0;&#x5F55;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x5B83;&#x4E3A;&#x4EE5;&#x540E;&#x6D4F;&#x89C8;&#x5668;&#x8981;&#x4E0D;&#x8981;&#x53BB;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x5404;&#x79CD;&#x4F9D;&#x636E;&#x3002;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200430210430455.png" alt="image-20200430210430455" style="zoom:33%;">
<h4 class="mume-header" id="%E6%9D%A5%E8%87%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%BC%93%E5%AD%98%E6%8C%87%E4%BB%A4">&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</h4>

<p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x6536;&#x62FE;&#x597D;&#x884C;&#x674E;&#xFF0C;&#x51C6;&#x5907;&#x518D;&#x6B21;&#x8BF7;&#x6C42;<code>GET /index.js</code>&#x65F6;&#xFF0C;&#x5B83;&#x7A81;&#x7136;&#x60F3;&#x8D77;&#x4E86;&#x4E00;&#x4EF6;&#x4E8B;&#xFF1A;&#x6211;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x5728;&#x4E0D;&#x5728;&#x7F13;&#x5B58;&#x91CC;&#x5462;&#xFF1F;</p>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#x53BB;&#x5BFB;&#x627E;&#x662F;&#x5426;&#x6709;&#x7F13;&#x5B58;&#x7684;&#x8D44;&#x6E90;</p>
<p>&#x5BFB;&#x627E;&#x7684;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x7F13;&#x5B58;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5339;&#x914D;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x548C;&#x8DEF;&#x5F84;&#xFF1F;</li>
<li>&#x5982;&#x679C;&#x6709;&#xFF0C;&#x8BE5;&#x7F13;&#x5B58;&#x8D44;&#x6E90;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6548;&#x5462;&#xFF1F;</li>
</ol>
<p>&#x4EE5;&#x4E0A;&#x4E24;&#x4E2A;&#x9A8C;&#x8BC1;&#x4F1A;&#x5BFC;&#x81F4;&#x6D4F;&#x89C8;&#x5668;&#x4EA7;&#x751F;&#x4E0D;&#x540C;&#x7684;&#x884C;&#x4E3A;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200430212052228.png" alt="image-20200430212052228" style="zoom:50%;">
<img src="http://mdrs.yuanjin.tech/img/image-20200430214301507.png" alt="image-20200430214301507" style="zoom:33%;">
<p>&#x8981;&#x9A8C;&#x8BC1;&#x662F;&#x5426;&#x6709;&#x5339;&#x914D;&#x7684;&#x7F13;&#x5B58;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x9A8C;&#x8BC1;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;<code>GET</code>&#x548C;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;<code>/index.js</code>&#x662F;&#x5426;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x5B58;&#x5728;&#x5373;&#x53EF;</p>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5C31;&#x548C;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x8BA8;&#x8BBA;&#x7684;</p>
<p>&#x5173;&#x952E;&#x5728;&#x4E8E;&#x9A8C;&#x8BC1;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x6709;&#x6548;</p>
<p>&#x5982;&#x4F55;&#x9A8C;&#x8BC1;&#x5462;&#xFF1F;</p>
<p>&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x628A;<code>max-age + Date</code>&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x662F;&#x5426;&#x5927;&#x4E8E;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x7F13;&#x5B58;&#x8FD8;&#x6CA1;&#x6709;&#x8FC7;&#x671F;&#xFF0C;&#x4ECD;&#x7136;&#x6709;&#x6548;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x7F13;&#x5B58;&#x5931;&#x6548;&#x3002;</p>
<h5 class="mume-header" id="%E7%BC%93%E5%AD%98%E6%9C%89%E6%95%88">&#x7F13;&#x5B58;&#x6709;&#x6548;</h5>

<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x73B0;&#x7F13;&#x5B58;&#x6709;&#x6548;&#x65F6;&#xFF0C;&#x5B8C;&#x5168;&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x5373;&#x53EF;&#x5F97;&#x5230;&#x7ED3;&#x679C;</p>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x65AD;&#x5F00;&#x7F51;&#x7EDC;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x8D44;&#x6E90;&#x4ECD;&#x7136;&#x53EF;&#x7528;</p>
<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4F1A;&#x6781;&#x5927;&#x7684;&#x964D;&#x4F4E;&#x670D;&#x52A1;&#x5668;&#x538B;&#x529B;&#xFF0C;&#x4F46;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x66F4;&#x6539;&#x4E86;&#x8D44;&#x6E90;&#x540E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x7F13;&#x5B58;&#x6709;&#x6548;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</p>
<h5 class="mume-header" id="%E7%BC%93%E5%AD%98%E6%97%A0%E6%95%88">&#x7F13;&#x5B58;&#x65E0;&#x6548;</h5>

<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x73B0;&#x7F13;&#x5B58;&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x5B83;<strong>&#x5E76;&#x4E0D;&#x4F1A;&#x7B80;&#x5355;&#x7684;&#x628A;&#x7F13;&#x5B58;&#x5220;&#x9664;</strong>&#xFF0C;&#x800C;&#x662F;&#x62B1;&#x7740;&#x4E00;&#x4E1D;&#x5E0C;&#x671B;&#xFF0C;&#x60F3;&#x95EE;&#x95EE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6211;<strong>&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;&#x8FD8;&#x80FD;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x5417;</strong>&#xFF1F;</p>
<p>&#x4E8E;&#x662F;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;<strong>&#x5E26;&#x7F13;&#x5B58;&#x7684;&#x8BF7;&#x6C42;</strong></p>
<p>&#x6240;&#x8C13;&#x5E26;&#x7F13;&#x5B58;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x52A0;&#x5165;&#x4E86;&#x4EE5;&#x4E0B;&#x7684;&#x8BF7;&#x6C42;&#x5934;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>If-Modified-Since: Thu, 30 Apr 2020 08:16:31 GMT
If-None-Match: W/&quot;121-171ca289ebf&quot;
</code></pre><p>&#x5B83;&#x4EEC;&#x8868;&#x8FBE;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li><code>If-Modified-Since: Thu, 30 Apr 2020 08:16:31 GMT</code>&#xFF0C;&#x4EB2;&#xFF0C;&#x4F60;&#x66FE;&#x7ECF;&#x544A;&#x8BC9;&#x6211;&#xFF0C;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E00;&#x6B21;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x662F;&#x683C;&#x6797;&#x5A01;&#x6CBB;&#x65F6;&#x95F4;<code>2020-04-30 08:16:31</code>&#xFF0C;&#x8BF7;&#x95EE;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#x6709;&#x53D1;&#x751F;&#x53D8;&#x52A8;&#x5417;&#xFF1F;</li>
<li><code>If-None-Match: W/&quot;121-171ca289ebf&quot;</code>&#xFF0C;&#x4EB2;&#xFF0C;&#x4F60;&#x66FE;&#x7ECF;&#x544A;&#x8BC9;&#x6211;&#xFF0C;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x7F16;&#x53F7;&#x662F;<code>W/&quot;121-171ca289ebf</code>&#xFF0C;&#x8BF7;&#x95EE;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x7F16;&#x53F7;&#x53D1;&#x751F;&#x53D8;&#x52A8;&#x4E86;&#x5417;&#xFF1F;</li>
</ul>
<p>&#x5176;&#x5B9E;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x5FEB;&#x8BF4;&#xFF01;&#x8D44;&#x6E90;&#x5230;&#x5E95;&#x53D8;&#x4E86;&#x6CA1;&#x6709;&#xFF01;</p>
<p>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x53D1;&#x4E24;&#x4E2A;&#x4FE1;&#x606F;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x517C;&#x5BB9;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x53EA;&#x8BA4;<code>If-Modified-Since</code>&#xFF0C;&#x6709;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x53EA;&#x8BA4;<code>If-None-Match</code>&#xFF0C;&#x6709;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x4E24;&#x4E2A;&#x90FD;&#x8BA4;</p>
<blockquote>
<p>&#x76EE;&#x524D;&#x7684;&#x5F88;&#x591A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x53EA;&#x8981;&#x53D1;&#x73B0;<code>If-None-Match</code>&#x5B58;&#x5728;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x53BB;&#x770B;``If-Modified-Since`</p>
<p><code>If-Modified-Since</code>&#x662F;<code>http1.0</code>&#x7248;&#x672C;&#x7684;&#x89C4;&#x8303;&#xFF0C;<code>If-None-Match</code>&#x662F;<code>http1.1</code>&#x7684;&#x89C4;&#x8303;</p>
</blockquote>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x95EE;&#x9898;&#x53C8;&#x629B;&#x7ED9;&#x4E86;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8868;&#x6F14;&#x65F6;&#x95F4;&#x4E86;</p>
<p>&#x670D;&#x52A1;&#x5668;&#x53EF;&#x80FD;&#x4F1A;&#x4EA7;&#x751F;&#x4E24;&#x4E2A;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li>&#x7F13;&#x5B58;&#x5DF2;&#x7ECF;&#x5931;&#x6548;</li>
<li>&#x7F13;&#x5B58;&#x4ECD;&#x7136;&#x6709;&#x6548;</li>
</ul>
<p>&#x5982;&#x679C;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x2014;&#x2014;<strong>&#x7F13;&#x5B58;&#x5DF2;&#x7ECF;&#x5931;&#x6548;</strong>&#xFF0C;&#x90A3;&#x4E48;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x518D;&#x6B21;&#x7ED9;&#x4E88;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7684;&#x54CD;&#x5E94;&#xFF08;&#x54CD;&#x5E94;&#x7801;<code>200</code> &#x5E26;&#x54CD;&#x5E94;&#x4F53;&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x9644;&#x5E26;&#x4E0A;&#x65B0;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x5C31;&#x56DE;&#x5230;&#x4E86;&#x4E0A;&#x4E00;&#x8282;&#x2014;&#x2014;&#x6765;&#x81EA;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</p>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x7F13;&#x5B58;&#x65B0;&#x7684;&#x5185;&#x5BB9;</p>
<p>&#x4F46;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x89C9;&#x5F97;<strong>&#x7F13;&#x5B58;&#x4ECD;&#x7136;&#x6709;&#x6548;</strong>&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x79CD;&#x6781;&#x5176;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</p>
<ul>
<li>&#x54CD;&#x5E94;&#x7801;&#x4E3A;<code>304 Not Modified</code></li>
<li>&#x65E0;&#x54CD;&#x5E94;&#x4F53;</li>
<li>&#x54CD;&#x5E94;&#x5934;&#x5E26;&#x4E0A;&#x65B0;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;&#xFF0C;&#x89C1;&#x4E0A;&#x4E00;&#x8282;&#x2014;&#x2014;&#x6765;&#x81EA;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</li>
</ul>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x300C;&#x4F60;&#x7684;&#x7F13;&#x5B58;&#x8D44;&#x6E90;&#x4ECD;&#x7136;&#x53EF;&#x7528;&#xFF0C;&#x6211;&#x7ED9;&#x4F60;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7F13;&#x5B58;&#x65F6;&#x95F4;&#xFF0C;&#x4F60;&#x90A3;&#x8FB9;&#x66F4;&#x65B0;&#x4E00;&#x4E0B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x300D;</p>
<p>&#x4E8E;&#x662F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x7EE7;&#x7EED;happy&#x7684;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x4E86;</p>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x51CF;&#x5C11;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x8D44;&#x6E90;&#x8FD8;&#x6709;&#x6548;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x4E0D;&#x4F1A;&#x4F20;&#x8F93;&#x6D88;&#x606F;&#x4F53;</p>
<p>&#x5B83;&#x4EEC;&#x5B8C;&#x6574;&#x7684;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200430225326001.png" alt="image-20200430225326001" style="zoom:33%;">
<h4 class="mume-header" id="%E7%BB%86%E8%8A%82">&#x7EC6;&#x8282;</h4>

<p>&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x4E86;&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;&#x548C;&#x8FC7;&#x7A0B;</p>
<p>&#x4F46;&#x5176;&#x4E2D;&#x4ECD;&#x7136;&#x6709;&#x4E0D;&#x5C11;&#x7EC6;&#x8282;&#x503C;&#x5F97;&#x6211;&#x4EEC;&#x6CE8;&#x610F;</p>
<h5 class="mume-header" id="cache-control">Cache-Control</h5>

<p>&#x5728;&#x4E0A;&#x8FF0;&#x7684;&#x8BB2;&#x89E3;&#x4E2D;&#xFF0C;<code>Cache-Control</code>&#x662F;&#x670D;&#x52A1;&#x5668;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x54CD;&#x5E94;&#x7684;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5934;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;<code>max-age</code>&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x7F13;&#x5B58;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<code>Cache-Control</code>&#x8FD8;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E0B;&#x9762;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x503C;&#xFF1A;</p>
<ul>
<li><code>public</code>&#xFF1A;&#x6307;&#x793A;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x662F;&#x516C;&#x5F00;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x6709;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x8D44;&#x6E90;&#xFF0C;&#x6240;&#x6709;&#x4EBA;&#x770B;&#x5230;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x5BF9;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x800C;&#x8A00;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x53EF;&#x80FD;&#x6709;&#x7528;&#x3002;&#x672C;&#x7740;&#x300C;&#x6211;&#x544A;&#x77E5;&#xFF0C;&#x4F60;&#x968F;&#x610F;&#x300D;&#x7684;&#x539F;&#x5219;&#xFF0C;<code>http</code>&#x534F;&#x8BAE;&#x4E2D;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x90FD;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x670D;&#x52A1;&#x5668;&#x544A;&#x8BC9;&#x53E6;&#x4E00;&#x7AEF;&#x8BE6;&#x7EC6;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x81F3;&#x4E8E;&#x53E6;&#x4E00;&#x7AEF;&#x7528;&#x4E0D;&#x7528;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x5B83;&#x81EA;&#x5DF1;&#x3002;</li>
<li><code>private</code>&#xFF1A;&#x6307;&#x793A;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x662F;&#x79C1;&#x6709;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x6709;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x8D44;&#x6E90;&#xFF0C;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x770B;&#x5230;&#x7684;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x5BF9;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x800C;&#x8A00;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x53EF;&#x80FD;&#x6709;&#x7528;&#x3002;&#x672C;&#x7740;&#x300C;&#x6211;&#x544A;&#x77E5;&#xFF0C;&#x4F60;&#x968F;&#x610F;&#x300D;&#x7684;&#x539F;&#x5219;&#xFF0C;<code>http</code>&#x534F;&#x8BAE;&#x4E2D;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x90FD;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x670D;&#x52A1;&#x5668;&#x544A;&#x8BC9;&#x53E6;&#x4E00;&#x7AEF;&#x8BE6;&#x7EC6;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x81F3;&#x4E8E;&#x53E6;&#x4E00;&#x7AEF;&#x7528;&#x4E0D;&#x7528;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x5B83;&#x81EA;&#x5DF1;&#x3002;</li>
<li><code>no-cache</code>&#xFF1A;&#x544A;&#x77E5;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7F13;&#x5B58;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x8981;<strong>&#x76F4;&#x63A5;</strong>&#x4F7F;&#x7528;&#x5B83;&#x3002;&#x5F53;&#x4F60;&#x7F13;&#x5B58;&#x4E4B;&#x540E;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x6BCF;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x90FD;&#x9700;&#x8981;&#x9644;&#x5E26;&#x7F13;&#x5B58;&#x6307;&#x4EE4;&#xFF0C;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x544A;&#x8BC9;&#x4F60;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x6709;&#x6CA1;&#x6709;&#x8FC7;&#x671F;&#x3002;&#x89C1;&#xFF1A;&#x300C;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4; -  &#x7F13;&#x5B58;&#x65E0;&#x6548;&#x300D;</li>
<li><code>no-store</code>&#xFF1A;&#x544A;&#x77E5;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E0D;&#x8981;&#x5BF9;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x505A;&#x4EFB;&#x4F55;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x6BCF;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x90FD;&#x6309;&#x7167;&#x6B63;&#x5E38;&#x7684;&#x666E;&#x901A;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x3002;&#x82E5;&#x8BBE;&#x7F6E;&#x4E86;&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x4E0D;&#x4F1A;&#x5BF9;&#x8BE5;&#x8D44;&#x6E90;&#x505A;&#x51FA;&#x4EFB;&#x4F55;&#x7684;&#x7F13;&#x5B58;&#x5904;&#x7406;&#x3002;</li>
<li><code>max-age</code>&#xFF1A;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;</li>
</ul>
<p>&#x6BD4;&#x5982;&#xFF0C;<code>Cache-Control: public, max-age=3600</code>&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x516C;&#x5F00;&#x8D44;&#x6E90;&#xFF0C;&#x8BF7;&#x7F13;&#x5B58;1&#x4E2A;&#x5C0F;&#x65F6;&#x3002;</p>
<h5 class="mume-header" id="expire">Expire</h5>

<p>&#x5728;<code>http1.0</code>&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x662F;&#x901A;&#x8FC7;<code>Expire</code>&#x54CD;&#x5E94;&#x5934;&#x6765;&#x6307;&#x5B9A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x70B9;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>Expire: Thu, 30 Apr 2020 23:38:38 GMT
</code></pre><p>&#x5230;&#x4E86;<code>http1.1</code>&#x7248;&#x672C;&#xFF0C;&#x5DF2;&#x66F4;&#x6539;&#x4E3A;&#x901A;&#x8FC7;<code>Cache-Control</code>&#x7684;<code>max-age</code>&#x6765;&#x8BB0;&#x5F55;&#x4E86;&#x3002;</p>
<h5 class="mume-header" id="%E8%AE%B0%E5%BD%95%E7%BC%93%E5%AD%98%E6%97%B6%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F">&#x8BB0;&#x5F55;&#x7F13;&#x5B58;&#x65F6;&#x7684;&#x6709;&#x6548;&#x671F;</h5>

<p>&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x6309;&#x7167;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5934;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x81EA;&#x52A8;&#x8BB0;&#x5F55;&#x7F13;&#x5B58;&#x5230;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x5404;&#x79CD;&#x76F8;&#x5173;&#x4FE1;&#x606F;</p>
<p>&#x5728;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E2D;&#xFF0C;<strong>&#x6709;&#x6548;&#x671F;</strong>&#x5C24;&#x4E3A;&#x5173;&#x952E;&#xFF0C;&#x5B83;&#x51B3;&#x5B9A;&#x4E86;&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x4E45;</p>
<p>&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x6839;&#x636E;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x540C;&#x7684;&#x54CD;&#x5E94;&#x60C5;&#x51B5;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x6709;&#x6548;&#x671F;</p>
<p>&#x5177;&#x4F53;&#x7684;&#x6709;&#x6548;&#x671F;&#x8BBE;&#x7F6E;&#xFF0C;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x8FDB;&#x884C;&#xFF1A;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200501075337464.png" alt="image-20200501075337464" style="zoom:33%;">
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5F53;<code>max-age</code>&#x8BBE;&#x7F6E;&#x4E3A;0&#x65F6;&#xFF0C;&#x7F13;&#x5B58;&#x7ACB;&#x5373;&#x8FC7;&#x671F;</p>
<p>&#x867D;&#x7136;&#x7ACB;&#x5373;&#x8FC7;&#x671F;&#xFF0C;&#x4F46;&#x7F13;&#x5B58;&#x4ECD;&#x7136;&#x88AB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x8BF7;&#x6C42;&#x901A;&#x8FC7;&#x7F13;&#x5B58;&#x6307;&#x4EE4;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6765;&#x786E;&#x8BA4;&#x8D44;&#x6E90;&#x662F;&#x5426;&#x88AB;&#x66F4;&#x6539;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;<code>Cache-Control: max-age=0</code>&#x7C7B;&#x4F3C;&#x4E8E;<code>Cache-Control: no-cache</code></p>
<h5 class="mume-header" id="pragma">Pragma</h5>

<p>&#x8FD9;&#x662F;<code>http1.0</code>&#x7248;&#x672C;&#x7684;&#x6D88;&#x606F;&#x5934;</p>
<p>&#x5F53;&#x8BE5;&#x6D88;&#x606F;&#x5934;&#x51FA;&#x73B0;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x65F6;&#xFF0C;&#x662F;&#x5411;&#x670D;&#x52A1;&#x5668;&#x8868;&#x8FBE;&#xFF1A;&#x4E0D;&#x8981;&#x8003;&#x8651;&#x4EFB;&#x4F55;&#x7F13;&#x5B58;&#xFF0C;&#x7ED9;&#x6211;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x5728;<code>http1.1</code>&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<strong>&#x8BF7;&#x6C42;&#x5934;</strong>&#x4E2D;&#x52A0;&#x5165;<code>Cache-Control: no-cache</code>&#x5B9E;&#x73B0;&#x540C;&#x6837;&#x7684;&#x542B;&#x4E49;&#x3002;</p>
<blockquote>
<p>&#x662F;&#x7684;&#xFF0C;<code>Cache-Control</code>&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x5728;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;</p>
</blockquote>
<p>&#x5728;<code>Chrome</code>&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8C03;&#x8BD5;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x52FE;&#x9009;&#x4E86;<code>Disable cache</code>&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x4F1A;&#x9644;&#x5E26;&#x8BE5;&#x4FE1;&#x606F;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200501080330131.png" alt="image-20200501080330131" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200501080330131
</p>
<h5 class="mume-header" id="vary">Vary</h5>

<p>&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x5426;&#x6709;&#x7F13;&#x5B58;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5224;&#x65AD;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x548C;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x662F;&#x5426;&#x5339;&#x914D;&#xFF0C;&#x53EF;&#x80FD;&#x8FD8;&#x8981;&#x5224;&#x65AD;&#x5934;&#x90E8;&#x4FE1;&#x606F;&#x662F;&#x5426;&#x5339;&#x914D;&#x3002;</p>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>Vary</code>&#x5B57;&#x6BB5;&#x6765;&#x6307;&#x5B9A;&#x8981;&#x533A;&#x5206;&#x7684;&#x6D88;&#x606F;&#x5934;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;<code>GET /personal.html</code>&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x65F6;&#xFF0C;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;<code>cookie</code>&#x7684;&#x503C;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x9875;&#x9762;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;</p>
<p>&#x5982;&#x679C;&#x8FD8;&#x6309;&#x7167;&#x4E4B;&#x524D;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x4EC5;&#x4EC5;&#x5339;&#x914D;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x548C;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#xFF0C;&#x5982;&#x679C;<code>cookie</code>&#x53D8;&#x52A8;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5F97;&#x5230;&#x7684;&#x4ECD;&#x7136;&#x662F;&#x4E4B;&#x524D;&#x7684;&#x9875;&#x9762;&#x3002;</p>
<p>&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200501082103089.png" alt="image-20200501082103089" style="zoom:33%;">
<h5 class="mume-header" id="%E4%BD%BF%E7%94%A8%E7%89%88%E6%9C%AC%E5%8F%B7%E6%88%96hash">&#x4F7F;&#x7528;&#x7248;&#x672C;&#x53F7;&#x6216;hash</h5>

<p>&#x5982;&#x679C;&#x4F60;&#x662F;&#x4E00;&#x4E2A;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x4F7F;&#x7528;&#x8FC7;<code>vue</code>&#x6216;&#x5176;&#x4ED6;&#x57FA;&#x4E8E;<code>webpack</code>&#x642D;&#x5EFA;&#x7684;&#x5DE5;&#x7A0B;</p>
<p>&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x6253;&#x5305;&#x7684;&#x7ED3;&#x679C;&#x4E2D;&#x5F88;&#x591A;&#x6587;&#x4EF6;&#x540D;&#x7C7B;&#x4F3C;&#x4E8E;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>app.68297cd8.css
</code></pre><p>&#x6587;&#x4EF6;&#x7684;&#x4E2D;&#x95F4;&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x4E86;<code>hash</code>&#x503C;</p>
<p>&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x5927;&#x80C6;&#x7684;&#x3001;&#x957F;&#x65F6;&#x95F4;&#x7684;&#x7F13;&#x5B58;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x51CF;&#x8F7B;&#x670D;&#x52A1;&#x5668;&#x7684;&#x538B;&#x529B;</p>
<p>&#x5F53;&#x6587;&#x4EF6;&#x6539;&#x52A8;&#x540E;&#xFF0C;&#x5B83;&#x7684;&#x6587;&#x4EF6;<code>hash</code>&#x503C;&#x4E5F;&#x4F1A;&#x968F;&#x4E4B;&#x800C;&#x53D8;&#xFF0C;&#x6BD4;&#x5982;&#x53D8;&#x6210;&#x4E86;<code>app.446fccb8.css</code></p>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x8BF7;&#x6C42;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x8DEF;&#x5F84;&#x4ECE;<code>/app.68297cd8.css</code>&#x53D8;&#x6210;&#x4E86;<code>app.446fccb8.css</code>&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x7F13;&#x5B58;&#x8DEF;&#x5F84;&#x65E0;&#x6CD5;&#x5339;&#x914D;&#x5230;&#xFF0C;&#x56E0;&#x6B64;&#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x6765;&#x83B7;&#x53D6;&#x65B0;&#x8D44;&#x6E90;&#x4E86;&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x662F;&#x73B0;&#x4EE3;&#x6D41;&#x884C;&#x7684;&#x505A;&#x6CD5;&#x3002;</p>
<p>&#x800C;&#x5728;&#x53E4;&#x8001;&#x7684;&#x5E74;&#x4EE3;&#xFF0C;&#x8FD8;&#x6CA1;&#x6709;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x4EBA;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x5728;&#x8D44;&#x6E90;&#x8DEF;&#x5F84;&#x540E;&#x9762;&#x52A0;&#x5165;&#x7248;&#x672C;&#x53F7;&#x6765;&#x83B7;&#x53D6;&#x65B0;&#x7248;&#x672C;&#x7684;&#x6587;&#x4EF6;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x9875;&#x9762;&#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;css&#x8D44;&#x6E90;<code>app.css</code>&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x7684;&#x5F15;&#x5165;&#x65B9;&#x5F0F;&#x662F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/app.css?v=1.0.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</pre><p>&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x7F13;&#x5B58;&#x7684;&#x8DEF;&#x5F84;&#x662F;<code>/app.css?v=1.0.0</code></p>
<p>&#x5F53;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7248;&#x672C;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x7ED9;&#x4E88;&#x65B0;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x8BA9;html&#x4E2D;&#x7684;&#x8DEF;&#x5F84;&#x53D1;&#x751F;&#x53D8;&#x52A8;</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/app.css?v=1.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</pre><p>&#x7531;&#x4E8E;&#x65B0;&#x7684;&#x8DEF;&#x5F84;&#x65E0;&#x6CD5;&#x547D;&#x4E2D;&#x7F13;&#x5B58;&#xFF0C;&#x4E8E;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x65B0;&#x7684;&#x666E;&#x901A;&#x8BF7;&#x6C42;&#x6765;&#x83B7;&#x53D6;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;</p>
<h4 class="mume-header" id="%E6%80%BB%E7%BB%93-2">&#x603B;&#x7ED3;</h4>

<p>&#x6700;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E24;&#x4F4D;&#x5927;&#x4F6C;&#x7684;&#x89C6;&#x89D2;&#xFF0C;&#x6765;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x4EE5;&#x4E0A;&#x5185;&#x5BB9;</p>
<h5 class="mume-header" id="%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%86%E8%A7%92">&#x670D;&#x52A1;&#x5668;&#x89C6;&#x89D2;</h5>

<p>&#x670D;&#x52A1;&#x5668;&#x65E0;&#x6CD5;&#x77E5;&#x9053;&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5E95;&#x6709;&#x6CA1;&#x6709;&#x50CF;&#x6D4F;&#x89C8;&#x5668;&#x90A3;&#x6837;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x53EA;&#x7BA1;&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684;&#x60C5;&#x51B5;&#x6765;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x54CD;&#x5E94;</p>
<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/image-20200501083702987.png" alt="image-20200501083702987" style="max-width:100%">
</p>
<p class="markdown-img-description">
  image-20200501083702987
</p>
<p>&#x5F88;&#x591A;&#x540E;&#x7AEF;&#x8BED;&#x8A00;&#x642D;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x4F1A;&#x81EA;&#x5E26;&#x81EA;&#x5DF1;&#x7684;&#x9ED8;&#x8BA4;&#x7F13;&#x5B58;&#x89C4;&#x5219;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x4FEE;&#x6539;</p>
<h5 class="mume-header" id="%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%86%E8%A7%92">&#x6D4F;&#x89C8;&#x5668;&#x89C6;&#x89D2;</h5>

<p>&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#x65F6;&#x4F1A;&#x5224;&#x65AD;&#x8981;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200501084258712.png" alt="image-20200501084258712" style="zoom:50%;">
<p>&#x5F53;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x6839;&#x636E;&#x7F13;&#x5B58;&#x6307;&#x4EE4;&#x8FDB;&#x884C;&#x5904;&#x7406;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200501084559394.png" alt="image-20200501084559394" style="zoom:50%;">
<h3 class="mume-header" id="%E5%9C%BA%E6%99%AF-%E5%AF%8C%E6%96%87%E6%9C%AC%E6%A1%86">&#x573A;&#x666F;-&#x5BCC;&#x6587;&#x672C;&#x6846;</h3>

<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        const E = window.wangEditor
        const editor = new E(&quot;#div1&quot;)
        // &#x6216;&#x8005; const editor = new E(document.getElementById(&apos;div1&apos;))
        editor.create()
</pre><h3 class="mume-header" id="websocket%E5%8E%9F%E7%90%86">websocket&#x539F;&#x7406;</h3>

<p>//&#x957F;&#x8FDE;&#x63A5;&#xFF0C;&#x6BD4;&#x5982;&#x80A1;&#x7968;&#xFF0C;&#x6CA1;&#x5FC5;&#x8981;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x90FD;&#x5EFA;&#x7ACB;&#x65B0;&#x7684;&#x8FDE;&#x63A5;<br>
&#x5728;websocket&#x7684;http&#x63E1;&#x624B;&#x9636;&#x6BB5;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x9700;&#x8981;&#x5305;&#x542B;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: [key]
</code></pre><p>&#x5176;&#x4E2D;&#xFF0C;<code>Sec-WebSocket-Accept</code>&#x7684;&#x503C;&#x6765;&#x81EA;&#x4E8E;&#x4EE5;&#x4E0B;&#x7B97;&#x6CD5;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">base64</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token maybe-class-name">Sec</span><span class="token operator">-</span><span class="token maybe-class-name">WebSocket</span><span class="token operator">-</span><span class="token maybe-class-name">Key</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span><span class="token punctuation">)</span> 
</pre><p>&#x5728;<code>node</code>&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x83B7;&#x5F97;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token method function property-access">createHash</span><span class="token punctuation">(</span><span class="token string">&quot;sha1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hash<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>requestKey <span class="token operator">+</span> <span class="token string">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> hash<span class="token punctuation">.</span><span class="token method function property-access">digest</span><span class="token punctuation">(</span><span class="token string">&quot;base64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x5176;&#x4E2D;&#xFF0C;<code>requestKey</code>&#x6765;&#x81EA;&#x4E8E;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x7684;<code>Sec-WebSocket-Key</code></p>
<p>&#x670D;&#x52A1;&#x7AEF;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token method function property-access">once</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> httpContent <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> parts <span class="token operator">=</span> httpContent<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parts<span class="token punctuation">.</span><span class="token method function property-access">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parts <span class="token operator">=</span> parts
      <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> s<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> i <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>s<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">fromEntries</span><span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token method function property-access">createHash</span><span class="token punctuation">(</span><span class="token string">&quot;sha1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hash<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>
      headers<span class="token punctuation">[</span><span class="token string">&quot;Sec-WebSocket-Key&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> hash<span class="token punctuation">.</span><span class="token method function property-access">digest</span><span class="token punctuation">(</span><span class="token string">&quot;base64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x54CD;&#x5E94;</span>
    socket<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">5008</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x5BA2;&#x6237;&#x7AEF;</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>&#x53D1;&#x9001;&#x6570;&#x636E;&#x5230;&#x670D;&#x52A1;&#x5668;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// &#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x6D4F;&#x89C8;&#x5668;&#xFF09;websocket</span>
      <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:5008&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;websocket&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x53D1;&#x9001;&#x8FDE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x5668;</span>
      ws<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// http&#x63E1;&#x624B;&#x5B8C;&#x6210;</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8FDE;&#x63A5;&#x5DF2;&#x5EFA;&#x7ACB;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      ws<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6765;&#x81EA;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      ws<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;&#x901A;&#x9053;&#x5173;&#x95ED;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ws<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">//   ws.close(); //&#x5BA2;&#x6237;&#x7AEF;&#x4E3B;&#x52A8;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="socketio"><a href="http://socket.io">socket.io</a></h3>

<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>&#x53D1;&#x9001;&#x6570;&#x636E;&#x5230;&#x670D;&#x52A1;&#x5668;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/socket.io/2.3.0/socket.io.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> socket <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        socket<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;msg from client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      socket<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      socket<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;disconnect&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="csrf%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1">CSRF&#x653B;&#x51FB;&#x548C;&#x9632;&#x5FA1;</h3>

<h4 class="mume-header" id="csrf-%E7%89%B9%E7%82%B9%E5%92%8C%E5%8E%9F%E7%90%86">CSRF &#x7279;&#x70B9;&#x548C;&#x539F;&#x7406;</h4>

<p>CSRF&#xFF1A;Cross Site Request Forgery&#xFF0C;&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;</p>
<p>&#x672C;&#x8D28;&#x662F;&#xFF1A;&#x6076;&#x610F;&#x7F51;&#x7AD9;&#x628A;<strong>&#x6B63;&#x5E38;&#x7528;&#x6237;</strong>&#x4F5C;&#x4E3A;<strong>&#x5A92;&#x4ECB;</strong>&#xFF0C;&#x901A;&#x8FC7;&#x6A21;&#x62DF;&#x6B63;&#x5E38;&#x7528;&#x6237;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x653B;&#x51FB;&#x5176;<strong>&#x767B;&#x5F55;&#x8FC7;</strong>&#x7684;&#x7AD9;&#x70B9;&#x3002;</p>
<img src="http://mdrs.yuanjin.tech/img/image-20200508122744169.png" alt="image-20200508122744169" style="zoom:50%;">
<p>&#x5B83;&#x7684;&#x539F;&#x7406;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x6B63;&#x5E38;&#x7AD9;&#x70B9;&#xFF0C;&#x767B;&#x5F55;&#x540E;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x6B63;&#x5E38;&#x7AD9;&#x70B9;&#x7684;&#x4EE4;&#x724C;&#xFF0C;&#x4EE5;cookie&#x7684;&#x5F62;&#x5F0F;&#x4FDD;&#x5B58;</li>
</ol>
<img src="http://mdrs.yuanjin.tech/img/image-20200508123116104.png" alt="image-20200508123116104" style="zoom:50%;">
<ol start="2">
<li>&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x6076;&#x610F;&#x7AD9;&#x70B9;&#xFF0C;&#x6076;&#x610F;&#x7AD9;&#x70B9;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x5F62;&#x5F0F;&#x53BB;&#x8BF7;&#x6C42;&#x4E86;&#x6B63;&#x5E38;&#x7AD9;&#x70B9;&#xFF08;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;&#xFF09;&#xFF0C;&#x8FEB;&#x4F7F;&#x6B63;&#x5E38;&#x7528;&#x6237;&#x628A;&#x4EE4;&#x724C;&#x4F20;&#x9012;&#x5230;&#x6B63;&#x5E38;&#x7AD9;&#x70B9;&#xFF0C;&#x5B8C;&#x6210;&#x653B;&#x51FB;</li>
</ol>
<img src="http://mdrs.yuanjin.tech/img/image-20200508123401591.png" alt="image-20200508123401591" style="zoom:50%;">
<h4 class="mume-header" id="%E9%98%B2%E5%BE%A1">&#x9632;&#x5FA1;</h4>

<h5 class="mume-header" id="cookie%E7%9A%84samesite">cookie&#x7684;SameSite</h5>

<p>&#x73B0;&#x5728;&#x5F88;&#x591A;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x652F;&#x6301;<strong>&#x7981;&#x6B62;&#x8DE8;&#x57DF;&#x9644;&#x5E26;&#x7684;cookie</strong>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x628A;cookie&#x8BBE;&#x7F6E;&#x7684;<code>SameSite</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>Strict</code>&#x5373;&#x53EF;</p>
<p><code>SameSite</code>&#x6709;&#x4EE5;&#x4E0B;&#x53D6;&#x503C;&#xFF1A;</p>
<ul>
<li>Strict&#xFF1A;&#x4E25;&#x683C;&#xFF0C;&#x6240;&#x6709;&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x90FD;&#x4E0D;&#x9644;&#x5E26;cookie&#xFF0C;&#x6709;&#x65F6;&#x4F1A;&#x5BFC;&#x81F4;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x4E0D;&#x597D;</li>
<li>Lax&#xFF1A;&#x5BBD;&#x677E;&#xFF0C;&#x6240;&#x6709;&#x8DE8;&#x7AD9;&#x7684;&#x8D85;&#x94FE;&#x63A5;&#x3001;GET&#x8BF7;&#x6C42;&#x7684;&#x8868;&#x5355;&#x3001;&#x9884;&#x52A0;&#x8F7D;&#x8FDE;&#x63A5;&#x65F6;&#x4F1A;&#x53D1;&#x9001;cookie&#xFF0C;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0D;&#x53D1;&#x9001;</li>
<li>None&#xFF1A;&#x65E0;&#x9650;&#x5236;</li>
</ul>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x6781;&#x5176;&#x6709;&#x6548;&#xFF0C;&#x4F46;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x662F;&#xFF1A;&#x7528;&#x6237;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x592A;&#x65E7;&#x7684;&#x6D4F;&#x89C8;&#x5668;</p>
<h5 class="mume-header" id="%E9%AA%8C%E8%AF%81referer%E5%92%8Corigin">&#x9A8C;&#x8BC1;referer&#x548C;Origin</h5>

<p>&#x9875;&#x9762;&#x4E2D;&#x7684;&#x4E8C;&#x6B21;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x9644;&#x5E26;referer&#x6216;Origin&#x8BF7;&#x6C42;&#x5934;&#xFF0C;&#x5411;&#x670D;&#x52A1;&#x5668;&#x8868;&#x793A;&#x8BE5;&#x8BF7;&#x6C42;&#x6765;&#x81EA;&#x4E8E;&#x54EA;&#x4E2A;&#x6E90;&#x6216;&#x9875;&#x9762;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x5934;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p>
<p>&#x4F46;&#x67D0;&#x4E9B;&#x6D4F;&#x89C8;&#x5668;&#x7684;referer&#x662F;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x6237;&#x7981;&#x6B62;&#x7684;&#xFF0C;&#x5C3D;&#x7BA1;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6781;&#x5C11;</p>
<h5 class="mume-header" id="%E4%BD%BF%E7%94%A8%E9%9D%9Ecookie%E4%BB%A4%E7%89%8C">&#x4F7F;&#x7528;&#x975E;cookie&#x4EE4;&#x724C;</h5>

<p>&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x8981;&#x6C42;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x9700;&#x8981;&#x5728;&#x8BF7;&#x6C42;&#x4F53;&#x6216;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x9644;&#x5E26;token</p>
<p>&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF1A;authorization: token</p>
<h5 class="mume-header" id="%E9%AA%8C%E8%AF%81%E7%A0%81">&#x9A8C;&#x8BC1;&#x7801;</h5>

<p>&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x8981;&#x9632;&#x6B62;CSRF&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x5FC5;&#x987B;&#x8981;&#x9644;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;</p>
<p>&#x4E0D;&#x597D;&#x7684;&#x5730;&#x65B9;&#x662F;&#x5BB9;&#x6613;&#x628A;&#x6B63;&#x5E38;&#x7684;&#x7528;&#x6237;&#x903C;&#x75AF;</p>
<h5 class="mume-header" id="%E8%A1%A8%E5%8D%95%E9%9A%8F%E6%9C%BA%E6%95%B0">&#x8868;&#x5355;&#x968F;&#x673A;&#x6570;</h5>

<p>&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x6E32;&#x67D3;&#x65F6;&#xFF0C;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x6570;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x65F6;&#x8981;&#x63D0;&#x4EA4;&#x8FD9;&#x4E2A;&#x968F;&#x673A;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;</p>
<p>&#x8BE5;&#x968F;&#x673A;&#x6570;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7684;</p>
<p>&#x6D41;&#x7A0B;&#xFF1A;</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8BF7;&#x6C42;&#x6DFB;&#x52A0;&#x5B66;&#x751F;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x4F20;&#x9012;cookie</li>
<li>&#x670D;&#x52A1;&#x5668;
<ol>
<li>&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x6570;&#xFF0C;&#x653E;&#x5230;session&#x4E2D;</li>
<li>&#x751F;&#x6210;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x8868;&#x5355;&#x4E2D;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x9690;&#x85CF;&#x7684;&#x8868;&#x5355;&#x57DF;<code>&lt;input type=&quot;hidden&quot; name=&quot;hash&quot; value=&quot;&lt;%=session[&apos;key&apos;] %&gt;&quot;&gt;</code></li>
</ol>
</li>
<li>&#x586B;&#x5199;&#x597D;&#x4FE1;&#x606F;&#x540E;&#xFF0C;&#x63D0;&#x4EA4;&#x8868;&#x5355;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x9690;&#x85CF;&#x7684;&#x968F;&#x673A;&#x6570;</li>
<li>&#x670D;&#x52A1;&#x5668;
<ol>
<li>&#x5148;&#x62FF;&#x5230;cookie&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x767B;&#x5F55;&#x8FC7;</li>
<li>&#x5BF9;&#x6BD4;&#x63D0;&#x4EA4;&#x8FC7;&#x6765;&#x7684;&#x968F;&#x673A;&#x6570;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x968F;&#x673A;&#x6570;&#x662F;&#x5426;&#x4E00;&#x81F4;</li>
<li>&#x6E05;&#x9664;&#x6389;session&#x4E2D;&#x7684;&#x968F;&#x673A;&#x6570;</li>
</ol>
</li>
</ol>
<h5 class="mume-header" id="%E4%BA%8C%E6%AC%A1%E9%AA%8C%E8%AF%81">&#x4E8C;&#x6B21;&#x9A8C;&#x8BC1;</h5>

<p>&#x5F53;&#x505A;&#x51FA;&#x654F;&#x611F;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x8FDB;&#x884C;&#x4E8C;&#x6B21;&#x9A8C;&#x8BC1;</p>
<h3 class="mume-header" id="xss%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1">XSS&#x653B;&#x51FB;&#x548C;&#x9632;&#x5FA1;</h3>

<p>XSS&#xFF1A;Cross Site Scripting &#x8DE8;&#x7AD9;&#x811A;&#x672C;&#x653B;&#x51FB;</p>
<h4 class="mume-header" id="%E5%AD%98%E5%82%A8%E5%9E%8Bxss">&#x5B58;&#x50A8;&#x578B;XSS</h4>

<ol>
<li>
<p>&#x6076;&#x610F;&#x7528;&#x6237;&#x63D0;&#x4EA4;&#x4E86;&#x6076;&#x610F;&#x5185;&#x5BB9;&#x5230;&#x670D;&#x52A1;&#x5668;</p>
</li>
<li>
<p>&#x670D;&#x52A1;&#x5668;&#x6CA1;&#x6709;&#x8BC6;&#x522B;&#xFF0C;&#x4FDD;&#x5B58;&#x4E86;&#x6076;&#x610F;&#x5185;&#x5BB9;&#x5230;&#x6570;&#x636E;&#x5E93;</p>
</li>
<li>
<p>&#x6B63;&#x5E38;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;</p>
</li>
<li>
<p>&#x670D;&#x52A1;&#x5668;&#x5728;&#x4E0D;&#x77E5;&#x60C5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7ED9;&#x4E88;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x6076;&#x610F;&#x5185;&#x5BB9;&#xFF0C;&#x8BA9;&#x6B63;&#x5E38;&#x7528;&#x6237;&#x906D;&#x5230;&#x653B;&#x51FB;</p>
</li>
</ol>
<h4 class="mume-header" id="%E5%8F%8D%E5%B0%84%E5%9E%8B">&#x53CD;&#x5C04;&#x578B;</h4>

<ol>
<li>&#x6076;&#x610F;&#x7528;&#x6237;&#x5206;&#x4EAB;&#x4E86;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7F51;&#x7AD9;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x94FE;&#x63A5;&#x4E2D;&#x5E26;&#x6709;&#x6076;&#x610F;&#x5185;&#x5BB9;</li>
<li>&#x6B63;&#x5E38;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x4E86;&#x8BE5;&#x94FE;&#x63A5;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x5728;&#x4E0D;&#x77E5;&#x60C5;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x628A;&#x94FE;&#x63A5;&#x7684;&#x6076;&#x610F;&#x5185;&#x5BB9;&#x8BFB;&#x53D6;&#x4E86;&#x51FA;&#x6765;&#xFF0C;&#x653E;&#x8FDB;&#x4E86;&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x8BA9;&#x6B63;&#x5E38;&#x7528;&#x6237;&#x906D;&#x5230;&#x653B;&#x51FB;</li>
</ol>
<h4 class="mume-header" id="dom%E5%9E%8B">DOM&#x578B;</h4>

<ol>
<li>&#x6076;&#x610F;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x4EFB;&#x4F55;&#x65B9;&#x5F0F;&#xFF0C;&#x5411;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x6CE8;&#x5165;&#x4E86;&#x4E00;&#x4E9B;dom&#x5143;&#x7D20;&#xFF0C;&#x4ECE;&#x800C;&#x5F71;&#x54CD;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x7684;dom&#x7ED3;&#x6784;</li>
<li>&#x666E;&#x901A;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65F6;&#xFF0C;&#x8FD0;&#x884C;&#x7684;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6B63;&#x5E38;js&#x4EE3;&#x7801;</li>
</ol>
<h3 class="mume-header" id="nodejs%E7%9A%84%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86">nodejs&#x7684;&#x7EC4;&#x6210;&#x539F;&#x7406;</h3>

<p class="markdown-p-center">
  <img src="http://mdrs.yuanjin.tech/img/node&#x7EC4;&#x6210;&#x539F;&#x7406;&#x56FE;.jpg" alt style="max-width:100%">
</p>
<p class="markdown-img-description">
</p>
<ol>
<li>&#x7528;&#x6237;&#x4EE3;&#x7801;</li>
</ol>
<p>JS&#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x7F16;&#x5199;&#x7684;</p>
<ol start="2">
<li>&#x7B2C;&#x4E09;&#x65B9;&#x5E93;</li>
</ol>
<p>&#x5927;&#x90E8;&#x5206;&#x4ECD;&#x7136;&#x662F;JS&#x4EE3;&#x7801;&#xFF0C;&#x7531;&#x5176;&#x4ED6;&#x5F00;&#x53D1;&#x8005;&#x7F16;&#x5199;</p>
<ol start="3">
<li>&#x672C;&#x5730;&#x6A21;&#x5757;&#x4EE3;&#x7801;</li>
</ol>
<p>JS&#x4EE3;&#x7801;</p>
<ol start="4">
<li>V8&#x5F15;&#x64CE;</li>
</ol>
<p>c/c++&#x4EE3;&#x7801;&#xFF0C;&#x4F5C;&#x7528;&#xFF1A;&#x628A;JS&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#x6210;&#x4E3A;&#x673A;&#x5668;&#x7801;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;v8&#x5F15;&#x64CE;&#x7684;&#x67D0;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x6269;&#x5C55;&#x5176;&#x529F;&#x80FD;<br>
V8&#x5F15;&#x64CE;&#x7684;&#x6269;&#x5C55;&#x548C;&#x5BF9;&#x6269;&#x5C55;&#x7684;&#x7F16;&#x8BD1;&#xFF0C;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#xFF1A;gyp&#x5DE5;&#x5177;</p>
<p>&#x67D0;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x9700;&#x8981;&#x4F7F;&#x7528;<code>node-gyp</code>&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5148;&#x5B89;&#x88C5;<code>node-gyp</code></p>
<h3 class="mume-header" id="%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B">&#x8FDB;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;</h3>

<h4 class="mume-header" id="%E8%BF%9B%E7%A8%8B">&#x8FDB;&#x7A0B;</h4>

<p>&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x603B;&#x662F;&#x901A;&#x8FC7;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x7684;&#xFF0C;&#x5F53;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4F1A;&#x7ED9;&#x5176;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</p>
<p>&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x62E5;&#x6709;<strong>&#x72EC;&#x7ACB;&#x7684;&#x3001;&#x53EF;&#x4F38;&#x7F29;&#x7684;</strong>&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x539F;&#x5219;&#x4E0A;&#x4E0D;&#x53D7;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x5E72;&#x6270;</p>
<p>&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x4FE1;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x53CC;&#x65B9;&#x9075;&#x5B88;&#x4E00;&#x5B9A;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x6BD4;&#x5982;ipc</p>
<p><strong>CPU&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x5207;&#x6362;&#x6267;&#x884C;</strong></p>
<p>&#x867D;&#x7136;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F46;&#x5B83;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x4ECD;&#x7136;&#x4FDD;&#x6301;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;&#x76F4;&#x63A5;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5F00;&#x542F;&#xFF0C;&#x5219;&#x5B83;&#x53EB;&#x505A;&#x4E3B;&#x8FDB;&#x7A0B;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;B&#x662F;&#x7531;&#x8FDB;&#x7A0B;A&#x5F00;&#x542F;&#xFF0C;&#x5219;A&#x662F;B&#x7684;&#x7236;&#x8FDB;&#x7A0B;&#xFF0C;B&#x662F;A&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B50;&#x8FDB;&#x7A0B;&#x4F1A;&#x7EE7;&#x627F;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4FDD;&#x6301;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// nodejs &#x4E2D;&#x5F00;&#x542F;&#x5B50;&#x8FDB;&#x7A0B;</span>
<span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x5BFC;&#x5165;&#x5185;&#x7F6E;&#x6A21;&#x5757;</span>

childProcess<span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span>&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x547D;&#x4EE4;<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> out<span class="token punctuation">,</span> stdErr</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#xFF0C;&#x8FD9;&#x79CD;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x662F;&#x901A;&#x8FC7;IPC&#x5B8C;&#x6210;&#x7684;&#xFF0C;nodejs&#x5DF2;&#x7ECF;&#x5E2E;&#x4F60;&#x5B8C;&#x6210;&#x4E86;&#x5904;&#x7406;</span>
  <span class="token comment">// err&#xFF1A;&#x5F00;&#x542F;&#x8FDB;&#x7A0B;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x751F;&#x7684;&#x9519;&#x8BEF;</span>
  <span class="token comment">// out: &#x5B50;&#x8FDB;&#x7A0B;&#x8F93;&#x51FA;&#x7684;&#x6B63;&#x5E38;&#x5185;&#x5BB9;</span>
  <span class="token comment">// stdErr: &#x5B50;&#x8FDB;&#x7A0B;&#x8F93;&#x51FA;&#x7684;&#x9519;&#x8BEF;&#x5185;&#x5BB9;</span>
  <span class="token comment">// &#x5B50;&#x8FDB;&#x7A0B;&#x53D1;&#x751F;&#x4EFB;&#x4F55;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x7EDD;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x7236;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x662F;&#x5B8C;&#x5168;&#x9694;&#x79BB;&#x7684;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FC7;&#x53BB;&#xFF0C;nodejs&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x7ED9;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;</span>
<span class="token comment">// &#x8FC7;&#x53BB;&#xFF0C;nodejs&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;cluster&#x6A21;&#x5757;&#xFF0C;&#x901A;&#x8FC7;&#x53E6;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x6765;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;</span>
<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;nodejs&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x7EBF;&#x7A0B;&#x6A21;&#x5757;&#xFF0C;&#x5BF9;&#x8FDB;&#x7A0B;&#x7684;&#x64CD;&#x4F5C;&#x5DF2;&#x7ECF;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#x4E86;</span>
</pre><h4 class="mume-header" id="%E7%BA%BF%E7%A8%8B">&#x7EBF;&#x7A0B;</h4>

<p>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF08;&#x65E0;&#x8BBA;&#x662F;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD8;&#x662F;&#x5B50;&#x8FDB;&#x7A0B;&#xFF09;&#xFF0C;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x4E3A;&#x5B83;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A;&#x4E3B;&#x7EBF;&#x7A0B;</p>
<p><strong>&#x7A0B;&#x5E8F;&#x4E00;&#x5B9A;&#x5728;&#x7EBF;&#x7A0B;&#x4E0A;&#x8FD0;&#x884C;&#xFF01;&#xFF01;</strong></p>
<p>&#x4E3B;&#x7EBF;&#x7A0B;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EBF;&#x7A0B;&#x79F0;&#x4E4B;&#x4E3A;&#x5B50;&#x7EBF;&#x7A0B;</p>
<p>&#x5F53;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x547D;&#x4EE4;CPU&#x53BB;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x662F;&#x5728;&#x8BE5;&#x8FDB;&#x7A0B;&#x7684;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x5207;&#x6362;&#x6267;&#x884C;</p>
<p>&#x7EBF;&#x7A0B;&#x548C;&#x8FDB;&#x7A0B;&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x72EC;&#x7ACB;&#x8FD0;&#x884C;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF1A;<strong>&#x7EBF;&#x7A0B;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x6CA1;&#x6709;&#x9694;&#x79BB;</strong>&#xFF0C;&#x5171;&#x4EAB;&#x8FDB;&#x7A0B;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x7528;&#x9075;&#x5B88;&#x4EFB;&#x4F55;&#x534F;&#x8BAE;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x4F7F;&#x7528;</p>
<p>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x8981;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#xFF1F;</p>
<p>&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x4F7F;&#x7528;&#x591A;&#x6838;cpu&#x3002;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5C3D;&#x91CF;&#x7684;&#x4E0D;&#x8981;&#x963B;&#x585E;&#x3002;</p>
<p>&#x6700;&#x7406;&#x60F3;&#x7684;&#x7EBF;&#x7A0B;&#x6548;&#x679C;&#xFF1A;</p>
<ol>
<li>&#x7EBF;&#x7A0B;&#x6570;&#x7B49;&#x4E8E;cpu&#x7684;&#x6838;&#x6570;</li>
<li>&#x7EBF;&#x7A0B;&#x6C38;&#x4E0D;&#x963B;&#x585E;
<ol>
<li>&#x6CA1;&#x6709;io</li>
<li>&#x53EA;&#x5B58;&#x5728;&#x5927;&#x91CF;&#x8FD0;&#x7B97;</li>
</ol>
</li>
<li>&#x7EBF;&#x7A0B;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;&#xFF0C;&#x51E0;&#x4E4E;&#x4E0D;&#x4F7F;&#x7528;&#x5171;&#x4EAB;&#x6570;&#x636E;</li>
</ol>
<p>&#x7EBF;&#x7A0B;&#x4E00;&#x822C;&#x5904;&#x7406;cpu&#x5BC6;&#x96C6;&#x578B;&#x64CD;&#x4F5C;&#xFF08;&#x8FD0;&#x7B97;&#x64CD;&#x4F5C;&#xFF09;&#xFF0C;&#x800C;io&#x5BC6;&#x96C6;&#x578B;&#x64CD;&#x4F5C;&#x4E0D;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x5F02;&#x6B65;</p>
<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x4EA7;&#x751F;&#x7684;&#x9EBB;&#x70E6;&#xFF0C;nodejs&#x4F7F;&#x7528;&#x72EC;&#x7279;&#x7684;&#x7EBF;&#x7A0B;&#x673A;&#x5236;&#x6765;&#x5C3D;&#x529B;&#x89C4;&#x907F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// &#x521B;&#x5EFA;&#x5B50;&#x7EBF;&#x7A0B;&#x7684;&#x7236;&#x7EBF;&#x7A0B;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Worker</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;worker_threads&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x5165;&#x53E3;&#x6587;&#x4EF6;<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  workerData<span class="token operator">:</span> &#x5F00;&#x542F;&#x7EBF;&#x7A0B;&#x65F6;&#x5411;&#x5176;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// worker&#x662F;&#x5B50;&#x7EBF;&#x7A0B;&#x5B9E;&#x4F8B;</span>

<span class="token comment">// &#x901A;&#x8FC7;EventEmitter&#x76D1;&#x542C;&#x5B50;&#x7EBF;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x5F53;&#x5B50;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x4E8B;&#x4EF6;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x6536;&#x5230;&#x5B50;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x4E8B;&#x4EF6;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>&#x4EFB;&#x610F;&#x6D88;&#x606F;<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x7236;&#x7EBF;&#x7A0B;&#x5411;&#x5B50;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x4EFB;&#x610F;&#x6D88;&#x606F;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x9000;&#x51FA;&#x5B50;&#x7EBF;&#x7A0B;</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>
  isMainThread<span class="token punctuation">,</span> <span class="token comment">// &#x662F;&#x5426;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;</span>
  parentPort<span class="token punctuation">,</span> <span class="token comment">// &#x7528;&#x4E8E;&#x4E0E;&#x7236;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x7684;&#x7AEF;&#x53E3;</span>
  workerData<span class="token punctuation">,</span> <span class="token comment">// &#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x65F6;&#x4F20;&#x9012;&#x7684;&#x6570;&#x636E;</span>
  threadId<span class="token punctuation">,</span> <span class="token comment">// &#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#x7684;&#x552F;&#x4E00;&#x7F16;&#x53F7;</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;worker_threads&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

parentPort<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// &#x5F53;&#x6536;&#x5230;&#x7236;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x89E6;&#x53D1;&#x7684;&#x4E8B;&#x4EF6;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parentPort<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>workerData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x5411;&#x7236;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x6D88;&#x606F;</span>
</pre>
      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#mysql">mysql</a>
<ul>
<li><a href="#mysql%E7%9A%84%E5%AE%89%E8%A3%85">mysql&#x7684;&#x5B89;&#x88C5;</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8">&#x4F7F;&#x7528;</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E5%92%8C%E5%88%86%E7%BB%84">&#x51FD;&#x6570;&#x548C;&#x5206;&#x7EC4;</a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E5%92%8Corm">&#x6570;&#x636E;&#x9A71;&#x52A8;&#x548C;ORM</a>
<ul>
<li><a href="#mysql%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F">mysql&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;</a></li>
<li><a href="#sequelize%E7%AE%80%E4%BB%8B">Sequelize&#x7B80;&#x4ECB;</a></li>
<li><a href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89%E5%92%8C%E5%90%8C%E6%AD%A5">&#x6A21;&#x578B;&#x5B9A;&#x4E49;&#x548C;&#x540C;&#x6B65;</a></li>
<li><a href="#%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9">&#x6A21;&#x578B;&#x7684;&#x589E;&#x5220;&#x6539;</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E6%8B%9F">&#x6570;&#x636E;&#x6A21;&#x62DF;</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96">&#x6570;&#x636E;&#x6293;&#x53D6;</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2">&#x6570;&#x636E;&#x67E5;&#x8BE2;</a></li>
<li><a href="#md5%E5%8A%A0%E5%AF%86">MD5&#x52A0;&#x5BC6;</a></li>
<li><a href="#moment">moment</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81">&#x6570;&#x636E;&#x9A8C;&#x8BC1;</a></li>
<li><a href="#%E8%AE%BF%E9%97%AE%E5%99%A8%E5%92%8C%E8%99%9A%E6%8B%9F%E5%AD%97%E6%AE%B5">&#x8BBF;&#x95EE;&#x5668;&#x548C;&#x865A;&#x62DF;&#x5B57;&#x6BB5;</a></li>
<li><a href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</a></li>
</ul>
</li>
<li><a href="#express">express</a>
<ul>
<li><a href="#express%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">express&#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;</a></li>
<li><a href="#nodemon">nodemon</a></li>
<li><a href="#express%E4%B8%AD%E9%97%B4%E4%BB%B6">express&#x4E2D;&#x95F4;&#x4EF6;</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6">&#x5E38;&#x7528;&#x4E2D;&#x95F4;&#x4EF6;</a></li>
<li><a href="#express%E8%B7%AF%E7%94%B1">express&#x8DEF;&#x7531;</a></li>
<li><a href="#cookie%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">cookie&#x7684;&#x57FA;&#x672C;&#x6982;&#x5FF5;</a>
<ul>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%A4%A7%E4%B8%8D%E5%B0%8F%E7%9A%84%E9%97%AE%E9%A2%98">&#x4E00;&#x4E2A;&#x4E0D;&#x5927;&#x4E0D;&#x5C0F;&#x7684;&#x95EE;&#x9898;</a></li>
<li><a href="#cookie%E7%9A%84%E7%BB%84%E6%88%90">cookie&#x7684;&#x7EC4;&#x6210;</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEcookie">&#x5982;&#x4F55;&#x8BBE;&#x7F6E;cookie</a>
<ul>
<li><a href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AE%BE%E7%BD%AEcookie">&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8BBE;&#x7F6E;cookie</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AEcookie">&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;cookie</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">&#x603B;&#x7ED3;</a></li>
</ul>
</li>
<li><a href="#%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95">&#x65AD;&#x70B9;&#x8C03;&#x8BD5;</a></li>
<li><a href="#%E8%B7%A8%E5%9F%9F%E4%B9%8Bjsonp">&#x8DE8;&#x57DF;&#x4E4B;JSONP</a></li>
<li><a href="#%E8%B7%A8%E5%9F%9F%E4%B9%8Bcors">&#x8DE8;&#x57DF;&#x4E4B;CORS</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0">&#x6982;&#x8FF0;</a></li>
<li><a href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">&#x7B80;&#x5355;&#x8BF7;&#x6C42;</a>
<ul>
<li><a href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%9A%84%E5%88%A4%E5%AE%9A">&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x7684;&#x5224;&#x5B9A;</a></li>
<li><a href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BA%A4%E4%BA%92%E8%A7%84%E8%8C%83">&#x7B80;&#x5355;&#x8BF7;&#x6C42;&#x7684;&#x4EA4;&#x4E92;&#x89C4;&#x8303;</a></li>
</ul>
</li>
<li><a href="#%E9%9C%80%E8%A6%81%E9%A2%84%E6%A3%80%E7%9A%84%E8%AF%B7%E6%B1%82">&#x9700;&#x8981;&#x9884;&#x68C0;&#x7684;&#x8BF7;&#x6C42;</a></li>
<li><a href="#%E9%99%84%E5%B8%A6%E8%BA%AB%E4%BB%BD%E5%87%AD%E8%AF%81%E7%9A%84%E8%AF%B7%E6%B1%82">&#x9644;&#x5E26;&#x8EAB;&#x4EFD;&#x51ED;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E9%A2%9D%E5%A4%96%E7%9A%84%E8%A1%A5%E5%85%85">&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x8865;&#x5145;</a></li>
</ul>
</li>
<li><a href="#session">session</a></li>
<li><a href="#jwt">jwt</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0-1">&#x6982;&#x8FF0;</a></li>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%9A%84%E7%BB%84%E6%88%90">&#x4EE4;&#x724C;&#x7684;&#x7EC4;&#x6210;</a>
<ul>
<li><a href="#header">header</a></li>
<li><a href="#payload">payload</a></li>
<li><a href="#signature">signature</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%9A%84%E9%AA%8C%E8%AF%81">&#x4EE4;&#x724C;&#x7684;&#x9A8C;&#x8BC1;</a></li>
<li><a href="#%E6%80%BB%E7%BB%93-1">&#x603B;&#x7ED3;</a></li>
</ul>
</li>
<li><a href="#%E7%99%BB%E5%BD%95%E5%92%8C%E8%AE%A4%E8%AF%81-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91">&#x767B;&#x5F55;&#x548C;&#x8BA4;&#x8BC1;-&#x670D;&#x52A1;&#x5668;&#x5F00;&#x53D1;</a></li>
<li><a href="#%E7%99%BB%E5%BD%95%E5%92%8C%E8%AE%A4%E8%AF%81-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91">&#x767B;&#x5F55;&#x548C;&#x8BA4;&#x8BC1;-&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">&#x573A;&#x666F;-&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">&#x573A;&#x666F;-&#x6587;&#x4EF6;&#x4E0A;&#x4F20;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">&#x573A;&#x666F;-&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0">&#x573A;&#x666F;-&#x56FE;&#x7247;&#x6C34;&#x5370;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE">&#x573A;&#x666F;-&#x56FE;&#x7247;&#x9632;&#x76D7;&#x94FE;</a></li>
<li><a href="#%E9%87%8D%E8%A6%81%E5%9C%BA%E6%99%AF-%E4%BB%A3%E7%90%86">&#x91CD;&#x8981;&#x573A;&#x666F;-&#x4EE3;&#x7406;</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%9C%BA%E6%99%AF-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E">&#x6269;&#x5C55;&#x573A;&#x666F;-&#x6A21;&#x677F;&#x5F15;&#x64CE;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81">&#x573A;&#x666F;-&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81">&#x573A;&#x666F;-&#x751F;&#x6210;&#x9A8C;&#x8BC1;&#x7801;</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98">&#x573A;&#x666F;-&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;</a>
<ul>
<li><a href="#%E7%BC%93%E5%AD%98%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">&#x7F13;&#x5B58;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;</a></li>
<li><a href="#%E6%9D%A5%E8%87%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BC%93%E5%AD%98%E6%8C%87%E4%BB%A4">&#x6765;&#x81EA;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</a></li>
<li><a href="#%E6%9D%A5%E8%87%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%BC%93%E5%AD%98%E6%8C%87%E4%BB%A4">&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7F13;&#x5B58;&#x6307;&#x4EE4;</a>
<ul>
<li><a href="#%E7%BC%93%E5%AD%98%E6%9C%89%E6%95%88">&#x7F13;&#x5B58;&#x6709;&#x6548;</a></li>
<li><a href="#%E7%BC%93%E5%AD%98%E6%97%A0%E6%95%88">&#x7F13;&#x5B58;&#x65E0;&#x6548;</a></li>
</ul>
</li>
<li><a href="#%E7%BB%86%E8%8A%82">&#x7EC6;&#x8282;</a>
<ul>
<li><a href="#cache-control">Cache-Control</a></li>
<li><a href="#expire">Expire</a></li>
<li><a href="#%E8%AE%B0%E5%BD%95%E7%BC%93%E5%AD%98%E6%97%B6%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F">&#x8BB0;&#x5F55;&#x7F13;&#x5B58;&#x65F6;&#x7684;&#x6709;&#x6548;&#x671F;</a></li>
<li><a href="#pragma">Pragma</a></li>
<li><a href="#vary">Vary</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%89%88%E6%9C%AC%E5%8F%B7%E6%88%96hash">&#x4F7F;&#x7528;&#x7248;&#x672C;&#x53F7;&#x6216;hash</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93-2">&#x603B;&#x7ED3;</a>
<ul>
<li><a href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%86%E8%A7%92">&#x670D;&#x52A1;&#x5668;&#x89C6;&#x89D2;</a></li>
<li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%86%E8%A7%92">&#x6D4F;&#x89C8;&#x5668;&#x89C6;&#x89D2;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%9C%BA%E6%99%AF-%E5%AF%8C%E6%96%87%E6%9C%AC%E6%A1%86">&#x573A;&#x666F;-&#x5BCC;&#x6587;&#x672C;&#x6846;</a></li>
<li><a href="#websocket%E5%8E%9F%E7%90%86">websocket&#x539F;&#x7406;</a></li>
<li><a href="#socketio">socket.io</a></li>
<li><a href="#csrf%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1">CSRF&#x653B;&#x51FB;&#x548C;&#x9632;&#x5FA1;</a>
<ul>
<li><a href="#csrf-%E7%89%B9%E7%82%B9%E5%92%8C%E5%8E%9F%E7%90%86">CSRF &#x7279;&#x70B9;&#x548C;&#x539F;&#x7406;</a></li>
<li><a href="#%E9%98%B2%E5%BE%A1">&#x9632;&#x5FA1;</a>
<ul>
<li><a href="#cookie%E7%9A%84samesite">cookie&#x7684;SameSite</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81referer%E5%92%8Corigin">&#x9A8C;&#x8BC1;referer&#x548C;Origin</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E9%9D%9Ecookie%E4%BB%A4%E7%89%8C">&#x4F7F;&#x7528;&#x975E;cookie&#x4EE4;&#x724C;</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E7%A0%81">&#x9A8C;&#x8BC1;&#x7801;</a></li>
<li><a href="#%E8%A1%A8%E5%8D%95%E9%9A%8F%E6%9C%BA%E6%95%B0">&#x8868;&#x5355;&#x968F;&#x673A;&#x6570;</a></li>
<li><a href="#%E4%BA%8C%E6%AC%A1%E9%AA%8C%E8%AF%81">&#x4E8C;&#x6B21;&#x9A8C;&#x8BC1;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xss%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1">XSS&#x653B;&#x51FB;&#x548C;&#x9632;&#x5FA1;</a>
<ul>
<li><a href="#%E5%AD%98%E5%82%A8%E5%9E%8Bxss">&#x5B58;&#x50A8;&#x578B;XSS</a></li>
<li><a href="#%E5%8F%8D%E5%B0%84%E5%9E%8B">&#x53CD;&#x5C04;&#x578B;</a></li>
<li><a href="#dom%E5%9E%8B">DOM&#x578B;</a></li>
</ul>
</li>
<li><a href="#nodejs%E7%9A%84%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86">nodejs&#x7684;&#x7EC4;&#x6210;&#x539F;&#x7406;</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B">&#x8FDB;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;</a>
<ul>
<li><a href="#%E8%BF%9B%E7%A8%8B">&#x8FDB;&#x7A0B;</a></li>
<li><a href="#%E7%BA%BF%E7%A8%8B">&#x7EBF;&#x7A0B;</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>